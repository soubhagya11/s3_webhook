"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6248],{96248:(Q,f,r)=>{r.r(f),r.d(f,{PredefinedTripsModule:()=>z});var E=r(36895),O=r(54463),m=r(71568),I=r(65063),b=r(62510),i=r(32236),u=r(15861),g=r(30578),S=r(42863),j=r(27601),A=r(28168),C=r(42786),N=r(90313),y=r(29443),R=r(47561),M=r(35226),P=r.n(M),T=r(85623),o=r(94650),v=r(37415);const L=["datatableComponent"],D=[{path:"tripplannerroutes/list",component:(()=>{class d extends R.O{listingVariables;columnsheaders;uiUtils;loggerService;translateService;route;router;commonService;facilitiesui;predefinedTripsService;dataJsonObj={};datatableComponent;noDuplicates;paramObj;assetsList;messagelist;selectedAssetsArray;recordsCount;fleetlistdata;langcode;nodata;constructor(e,t,s,a,n,l,c,p,$,K){super(l,p),this.listingVariables=e,this.columnsheaders=t,this.uiUtils=s,this.loggerService=a,this.translateService=n,this.route=l,this.router=c,this.commonService=p,this.facilitiesui=$,this.predefinedTripsService=K,this.route.params.subscribe(h=>{this.paramObj=JSON.parse(JSON.stringify(h))}),this.route.queryParams.subscribe(h=>{this.dataJsonObj.queryParamsObj={defaultView:h.default_view,selectedMenuId:h.selectedMenuId,selectedSubMenuId:h.selectedSubMenuId}})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.showSpinner(),this.dataJsonObj.pageName=i.hf.TRIPPLANNERROUTES,this.dataJsonObj.inputObj={is_enabled:!0},this.dataJsonObj.isSubmitButtonDisabled=!1,this.dataJsonObj.selectedEnterpriseObj=this.commonService.getSelcetedEnterpriseObj(),this.dataJsonObj.inputObj.enterprise=this.dataJsonObj.selectedEnterpriseObj,this.dataJsonObj.selectedMenu=JSON.parse(localStorage.getItem(i.BU.SELECTED_MENU)),this.dataJsonObj.selectedSubMenu=JSON.parse(localStorage.getItem(i.BU.MENU_CLICK_ITEM));const e=this.commonService.getLoginUserTimeZoneDateFormat();this.dataJsonObj.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(e.timeZoneDescription),this.dataJsonObj.userTimeZoneObj.timeZoneCode=e.timeZoneCode,this.dataJsonObj.userTimeZoneObj.timeZoneToDisplay=this.lookupLanguageTranslations(e.timeZoneID),this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"COMMON_PAGE_TITLES.TRIP_PLANNER_ROUTES",value:"",showSubMenuDisplayName:!0}],this.dataJsonObj.enterpriseId=localStorage.getItem(i.BU.SELECTED_ENTERPRISE),this.dataJsonObj.tableColumnHeaders=this.columnsheaders.predefinedTripsColumnHeaders(),this.dataJsonObj.buildingCode=localStorage.getItem(i.BU.SELECTED_ENTERPRISE)?localStorage.getItem(i.BU.BUILDING_CODE):localStorage.getItem(i.BU.PARENT_BUILDING_CODE),this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.searchString="",this.dataJsonObj.enableSearch=!1,this.dataJsonObj.searchButton=!0,this.dataJsonObj.forceRefresh=!1,this.messagelist=[],this.getMenuJson(),this.dataJsonObj.actionBoolean=!(!this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.ACTIVATE)||!this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.INACTIVATE)),this.dataJsonObj.actions={CHECKBOX2:this.dataJsonObj.actionBoolean,EDIT:this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.EDIT),LOCATE:this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.LOCATE),DELETE:this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.DELETE),VIEW:this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.VIEW)},this.dataJsonObj.advancedSearchObj={},this.getSyncSettings()}ngOnDestroy(){this.commonService.showHeaderFooter(),this.commonService.getDynamicHeight()}getMenuJson(){var e=this;return(0,u.Z)(function*(){e.dataJsonObj.selectedMenuDetails=yield e.commonService.getSelectedMenuDetails(i.hf.TRIPPLANNERROUTES,e.dataJsonObj.enterpriseId);const t={};t.default_view=e.dataJsonObj.selectedMenuDetails?.default_view,t.selectedMenuId=e.dataJsonObj.selectedMenuDetails?.selected_menu_id,t.selectedSubMenuId=e.dataJsonObj.selectedMenuDetails?.submenu_id,t.selectedSubmenuDisplayName=e.dataJsonObj.selectedMenuDetails?.submenu_page?.page_name,e.dataJsonObj.pageActionsList=[],e.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.CREATE)&&(t.action=i.A0.CREATE,e.dataJsonObj.pageActionsList.push({actionName:"CREATE",displayName:"COMMON_BUTTONS.BUTTON_CREATE",actionType:i.gL.URL,redirectURL:"/mytripfacilitiesselection/mytripfacilitiesselection/list",isRelativeRoute:!0,isClearCache:!1,queryParams:t,iconClass:"fas fa-plus"}))})()}getSyncSettings(){var e=this;return(0,u.Z)(function*(){const t=yield e.commonService.getCacheSettings("TRIPPLANNERROUTES");e.dataJsonObj.syncEnabled=t.cacheEnabled,e.dataJsonObj.syncFreq=t.syncFreq,e.dataJsonObj.forceRefresh=t.forceRefresh,e.dataJsonObj.syncEnabled&&(e.dataJsonObj.predefinedTrips=e.noDuplicates,e.getAllRecords())})()}getAllRecords(){var e=this;return(0,u.Z)(function*(){try{e.showSpinner(),e.dataJsonObj.enterpriseId=localStorage.getItem(i.BU.SELECTED_ENTERPRISE),e.dataJsonObj.enterpriseName=localStorage.getItem(i.BU.SELECTED_ENTERPRISE_NAME);const t=e.commonService.getMobileViewCondition(e.dataJsonObj.selectedDisplayView),s=e.dataJsonObj.selectedFilter?"&filtertype="+e.dataJsonObj.selectedFilter:"";yield e.predefinedTripsService.getAll(e.dataJsonObj.enterpriseId,e.dataJsonObj.searchString,e.listingVariables.pageNumbers,e.listingVariables.rowsPerPage,e.listingVariables.sortOrderColumn,e.dataJsonObj.isFilterClicked,e.dataJsonObj.syncFreq,!e.dataJsonObj.syncEnabled,e.dataJsonObj.forceRefresh,t,s,e.dataJsonObj.advancedSearchObj.inputAdvSearchObj).then(a=>{if(e.hideSpinner(),(e.dataJsonObj.syncEnabled||e.dataJsonObj.forceRefresh)&&1===e.listingVariables.pageNumbers&&(e.dataJsonObj.predefinedTripsMobileList=[]),e.dataJsonObj.predefinedTripsMobileList&&e.dataJsonObj.predefinedTripsMobileList.length>0||(e.dataJsonObj.predefinedTripsMobileList=[]),a.rows.length>0){for(let n=0;n<a.rows.length;n++)if(a.rows[n].display_grid_title=a.rows[n].trip_name,a.rows[n].imageName=a.rows[n].trip_name,a.rows[n].page_name=i.hf.TRIPPLANNERROUTES,a.rows[n].enabled_status=!!a.rows[n].is_enabled&&a.rows[n].is_enabled,a.rows[n].is_enabled=!0===a.rows[n].is_enabled?"Yes":"No",e.dataJsonObj.predefinedTripsMobileList=e.dataJsonObj.predefinedTripsMobileList.filter(l=>l._id!==a.rows[n]._id),e.dataJsonObj.predefinedTripsMobileList.push(a.rows[n]),a.rows[n].trip_name){const l={};l.selectedMenuId=e.dataJsonObj.selectedMenuDetails?.selected_menu_id,l.selectedSubMenuId=e.dataJsonObj.selectedMenuDetails?.submenu_id,l.selectedSubmenuDisplayName=e.dataJsonObj.selectedMenuDetails?.submenu_page?.page_name,l.predefinedPathId=a.rows[n]._id,l.action=i.A0.VIEW;const c={url:"tripplanner/tripplanner/list",queryParams:l||""},p=c.queryParams&&Object.keys(c.queryParams).length>0?`${c.url}?${JSON.stringify(c.queryParams)}`:c.url;a.rows[n].trip_display_name=`<a class="enable" id="trip_name${a.rows[n]._id}" href=${p}>${a.rows[n].trip_name}</a>`}a.totalCount&&(e.listingVariables.totalRecords=a.totalCount),1===e.listingVariables.pageNumbers&&(e.listingVariables.totalpages=a.pages),e.dataJsonObj.isLoadMoreClicked?(e.dataJsonObj.isLoadMoreClicked=!1,e.dataJsonObj.predefinedTrips=e.dataJsonObj.predefinedTrips.concat(a.rows)):e.dataJsonObj.predefinedTrips=a.rows}else e.listingVariables.totalRecords=1,e.dataJsonObj.predefinedTrips=[],e.dataJsonObj.predefinedTripsMobileList=[]},a=>{e.hideSpinner(),e.loggerService.setLoggerError(e.constructor.name,"getAllRecords",a)})}catch(t){e.hideSpinner(),e.loggerService.setLoggerError(e.constructor.name,"getAllRecords",t)}})()}showSpinner(){this.dataJsonObj.showSpinner=!0}hideSpinner(){this.dataJsonObj.showSpinner=!1}getRedirectToView(e){const t=e._id;if(this.roleRightsValidationByPage(i.hf.TRIPPLANNERROUTES,i.AM.ACTIONS,i.In.VIEW)){const s={};s.selectedMenuId=this.dataJsonObj.selectedMenuDetails?.selected_menu_id,s.selectedSubMenuId=this.dataJsonObj.selectedMenuDetails?.submenu_id,s.selectedSubmenuDisplayName=this.dataJsonObj.selectedMenuDetails?.submenu_page?.page_name,s.predefinedPathId=t,s.action=i.A0.VIEW,this.commonService.redirectToUrl(["tripplanner","tripplanner","list"],!0,!1,s,this.route)}}onActionClicked(e){var t=this;return(0,u.Z)(function*(){const s=e.data._id;if(e.action===i.A0.EDIT)t.predefinedTripsService.getPredefinedTrips(s,t.dataJsonObj.buildingCode).then(a=>{t.dataJsonObj.faciilityData=a,t.dataJsonObj.faciilityData?.facilityArray[0]?.facilityId&&"number"==typeof t.dataJsonObj.faciilityData?.facilityArray[0]?.facilityId&&(t.dataJsonObj.faciilityData.facilityArray[0]._id=t.dataJsonObj.faciilityData?.facilityArray[0].facilityId),localStorage.setItem(i.BU.TRIP_PLANNER_LOCATE_FACILITY,JSON.stringify(t.dataJsonObj.faciilityData?.facilityArray[0])),t.getmessagelist(t.dataJsonObj.faciilityData?.facilityArray);const n={};n.selectedMenuId=t.dataJsonObj.selectedMenuDetails?.selected_menu_id,n.selectedSubMenuId=t.dataJsonObj.selectedMenuDetails?.submenu_id,n.selectedSubmenuDisplayName=t.dataJsonObj.selectedMenuDetails?.submenu_page?.page_name,n.default_view=t.dataJsonObj.selectedMenuDetails?.default_view,n.predefinedPathId=s,n.action=i.A0.EDIT,t.commonService.redirectToUrl(["tripplanner","tripplanner","list"],!0,!1,n,t.route)});else if(e.action===i.A0.DELETE)t.deleteRecord(s);else if(e.action===i.A0.LOCATE)try{const a=yield t.predefinedTripsService.getPredefinedTrips(s,t.dataJsonObj.buildingCode);t.dataJsonObj.faciilityData=a,t.dataJsonObj.faciilityData?.facilityArray[0]?.facilityId&&"number"==typeof t.dataJsonObj.faciilityData?.facilityArray[0]?.facilityId&&(t.dataJsonObj.faciilityData.facilityArray[0]._id=t.dataJsonObj.faciilityData?.facilityArray[0]?.facilityId),localStorage.setItem(i.BU.TRIP_PLANNER_LOCATE_FACILITY,JSON.stringify(t.dataJsonObj.faciilityData?.facilityArray[0])),t.getmessagelist(t.dataJsonObj.faciilityData?.facilityArray),t.cartAddedAssetsLocateOffline(t.dataJsonObj.faciilityData?.facilityArray[0])}catch(a){t.loggerService.setLoggerError(t.constructor.name,"getAllRecords",a)}else if(e.action===i.A0.CHECKBOX)t.changeStatus(e.data);else if(e.action===i.A0.VIEW){const a={};a.selectedMenuId=t.dataJsonObj.selectedMenuDetails?.selected_menu_id,a.selectedSubMenuId=t.dataJsonObj.selectedMenuDetails?.submenu_id,a.selectedSubmenuDisplayName=t.dataJsonObj.selectedMenuDetails?.submenu_page?.page_name,a.predefinedPathId=s,a.action=i.A0.VIEW,t.commonService.redirectToUrl(["tripplanner","tripplanner","list"],!0,!1,a,t.route)}})()}cartAddedAssetsLocateOffline(e){localStorage.setItem(i.BU.MY_TRIP,"mytrip"),e&&this.facilitiesui.cartAddedAssetsLocateOffline(e)}changeStatus(e){try{this.dataJsonObj.tripplannerId=e._id,this.dataJsonObj.actionStatus=e.isEnabled,this.predefinedTripsService.patch(this.dataJsonObj.tripplannerId,{is_enabled:this.dataJsonObj.actionStatus}).then(s=>{this.uiUtils.displaytoastMessage(this.dataJsonObj.actionStatus?"COMMON_TOAST_MESSAGES.TOAST_RECORD_IS_ENABLED":"COMMON_TOAST_MESSAGES.TOAST_RECORD_IS_DISABLED"),this.router.routeReuseStrategy.clearModuleRouteCache("predefined-trip"),this.getAllRecords()})}catch(t){this.loggerService.setLoggerError(this.constructor.name,"changeStatus",t)}}deleteRecord(e){try{P().fire({title:"",text:this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_DELETE"),showCancelButton:!0,cancelButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(t=>{t.value&&this.predefinedTripsService.delete(e).then(s=>{this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DELETE"),this.router.routeReuseStrategy.clearModuleRouteCache("predefined-trip"),this.dataJsonObj.forceRefresh=!0,this.getAllRecords()},s=>{}).catch(s=>{this.loggerService.setLoggerError(this.constructor.name,"delete",s)})})}catch(t){this.loggerService.setLoggerError(this.constructor.name,"delete",t)}}getmessagelist(e){if(e.length>0){for(let t of e)t.properties.iconName&&this.messagelist.push(t);for(let t=0;t<this.messagelist.length;t++)this.messagelist[t].facilityName=this.messagelist[t].properties.facilityName;if(this.messagelist.sort((t,s)=>t.properties.facilityName.toLowerCase()>s.properties.facilityName.toLowerCase()?1:s.properties.facilityName.toLowerCase()>t.properties.facilityName.toLowerCase()?-1:0),this.messagelist.length>0){const t=[];let s=this.messagelist.length;this.messagelist.length>this.recordsCount&&(s=this.recordsCount);for(let a=0;a<s;a++)t.push(this.messagelist[a]);this.fleetlistdata=t;for(let a=0;a<this.fleetlistdata.length;a++)this.fleetlistdata[a].facilityName=void 0!==this.fleetlistdata[a].name&&N.L.isEmpty(this.fleetlistdata[a].name[this.langcode])?this.fleetlistdata[a].name[this.langcode]:this.fleetlistdata[a].facilityName}else this.fleetlistdata=[];for(let t of this.fleetlistdata)t._id=t.facilityId;localStorage.setItem(i.BU.SELECTED_ASSETS,JSON.stringify(this.fleetlistdata)),this.nodata=!1}}loadPageData(e){this.dataJsonObj.forceRefresh=e.forceRefresh,this.listingVariables.pageNumbers=e.listingVariables.pageNumbers,e.clearMobileData&&(this.dataJsonObj.predefinedTripsMobileList=this.noDuplicates),e.isPaginationChange&&(this.dataJsonObj.selectedFilter=e.selectedFilterType,this.dataJsonObj.isLoadMoreClicked=e.isLoadMoreClicked,this.dataJsonObj.advancedSearchObj.inputAdvSearchObj=e.selectedAdvancedSearchObj),this.getAllRecords()}getSearchResult(e){this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.searchString=e,this.dataJsonObj.syncEnabled||(this.dataJsonObj.predefinedTrips=[],this.getAllRecords()),this.datatableComponent.reset()}searchClose(){this.dataJsonObj.searchString="",this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.syncEnabled||(this.dataJsonObj.predefinedTrips=[],this.getAllRecords()),this.datatableComponent.reset()}selectedFilterType(e){e?this.dataJsonObj.selectedFilter=e:(this.dataJsonObj.selectedFilter="",this.dataJsonObj.selectedAdvancedSearchObj={})}advancedSearchFilterClicked(e){this.dataJsonObj.selectedAdvancedSearchObj=e}selectedViewType(e){this.dataJsonObj.selectedDisplayView=e}onPageLevelActionClicked(e){}onHeaderItemClick(e){switch(e.type){case"search":this.getSearchResult(e.event);break;case"search_close":this.searchClose();break;case"filters":this.selectedFilterType(e.event);break;case"advanced_search":this.advancedSearchFilterClicked(e.event);break;case"display_views":this.selectedViewType(e.event);break;case"page_actions":this.onPageLevelActionClicked(e.event)}}ngAfterContentInit(){this.commonService.showHeaderFooter()}static \u0275fac=function(t){return new(t||d)(o.Y36(g.v),o.Y36(S.Y),o.Y36(j.s),o.Y36(C.m),o.Y36(O.sK),o.Y36(b.gz),o.Y36(b.F0),o.Y36(m.v),o.Y36(T.G),o.Y36(y.l))};static \u0275cmp=o.Xpm({type:d,selectors:[["app-predefined-trips-list"]],viewQuery:function(t,s){if(1&t&&o.Gf(L,5),2&t){let a;o.iGM(a=o.CRH())&&(s.datatableComponent=a.first)}},features:[o._Bn([g.v,S.Y,j.s,T.G]),o.qOj],decls:7,vars:26,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","defaultView","isFabDisplay","pageActionsList","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu","headerItemClick"],["id","extraPaddingBottomID",1,"card-body","pdt-0"],["id","users-list",1,"fixed-height-content",3,"header","actions","paginator","listingVariables","totalPages","totalRecords","search","mobileListData","data","expand","selectedDisplayViewType","selectedFilterType","selectedAdvancedSearchObj","pageName","selectedMenuId","showSpinner","selectedSubMenuId","actionClicked","itemClickEvent","loadPageData"],["datatableComponent",""]],template:function(t,s){1&t&&(o.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-pageheader",3),o.NdJ("headerItemClick",function(n){return s.onHeaderItemClick(n)}),o.qZA()(),o.TgZ(4,"div",4)(5,"app-datatable",5,6),o.NdJ("actionClicked",function(n){return s.onActionClicked(n)})("itemClickEvent",function(n){return s.getRedirectToView(n)})("loadPageData",function(n){return s.loadPageData(n)}),o.qZA()()()()),2&t&&(o.xp6(3),o.Q6J("pageName",s.dataJsonObj.pageName)("defaultView",null==s.dataJsonObj.queryParamsObj?null:s.dataJsonObj.queryParamsObj.defaultView)("isFabDisplay",!1)("pageActionsList",s.dataJsonObj.pageActionsList)("pageTitle",s.dataJsonObj.pageTitle)("selectedMenuId",null==s.dataJsonObj.queryParamsObj?null:s.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==s.dataJsonObj.queryParamsObj?null:s.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!0)("showDependencySubMenu",!1),o.xp6(2),o.Q6J("header",s.dataJsonObj.tableColumnHeaders)("actions",s.dataJsonObj.actions)("paginator",!0)("listingVariables",s.listingVariables)("totalPages",s.listingVariables.totalpages)("totalRecords",s.listingVariables.totalRecords)("search",s.dataJsonObj.searchString)("mobileListData",s.dataJsonObj.predefinedTripsMobileList)("data",s.dataJsonObj.predefinedTrips)("expand",!1)("selectedDisplayViewType",s.dataJsonObj.selectedDisplayView)("selectedFilterType",s.dataJsonObj.selectedFilter)("selectedAdvancedSearchObj",s.dataJsonObj.selectedAdvancedSearchObj)("pageName",s.dataJsonObj.pageName)("selectedMenuId",null==s.dataJsonObj.queryParamsObj?null:s.dataJsonObj.queryParamsObj.selectedMenuId)("showSpinner",s.dataJsonObj.showSpinner)("selectedSubMenuId",null==s.dataJsonObj.queryParamsObj?null:s.dataJsonObj.queryParamsObj.selectedSubMenuId))},dependencies:[A.n,v.q]})}return d})(),data:{object_type:i.hf.TRIP_PLANNER,title:"predefined trip planner",responsibilityParam:i.bP.MENUS+"."+i.w1.TRIP_PLANNER+"."+i.bP.SUBMENUS+"."+i.w1.TRIP_PLANNER+"."+i.In.ENABLED,pageName:i.hf.TRIP_PLANNER}}];let U=(()=>{class d{static \u0275fac=function(t){return new(t||d)};static \u0275mod=o.oAB({type:d});static \u0275inj=o.cJS({imports:[b.Bz.forChild(D),b.Bz]})}return d})();var V=r(73078),B=r(32174),w=r(27809),J=r(24006),F=r(56709),Y=r(73162),Z=r(96657),H=r(83748),G=r(93144),k=r(65673),W=r(3848),_=r(59549);let z=(()=>{class d{static \u0275fac=function(t){return new(t||d)};static \u0275mod=o.oAB({type:d});static \u0275inj=o.cJS({providers:[I.f,m.v,V.e,y.l],imports:[U,E.ez,O.aw,J.u5,J.UX,G.U$,B.fx,k.Q,Y.Cv,H.v,Z.PeopleModule,F.p9,w.N,W.Nh,_.lN]})}return d})()}}]);