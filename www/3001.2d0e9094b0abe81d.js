"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3001],{63001:(Ye,L,l)=>{l.r(L),l.d(L,{BeaconMessagesModule:()=>xe});var w=l(32174),T=l(11210),y=l(15861),E=l(15439),q=l(75875),n=l(32236),J=l(90313),e=l(94650),K=l(80529);let b=(()=>{class o{http;authService;userToken=localStorage.getItem(n.BU.TOKEN);constructor(a,i){this.http=a,this.authService=i}getAll(a,i,t,s,r,d,c,p,h,g){const f=d?"&condition="+d:"",_=h||"",H=J.L.isEmpty(g)?"":"&advSearchString="+JSON.stringify(g);return J.L.isEmpty(f)?this.authService.getApiCall("api/v1/beaconmessages?&enterprise.enterprise_id="+i+"&skip="+r+"&limit="+s+"&sort="+t+"&search="+a+p+_+H,c):this.authService.getApiCall("api/v1/beaconmessages?&enterprise.enterprise_id="+i+"&skip="+r+"&limit="+s+"&sort="+t+"&search="+a+f+p+_+H,c)}create(a,i,t,s){return new Promise((r,d)=>{const c=new FormData;i&&c.append("Imagefile",i,"Imagefile"),c.append("AudioFile",t),c.append("VideoFile",s),c.append("beaconMessagesData",JSON.stringify(a)),this.authService.postApiCall("api/v1/beaconmessages/",c).subscribe(p=>{r(p)},p=>{d(p)})})}update(a,i,t,s,r){return new Promise((d,c)=>{const p=new FormData;t&&p.append("Imagefile",t,"Imagefile"),p.append("AudioFile",s),p.append("VideoFile",r),p.append("beaconMessagesData",JSON.stringify(a)),this.authService.putApiCall("api/v1/beaconmessages/"+i,p).subscribe(h=>{d(h)},h=>{c(h)})})}get(a){return this.authService.getApiCall("api/v1/beaconmessages/"+a,!0)}delete(a){return new Promise((i,t)=>{this.authService.deleteApiCall("api/v1/beaconmessages/"+a).subscribe(s=>{i(s)},s=>{t(s)})})}patch(a,i){return new Promise((t,s)=>{this.authService.patchApiCall("api/v1/beaconmessages/"+a,i).subscribe(r=>{t(r)},r=>{s(r)})})}getParentFacility(a,i){return new Promise((t,s)=>{this.authService.getApiCall("api/v1/facilities?type=drop&enterprise.enterprise_id="+a+"&facility_type.facility_type_name="+i).subscribe(r=>{t(r)},r=>{s(r)})})}getbeconName(a){return new Promise((i,t)=>{this.authService.getApiCall("api/v1/beacons?type=drop&enterprise.enterprise_id="+a).subscribe(s=>{i(s)},s=>{t(s)})})}statusUpdate(a,i){return new Promise((t,s)=>{this.authService.patchApiCall("api/v1/beacons/"+i,a).subscribe(r=>{t(r)},r=>{s(r)})})}static \u0275fac=function(i){return new(i||o)(e.LFG(K.eN),e.LFG(q.e))};static \u0275prov=e.Yz7({token:o,factory:o.\u0275fac})}return o})();var O=l(71568),C=l(47561),W=l(57936),D=l(75023),M=l(42786),A=l(46448),u=l(62510),v=l(54463),N=l(27601),S=l(70057),I=l(36895),F=l(2387),B=l(56368),P=l(9851),j=l(93837),U=l(68653),R=l(47386),V=l(42919),Z=l(37415);const z=["validBeaconName"],X=["validFacility"],$=["validFacilityType"],ee=["validMessageType"],te=["validTitle"];function ae(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-dropdown-singleselect",29,30),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeBeaconName(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,2,"NEW_VARIABLES.BEACON_NAME")),e.Q6J("options",a.beconOptions)}}function ie(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-dropdown-singleselect",29,31),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeFacilityType(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,2,"NEW_VARIABLES.ASSET_TYPE")),e.Q6J("options",a.facilityTypeOptions)}}function se(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-dropdown-singleselect",29,32),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeFacility(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,2,"RESERVATIONS.ASSET")),e.Q6J("options",a.facilityOptions)}}function ne(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"div",33)(2,"input",34),e.NdJ("change",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.getExcelFile(t))}),e.qZA(),e._UZ(3,"label",35),e.qZA()()}}function oe(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-imageupload",36),e.NdJ("imageRemove",function(){e.CHM(a);const t=e.oxw();return e.KtG(t.backgroundImageRemove())})("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeImage(t))}),e.qZA()()}}function re(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"div",33)(2,"input",37),e.NdJ("change",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.getExcelFile1(t))}),e.qZA(),e._UZ(3,"label",35),e.qZA()()}}function le(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",21)(1,"app-input",38,39),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeTitle(t))}),e.ALo(3,"translate"),e.qZA()()}2&o&&(e.xp6(1),e.s9C("label",e.lcZ(3,2,"NEW_VARIABLES.TITLE")),e.Q6J("maxlength",30))}function ce(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",21)(1,"app-input",38,39),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeTitle(t))}),e.ALo(3,"translate"),e.qZA()()}2&o&&(e.xp6(1),e.s9C("label",e.lcZ(3,2,"COMMON_PAGE_TITLES.MESSAGE")),e.Q6J("maxlength",30))}let de=(()=>{class o extends C.O{beaconMessagesService;facilitiesService;loggerService;navigationService;router;translateService;uiUtils;commonService;enterprisesService;route;toastController;validBeaconName;validFacility;validFacilityType;validMessageType;validTitle;audioFile;audioUpload=!1;beaconDisplayName;beaconId;beaconImage;beaconMessageCreateObj;beaconPromotionsEnable=!1;beconName=!1;beconNameObj;beconOptions;checkboxOptions;defaultTimeZone;diffDays=1;disableSubmitBtn=!1;endDate;enterpriseId;enterpriseName;enterpriseShortName;enterpriseViewId;error;facilityId;facilityObj;facilityOptions;facilityTypeName;facilityTypeId;facilityTypeObj;facilityTypeOptions;headerAction;imageError;imageUpload=!1;imgFile;isEnabled;loginUserDateFormat;messageTypeDisplayName;messageTypeId;messageTypeObj;messageTypeOptions;pageName=n.sn.BEACON_MESSAGES;startDate;textEnable=!1;timeZoneOptions;title;userTimeZoneObj={};utcTimeZoneString;utccurrentTime;utctimezone;videoFile;videoUpload;dataJsonObj={};audioExtensions=[];videoExtensions=[];constructor(a,i,t,s,r,d,c,p,h,g,f){super(g,p),this.beaconMessagesService=a,this.facilitiesService=i,this.loggerService=t,this.navigationService=s,this.router=r,this.translateService=d,this.uiUtils=c,this.commonService=p,this.enterprisesService=h,this.route=g,this.toastController=f}ngOnInit(){this.headerAction={BACK:!0},this.initializeComponent(),this.checkboxOptions=[{value:"",displayname:this.translateService.instant("NEW_VARIABLES.BEACON_PROMOTIONS"),key:"checkbox1"}]}initializeComponent(){this.dataJsonObj.pageName=n.hf.BEACON_MESSAGES,this.dataJsonObj.pageTitle=[{key:"COMMON_PAGE_TITLES.BEACON_MESSAGE",value:"",showSubMenuDisplayName:!1},{key:"",value:"-",showSubMenuDisplayName:!1},{key:"COMMON_BUTTONS.BUTTON_CREATE",value:"",showSubMenuDisplayName:!1}],this.enterpriseId=localStorage.getItem(n.BU.SELECTED_ENTERPRISE),this.getDynamicJson([{folderName:n.sb.FACILITY_TYPES,jsonType:"list",storingFieldName:"facilityTypesListJson"}]),this.commonService.getLookupCodesListJson(this.enterpriseId,"list").then(r=>{this.dataJsonObj.lookupCodesListJSON=r,this.getMessageTypes();const d=this.commonService.getLoginUserTimeZoneDateFormat();this.loginUserDateFormat=d.dateFormat,this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(d.timeZoneDescription),this.userTimeZoneObj.timeZoneCode=d.timeZoneCode,this.getTimeZone(this.userTimeZoneObj.timeZoneCode)}),this.getEnterprisesViewData(),this.getFacility(),this.utccurrentTime=(new Date).toISOString();const i=this.displayDateFormatter(this.utccurrentTime,!1,!0);this.startDate=i.startDate;const t=this.commonService.addDaysToDate(this.utccurrentTime,this.diffDays),s=this.displayDateFormatter(t,!1,!0);this.endDate=s.startDate}getDynamicJson(a){var i=this;return(0,y.Z)(function*(){for(let t of a)i.dataJsonObj[t.storingFieldName]=yield i.commonService.getDynamicJson(i.enterpriseId,t.folderName,t.jsonType);i.getFacilityTypes("")})()}getEnterprisesViewData(){try{this.enterprisesService.getEnterprisesViewData(this.enterpriseId).subscribe(a=>{this.enterpriseName=a.enterprise_name,this.enterpriseViewId=a._id,this.enterpriseShortName=a.short_name},a=>{this.loggerService.setLoggerError(this.constructor.name,"getEnterprisesViewData",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getEnterprisesViewData",a)}}getBeaconPromotionEnable(a){this.beaconPromotionsEnable=a.value,!0===this.beaconPromotionsEnable?(this.beconName=!0,this.getBeconName()):(this.beconName=!1,this.beconNameObj="",this.beaconId="")}changeTitle(a){this.title=a.value}getBeconName(){try{this.beaconMessagesService.getbeconName(this.enterpriseId).then(a=>{this.beconOptions=a,this.beconNameObj=a[0]},a=>{this.loggerService.setLoggerError(this.constructor.name,"getBeconName",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getBeconName",a)}}changeBeaconName(a){this.beaconId=a.value,this.beconNameObj=this.beconOptions.find(i=>i.ID===parseInt(this.beaconId,10))}getFacilityTypes(a){var i=this;return(0,y.Z)(function*(){try{i.facilityTypeOptions=[],i.commonService.getFilteredDynamicJSONData(i.dataJsonObj.facilityTypesListJson,"facility_type_display_name",a).then(t=>{i.facilityTypeOptions=t,i.facilityTypeOptions?.length>0&&(i.facilityTypeObj=t[0],i.facilityTypeName=t?t[0].facility_type_name:"")}).catch(t=>{i.loggerService.setLoggerError(i.constructor.name,"getFacilityOptions",t)})}catch(t){i.loggerService.setLoggerError(i.constructor.name,"getFacilityOptions",t)}})()}changeFacilityType(a){this.facilityTypeId=a.value,this.facilityTypeObj=this.facilityTypeOptions.find(i=>i.ID===parseInt(this.facilityTypeId,10)),this.facilityTypeName=this.facilityTypeObj.facility_type_name,this.getFacility()}getMessageTypes(){try{this.commonService.getFilteredLookupCodes(this.dataJsonObj.lookupCodesListJSON[n.ox.MESSAGE_TYPES],"").then(a=>{this.messageTypeOptions=a,this.messageTypeObj=a[0],this.messageTypeDisplayName=this.lookupLanguageTranslations(a[0].lookup_id)},a=>{this.loggerService.setLoggerError(this.constructor.name,"getMessageTypes",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getMessageTypes",a)}}changeMessageType(a){this.messageTypeId=a.value,this.messageTypeObj=this.messageTypeOptions.find(i=>i.ID===parseInt(this.messageTypeId,10)),this.messageTypeDisplayName=this.lookupLanguageTranslations(this.messageTypeObj.lookup_id),this.messageTypeObj.lookup_name===n.V8.AUDIO?(this.audioUpload=!0,this.imageUpload=!1,this.videoUpload=!1,this.videoFile="",this.imgFile=""):this.messageTypeObj.lookup_name===n.V8.IMAGE?(this.imageUpload=!0,this.audioUpload=!1,this.videoUpload=!1,this.audioFile="",this.videoFile=""):this.messageTypeObj.lookup_name===n.V8.VIDEO?(this.videoUpload=!0,this.audioUpload=!1,this.imageUpload=!1,this.audioFile="",this.imgFile=""):this.messageTypeObj.lookup_name===n.V8.TEXT&&(this.videoUpload=!1,this.audioUpload=!1,this.imageUpload=!1,this.textEnable=!0,this.audioFile="",this.imgFile="",this.videoFile=""),this.getFacility()}getFacility(){try{this.beaconMessagesService.getParentFacility(this.enterpriseId,this.facilityTypeName).then(a=>{this.facilityOptions=a},a=>{this.loggerService.setLoggerError(this.constructor.name,"getFacility",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getFacility",a)}}changeFacility(a){try{this.facilityId=a.value,this.facilityObj=this.facilityOptions.find(i=>i.ID===parseInt(this.facilityId,10))}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeFacility",i)}}getTimeZone(a){try{this.commonService.getFilteredLookupCodes(this.dataJsonObj.lookupCodesListJSON[n.ox.TIME_ZONES],a).then(i=>{if(this.timeZoneOptions=i,this.timeZoneOptions.length>0){for(let t=0;t<this.timeZoneOptions.length;t++)this.timeZoneOptions[t].NAME=this.timeZoneOptions[t].NAME+" - "+this.timeZoneOptions[t].description;this.timeZoneOptions=this.timeZoneOptions}},i=>{this.loggerService.setLoggerError(this.constructor.name,"getTimeZone",i)})}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getTimeZone",i)}}changeTimeZone(a){if(a)try{this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(a.description),this.userTimeZoneObj.timeZoneCode=a.lookup_name;const i=this.displayDateFormatter(this.utccurrentTime,!1,!0);this.startDate=i.startDate;const t=this.commonService.addDaysToDate((new Date).toISOString(),this.diffDays),s=this.displayDateFormatter(t,!1,!0);this.endDate=s.startDate}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeTimeZone",i)}}changeStartDate(a){try{const i=this.displayDateFormatter(a.value,!1,!1);this.startDate=i.startDate}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeStartDate",i)}}changeEndDate(a){try{const i=this.displayDateFormatter(a.value,!1,!1);this.endDate=i.startDate,this.error=this.commonService.getUTCDateObj(this.startDate)>=this.commonService.getUTCDateObj(this.endDate)?"COMMON_VALIDATION_MESSAGES.VALID_NOBLANK_END_DATE_GREATER_START":""}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeEndDate",i)}}getExcelFile(a){if(a){this.error="";const i=a.target.files,s=(document.getElementById("importFile"),a.target.files[0].type),r=s.substring(s.lastIndexOf("/"));this.audioExtensions=this.commonService.getExtension(n.wE),-1==this.audioExtensions.indexOf(r)?(this.error="COMMON_VALIDATION_MESSAGES.VALID_FILETYPE",this.audioFile=""):(this.audioFile=i[0],this.displayFileName(i[0].name))}}displayFileName(a){const i=document.getElementById("importFile");let t=a;null!=t&&""!==t&&t.split(".")[0].length>25&&(t=t.split(".")[0].substring(0,25)+".."+t.split(".")[1]),i.innerHTML=t}getExcelFile1(a){if(a){this.error="";const i=a.target.files,s=(document.getElementById("importFile"),a.target.files[0].type),r=s.substring(s.lastIndexOf("/"));this.videoExtensions=this.commonService.getExtension(n.sc),-1==this.videoExtensions.indexOf(r)?(this.error="COMMON_VALIDATION_MESSAGES.VALID_FILETYPE",this.videoFile=""):(this.videoFile=i[0],this.displayFileName(i[0].name))}}displayFileName1(a){const i=document.getElementById("importFile");let t=a;null!=t&&""!==t&&t.split(".")[0].length>25&&(t=t.split(".")[0].substring(0,25)+".."+t.split(".")[1]),i.innerHTML=t}changeImage(a){""===a.error?(this.imageError="",this.imgFile=a.value):this.imageError=a.error}backgroundImageRemove(){this.beaconImage="",this.imageError=""}validVideoType(){}createRecord(){if((!1===this.beaconPromotionsEnable?this.validFacilityType.isValid()&&this.validFacility.isValid():this.validBeaconName.isValid())&&this.validMessageType.isValid()&&this.validTitle.isValid())if(this.commonService.getUTCDateObj(this.endDate)>=this.commonService.getUTCDateObj(this.startDate)){const a={enterprise:{enterprise_id:this.enterpriseId,enterprise_name:this.enterpriseName,short_name:this.enterpriseShortName},beacon:{beacon_id:this.beaconId,beacon_name:this.beconNameObj?this.beconNameObj.NAME:"",facility_type:{facility_type_id:this.facilityTypeObj?this.facilityTypeObj.ID:"",facility_type_name:this.facilityTypeObj?this.facilityTypeObj.NAME:""},facility:this.facilityObj?this.facilityObj:""},beacon_promotion:this.beaconPromotionsEnable,message_type:this.messageTypeObj,start_datetime:this.commonService.convertUserTimeZoneDateToUTC(this.startDate,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign),end_datetime:this.commonService.convertUserTimeZoneDateToUTC(this.endDate,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign),message_title:this.title};this.imgFile=this.imgFile?this.commonService.dataURItoImgBlob(this.imgFile,"image/jpeg"):"",this.beaconMessagesService.create(a,this.imgFile,this.audioFile,this.videoFile).then(i=>{this.disableSubmitBtn=!1,this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_CREATE"),this.commonService.redirectToPreviousUrl()},i=>{this.commonErrorCodes(JSON.parse(i))})}else this.error="COMMON_VALIDATION_MESSAGES.VALID_NOBLANK_END_DATE_GREATER_START"}displayDateFormatter(a,i,t){try{const s=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,r={startDate:"",endDate:""};if(r.startDate=this.commonService.convertDateToUserFormat(s,n.eZ.HOURS_MINS,!0,"",!1),i){const d=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,c=E.utc(d).add(2,"hours");r.endDate=this.commonService.convertDateToUserFormat(c,n.eZ.HOURS_MINS,!0,"",!1)}return r}catch(s){this.loggerService.setLoggerError(this.constructor.name,"displayDateFormatter",s)}}commonErrorCodes(a){409===JSON.parse(a[n.BU.STATUS])&&(this.error=this.translateService.instant("COMMON_STATUS_CODES.409"))}cancelBtn(){this.commonService.redirectToPreviousUrl()}pageheadeActionClick(a){"BACK"==a.value&&this.cancelBtn()}static \u0275fac=function(i){return new(i||o)(e.Y36(b),e.Y36(D.g),e.Y36(M.m),e.Y36(A.f),e.Y36(u.F0),e.Y36(v.sK),e.Y36(N.s),e.Y36(O.v),e.Y36(W.e),e.Y36(u.gz),e.Y36(S.yF))};static \u0275cmp=e.Xpm({type:o,selectors:[["app-beacon-message-create"]],viewQuery:function(i,t){if(1&i&&(e.Gf(z,5),e.Gf(X,5),e.Gf($,5),e.Gf(ee,5),e.Gf(te,5)),2&i){let s;e.iGM(s=e.CRH())&&(t.validBeaconName=s.first),e.iGM(s=e.CRH())&&(t.validFacility=s.first),e.iGM(s=e.CRH())&&(t.validFacilityType=s.first),e.iGM(s=e.CRH())&&(t.validMessageType=s.first),e.iGM(s=e.CRH())&&(t.validTitle=s.first)}},features:[e._Bn([b,D.g]),e.qOj],decls:50,vars:54,consts:[[1,"container-fluid"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"card-body"],[1,"row","form-bs"],[1,"col-md-4"],["disabled","true","id","beacon-messages-create-enterprise",3,"label","value"],[1,"col-md-4","d-flex","align-items-center"],["label","","mandatory","true","id","beacon-messages-create-checkboxoptions",3,"options","checked","valueChange"],["class","col-md-4",4,"ngIf"],[1,"col-lg-3","col-md-6","datetimepicker"],[1,"row"],[1,"col-8","col-md-8","pe-0"],["mandatory","true","disabled","false","id","reservation-create-start-date",3,"placeholder","dateformat","defaultDate","editvalueChange"],[1,"col-4","col-md-4","ps-2"],["disabled","false","mandatory","true",3,"label","options","defaultValue","selectedOption","searchValueChange"],["mandatory","true","disabled","false","id","reservation-create-end-date",3,"placeholder","defaultDate","dateformat","page","diffDays","editvalueChange"],[1,"col-md-3"],["mandatory","true","id","beacon-mgt-create-status",3,"label","options","valueChange"],["validMessageType",""],["class","col-md-3",4,"ngIf"],[1,"col-md-12","text-end","mt-2","mb-2"],["className","btn btn-primary btn-sm","id","beacon-mgt-create-submit",1,"mgr-5",3,"label","disabled","buttonOnClick"],["className","btn btn-danger btn-sm","id","beacon-mgt-create-cancel",3,"label","buttonOnClick"],[1,"text-danger","text-center"],["disabled","false","mandatory","true","id","beacon-messages-create-beacontype",3,"label","options","valueChange"],["validBeaconName",""],["validFacilityType",""],["validFacility",""],[1,"position-relative"],["type","file","id","excelfile","accept","application/vnd.ms-excel|image/*|video/*|audio/*","name","file-input",1,"form-control",3,"change"],["id","importFile","for","customFile",1,"custom-file-label","input-margin"],["type","file","btnHide","true","action","create","imageid","image1","id","enterprise-create-image",1,"edit-pic",3,"imageRemove","valueChange"],["type","file","id","excelfile","accept","video/*","name","file-input",1,"form-control",3,"change"],["autoCaseFlag","true","mandatory","true","disabled","false","id","beacon-mgt-create-beaconname",3,"label","maxlength","valueChange"],["validTitle",""]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e._UZ(6,"app-pageheader",6),e.qZA(),e.TgZ(7,"div",7)(8,"div",8)(9,"div",9),e._UZ(10,"app-input",10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"div",11)(13,"app-checkbox",12),e.NdJ("valueChange",function(r){return t.getBeaconPromotionEnable(r)}),e.qZA()(),e.YNc(14,ae,4,4,"div",13),e.YNc(15,ie,4,4,"div",13),e.YNc(16,se,4,4,"div",13),e.TgZ(17,"div",14)(18,"div",15)(19,"div",16)(20,"app-datetimepicker",17),e.NdJ("editvalueChange",function(r){return t.changeStartDate(r)}),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"div",18)(23,"app-dropdown-search",19),e.NdJ("selectedOption",function(r){return t.changeTimeZone(r)})("searchValueChange",function(r){return t.getTimeZone(r)}),e.ALo(24,"translate"),e.qZA()()()(),e.TgZ(25,"div",14)(26,"div",15)(27,"div",16)(28,"app-datetimepicker",20),e.NdJ("editvalueChange",function(r){return t.changeEndDate(r)}),e.ALo(29,"translate"),e.qZA()(),e.TgZ(30,"div",18)(31,"app-dropdown-search",19),e.NdJ("selectedOption",function(r){return t.changeTimeZone(r)})("searchValueChange",function(r){return t.getTimeZone(r)}),e.ALo(32,"translate"),e.qZA()()()(),e.TgZ(33,"div",21)(34,"app-dropdown-singleselect",22,23),e.NdJ("valueChange",function(r){return t.changeMessageType(r)}),e.ALo(36,"translate"),e.qZA()(),e.YNc(37,ne,4,0,"div",13),e.YNc(38,oe,2,0,"div",13),e.YNc(39,re,4,0,"div",13),e.YNc(40,le,4,4,"div",24),e.YNc(41,ce,4,4,"div",24),e.TgZ(42,"div",25)(43,"app-button",26),e.NdJ("buttonOnClick",function(){return t.createRecord()}),e.ALo(44,"translate"),e.qZA(),e.TgZ(45,"app-button",27),e.NdJ("buttonOnClick",function(){return t.cancelBtn()}),e.ALo(46,"translate"),e.qZA()()(),e.TgZ(47,"div",28),e._uU(48),e.ALo(49,"translate"),e.qZA()()()()()()()),2&i&&(e.xp6(6),e.Q6J("pageName",t.dataJsonObj.pageName)("pageTitle",t.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),e.xp6(4),e.s9C("label",e.lcZ(11,36,"COMMON_PAGE_TITLES.ENTERPRISE")),e.s9C("value",t.enterpriseShortName),e.xp6(3),e.Q6J("options",t.checkboxOptions)("checked",t.beaconPromotionsEnable),e.xp6(1),e.Q6J("ngIf",!0===t.beconName),e.xp6(1),e.Q6J("ngIf",!1===t.beconName),e.xp6(1),e.Q6J("ngIf",!1===t.beconName),e.xp6(4),e.s9C("placeholder",e.lcZ(21,38,"COMMON_FIELDS.START_DATE")),e.Q6J("dateformat",t.loginUserDateFormat)("defaultDate",t.startDate),e.xp6(3),e.s9C("label",e.lcZ(24,40,"PREFERENCES.TIMEZONE")),e.s9C("defaultValue",t.userTimeZoneObj.timeZoneCode),e.Q6J("options",t.timeZoneOptions),e.xp6(5),e.s9C("placeholder",e.lcZ(29,42,"COMMON_FIELDS.END_DATE")),e.s9C("page",t.pageName),e.s9C("diffDays",t.diffDays),e.Q6J("defaultDate",t.endDate)("dateformat",t.loginUserDateFormat),e.xp6(3),e.s9C("label",e.lcZ(32,44,"PREFERENCES.TIMEZONE")),e.s9C("defaultValue",t.userTimeZoneObj.timeZoneCode),e.Q6J("options",t.timeZoneOptions),e.xp6(3),e.s9C("label",e.lcZ(36,46,"NEW_VARIABLES.MESSAGE_TYPE")),e.Q6J("options",t.messageTypeOptions),e.xp6(3),e.Q6J("ngIf",!0===t.audioUpload),e.xp6(1),e.Q6J("ngIf",!0===t.imageUpload),e.xp6(1),e.Q6J("ngIf",!0===t.videoUpload),e.xp6(1),e.Q6J("ngIf",!1===t.textEnable),e.xp6(1),e.Q6J("ngIf",!0===t.textEnable),e.xp6(2),e.s9C("label",e.lcZ(44,48,"COMMON_BUTTONS.BUTTON_SUBMIT")),e.s9C("disabled",t.disableSubmitBtn),e.xp6(2),e.s9C("label",e.lcZ(46,50,"COMMON_BUTTONS.BUTTON_CANCEL")),e.xp6(3),e.hij(" ",e.lcZ(49,52,t.error)," "))},dependencies:[I.O5,F.r,B.a,P.k,j.b,U.f,R.L,V.C,Z.q,v.X$]})}return o})();var k=l(11735);const pe=["validBeaconName"],me=["validFacility"],he=["validFacilityType"],ge=["validMessageType"],ue=["validTitle"];function be(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-dropdown-singleselect",32,33),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeBeaconName(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"NEW_VARIABLES.BEACON_NAME")),e.s9C("defaultValue",null==a.viewData||null==a.viewData.beacon?null:a.viewData.beacon.beacon_id),e.Q6J("options",a.beconOptions)}}function ve(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-dropdown-singleselect",32,34),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeFacilityType(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"NEW_VARIABLES.ASSET_TYPE")),e.s9C("defaultValue",a.facilityTypeId),e.Q6J("options",a.facilityTypeOptions)}}function fe(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-dropdown-singleselect",32,35),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeFacility(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"RESERVATIONS.ASSET")),e.s9C("defaultValue",a.facilityId),e.Q6J("options",a.facilityOptions)}}function _e(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"div",36)(2,"input",37),e.NdJ("change",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.getExcelFile(t))}),e.qZA(),e._UZ(3,"label",38),e.qZA()()}}function Te(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"app-imageupload",39),e.NdJ("imageRemove",function(){e.CHM(a);const t=e.oxw();return e.KtG(t.backgroundImageRemove())})("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeImage(t))})("deleteClick",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.deleteImgClick(t))}),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("defaultImage",a.imgFilepath),e.Q6J("enableImageDelete",a.enableImageDeleteValue)}}function ye(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",9)(1,"div",36)(2,"input",40),e.NdJ("change",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.getExcelFile1(t))}),e.qZA(),e._UZ(3,"label",38),e.qZA()()}}function Se(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",21)(1,"app-input",41,42),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeTitle(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"NEW_VARIABLES.TITLE")),e.s9C("value",null==a.viewData?null:a.viewData.message_title),e.Q6J("maxlength",30)}}function Ee(o,m){if(1&o){const a=e.EpF();e.TgZ(0,"div",21)(1,"app-input",41,42),e.NdJ("valueChange",function(t){e.CHM(a);const s=e.oxw();return e.KtG(s.changeTitle(t))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"COMMON_PAGE_TITLES.MESSAGE")),e.s9C("value",null==a.viewData?null:a.viewData.message_title),e.Q6J("maxlength",30)}}let Oe=(()=>{class o extends C.O{apiEndPointUrl;beaconMessagesService;facilitiesService;loggerService;navigationService;router;translateService;uiUtils;commonService;route;toastController;validBeaconName;validFacility;validFacilityType;validMessageType;validTitle;apiEndPoint;audioFile;audioUpload=!1;beaconDisplayName;beaconId;beaconImage;beaconMessageEditObj;beaconPromotionsEnable=!1;beconName;beconNameObj;beconOptions;checkboxOptions;defaultTimeZone;diffDays=1;disableSubmitBtn=!1;endDate;enterpriseId;enterpriseObj;error;facilityId;facilityName;facilityObj;facilityOptions;facilityTypeName;facilityTypeId;facilityTypeObj;facilityTypeOptions;headerAction;imageError;imageUpload=!1;imgFile;imgFilepath;loginUserDateFormat;messageTypeDisplayName;messageTypeId;messageTypeObj;messageTypeOptions;pageName=n.sn.BEACON_MESSAGES;recordId;startDate;textEnable=!1;timeZoneOptions;title;url;userTimeZoneObj={};utcTimeZoneString;utctimezone;videoFile;videoUpload;viewData;dataJsonObj={};audioExtensions=[];videoExtensions=[];enableImageDeleteValue;constructor(a,i,t,s,r,d,c,p,h,g,f){super(g,h),this.apiEndPointUrl=a,this.beaconMessagesService=i,this.facilitiesService=t,this.loggerService=s,this.navigationService=r,this.router=d,this.translateService=c,this.uiUtils=p,this.commonService=h,this.route=g,this.toastController=f}ngOnInit(){this.headerAction={BACK:!0},this.initializeComponent(),this.checkboxOptions=[{value:"",displayname:this.translateService.instant("NEW_VARIABLES.BEACON_PROMOTIONS"),key:"checkbox1"}],this.route.params.subscribe(a=>{this.recordId=a.id,this.getRecordById(),this.getFacility()}),this.enableImageDeleteValue=!0,this.apiEndPoint=localStorage.getItem(n.BU.S3_URL)?localStorage.getItem(n.BU.S3_URL):this.apiEndPointUrl}initializeComponent(){this.dataJsonObj.pageName=n.hf.BEACON_MESSAGES,this.dataJsonObj.showrecordhistory=this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.RECORD_HISTORY),this.dataJsonObj.pageTitle=[{key:"COMMON_PAGE_TITLES.BEACON_MESSAGE",value:"",showSubMenuDisplayName:!1},{key:"",value:"-",showSubMenuDisplayName:!1},{key:"COMMON_BUTTONS.BUTTON_EDIT",value:"",showSubMenuDisplayName:!1}],this.enterpriseId=localStorage.getItem(n.BU.SELECTED_ENTERPRISE),this.getDynamicJson([{folderName:n.sb.FACILITY_TYPES,jsonType:"list",storingFieldName:"facilityTypesListJson"}]),this.commonService.getLookupCodesListJson(this.enterpriseId,"list").then(i=>{this.dataJsonObj.lookupCodesListJSON=i,this.getMessageTypes();const t=this.commonService.getLoginUserTimeZoneDateFormat();this.loginUserDateFormat=t.dateFormat,this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(t.timeZoneDescription),this.userTimeZoneObj.timeZoneCode=t.timeZoneCode,this.getTimeZone(this.userTimeZoneObj.timeZoneCode)})}getDynamicJson(a){var i=this;return(0,y.Z)(function*(){for(let t of a)i.dataJsonObj[t.storingFieldName]=yield i.commonService.getDynamicJson(i.enterpriseId,t.folderName,t.jsonType);i.getFacilityTypes("")})()}getRecordById(){this.beaconMessagesService.get(this.recordId).subscribe(a=>{this.viewData=a,this.enterpriseId=this.viewData.enterprise.enterprise_id,this.enterpriseObj=this.viewData.enterprise,this.beaconPromotionsEnable=this.viewData.beacon_promotion,this.facilityTypeObj=this.viewData.beacon.facility_type?this.viewData.beacon.facility_type:"",this.facilityTypeId=this.viewData.beacon.facility_type?this.viewData.beacon.facility_type.facility_type_id:"",this.facilityTypeName=this.viewData.beacon.facility_type?this.viewData.beacon.facility_type.facility_type_name:"",this.getFacility(),this.facilityObj=this.viewData.facility,this.facilityId=this.viewData.beacon.facility?this.viewData.beacon.facility.facility_id:"",this.facilityName=this.viewData.beacon.facility?this.viewData.beacon.facility.facility_name:"",!0===this.viewData.beacon_promotion?(this.beconName=!0,this.getBeconName()):this.beconName=!1,this.beconNameObj=this.viewData.beacon,this.beaconId=this.viewData.beacon.beacon_id,this.messageTypeObj=this.viewData.message_type,this.title=this.viewData.message_title;const i=this.displayDateFormatter(this.viewData.start_datetime,!1,!0);this.startDate=i.startDate;const t=this.displayDateFormatter(this.viewData.end_datetime,!1,!0);this.endDate=t.startDate,this.imgFilepath=this.viewData.message_file_path&&this.viewData.message_file_name?this.apiEndPoint+this.viewData.message_file_path+"/"+this.viewData.message_file_name:"",this.viewData.message_type.lookup_name===n.V8.TEXT?(this.videoUpload=!1,this.audioUpload=!1,this.imageUpload=!1,this.textEnable=!0,this.audioFile="",this.imgFile="",this.imgFilepath="",this.videoFile=""):this.viewData.message_type.lookup_name===n.V8.IMAGE?(this.imageUpload=!0,this.audioUpload=!1,this.videoUpload=!1,this.textEnable=!1,this.audioFile="",this.videoFile="",this.title=""):this.viewData.message_type.lookup_name===n.V8.AUDIO?(this.audioUpload=!0,this.imageUpload=!1,this.videoUpload=!1,this.textEnable=!1,this.videoFile="",this.imgFile="",this.imgFilepath="",this.title="",setTimeout(()=>{this.displayFileName(this.viewData.message_file_name)},500)):this.viewData.message_type.lookup_name===n.V8.VIDEO&&(this.videoUpload=!0,this.audioUpload=!1,this.imageUpload=!1,this.textEnable=!1,this.audioFile="",this.imgFile="",this.imgFilepath="",this.title="",setTimeout(()=>{this.displayFileName1(this.viewData.message_file_name)},500))})}getBeaconPromotionEnable(a){this.beaconPromotionsEnable=a.value,!0===this.beaconPromotionsEnable?(this.beconName=!0,this.getBeconName(),this.facilityId="",this.facilityTypeId="",this.facilityName="",this.facilityTypeName=""):(this.beconName=!1,this.beconNameObj="",this.beaconId="")}changeTitle(a){this.title=a.value}getBeconName(){try{this.beaconMessagesService.getbeconName(this.enterpriseId).then(a=>{this.beconOptions=a,this.beconNameObj=a[0]},a=>{this.loggerService.setLoggerError(this.constructor.name,"getBeconName",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getBeconName",a)}}changeBeaconName(a){this.beaconId=a.value,this.beconNameObj=this.beconOptions.find(i=>i.ID===parseInt(this.beaconId,10))}getFacilityTypes(a){try{this.facilityTypeOptions=[],this.commonService.getFilteredDynamicJSONData(this.dataJsonObj.facilityTypesListJson,"facility_type_display_name",a).then(i=>{this.facilityTypeOptions=i,this.facilityTypeOptions?.length>0&&(this.facilityTypeObj=i[0],this.facilityTypeName=i?i[0].facility_type_name:"")}).catch(i=>{this.loggerService.setLoggerError(this.constructor.name,"getFilteredDynamicJSONData",i)})}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getFacilityTypes",i)}}changeFacilityType(a){this.facilityTypeId=a.value,this.facilityTypeObj=this.facilityTypeOptions.find(i=>i.ID===parseInt(this.facilityTypeId,10)),this.facilityTypeName=this.facilityTypeObj.facility_type_name,this.facilityId="",this.facilityName="",this.getFacility()}getMessageTypes(){try{this.commonService.getFilteredLookupCodes(this.dataJsonObj.lookupCodesListJSON[n.ox.MESSAGE_TYPES],"").then(a=>{this.messageTypeOptions=a,this.messageTypeDisplayName=this.lookupLanguageTranslations(a[0].lookup_id)},a=>{this.loggerService.setLoggerError(this.constructor.name,"getMessageTypes",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getMessageTypes",a)}}changeMessageType(a){this.messageTypeId=a.value,this.messageTypeObj=this.messageTypeOptions.find(i=>i.ID===parseInt(this.messageTypeId,10)),this.messageTypeDisplayName=this.lookupLanguageTranslations(this.messageTypeObj.lookup_id),this.messageTypeObj.lookup_name===n.V8.AUDIO?(this.audioUpload=!0,this.imageUpload=!1,this.videoUpload=!1,this.textEnable=!1,this.videoFile="",this.imgFile="",this.title=""):this.messageTypeObj.lookup_name===n.V8.IMAGE?(this.imageUpload=!0,this.audioUpload=!1,this.videoUpload=!1,this.textEnable=!1,this.audioFile="",this.videoFile="",this.imgFilepath="",this.title=""):this.messageTypeObj.lookup_name===n.V8.VIDEO?(this.videoUpload=!0,this.audioUpload=!1,this.imageUpload=!1,this.textEnable=!1,this.audioFile="",this.imgFile="",this.title=""):this.messageTypeObj.lookup_name===n.V8.TEXT&&(this.videoUpload=!1,this.audioUpload=!1,this.imageUpload=!1,this.textEnable=!0,this.audioFile="",this.imgFile="",this.videoFile="")}getFacility(){try{this.beaconMessagesService.getParentFacility(this.enterpriseId,this.facilityTypeName).then(a=>{this.facilityOptions=a},a=>{this.loggerService.setLoggerError(this.constructor.name,"getFacility",a)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getFacility",a)}}changeFacility(a){try{this.facilityId=a.value,this.facilityObj=this.facilityOptions.find(i=>i.ID===parseInt(this.facilityId,10)),this.facilityName=this.facilityObj.facility_name}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeFacility",i)}}getTimeZone(a){try{this.commonService.getFilteredLookupCodes(this.dataJsonObj.lookupCodesListJSON[n.ox.TIME_ZONES],a).then(i=>{if(this.timeZoneOptions=i,this.timeZoneOptions.length>0){for(let t=0;t<this.timeZoneOptions.length;t++)this.timeZoneOptions[t].NAME=this.timeZoneOptions[t].NAME+" - "+this.timeZoneOptions[t].description;this.timeZoneOptions=this.timeZoneOptions}},i=>{this.loggerService.setLoggerError(this.constructor.name,"getTimeZone",i)})}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getTimeZone",i)}}changeTimeZone(a){if(a)try{this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(a.description),this.userTimeZoneObj.timeZoneCode=a.lookup_name}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeTimeZone",i)}}changeStartDate(a){try{const i=this.displayDateFormatter(a.value,!1,!1);this.startDate=i.startDate,this.error=""}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeStartDate",i)}}changeEndDate(a){try{const i=this.displayDateFormatter(a.value,!1,!1);this.endDate=i.startDate,this.error=this.commonService.getUTCDateObj(this.startDate)<this.commonService.getUTCDateObj(this.endDate)?"":"COMMON_VALIDATION_MESSAGES.VALID_NOBLANK_END_DATE_GREATER_START"}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeEndDate",i)}}getExcelFile(a){if(a){this.error="";const i=a.target.files,s=(document.getElementById("importFile"),a.target.files[0].type),r=s.substring(s.lastIndexOf("/"));this.audioExtensions=this.commonService.getExtension(n.wE),-1==this.audioExtensions.indexOf(r)?(this.error="COMMON_VALIDATION_MESSAGES.VALID_FILETYPE",this.audioFile=""):(this.audioFile=i[0],this.displayFileName(i[0].name))}}displayFileName(a){const i=document.getElementById("importFile");let t=a;null!=t&&""!==t&&t.split(".")[0].length>25&&(t=t.split(".")[0].substring(0,25)+".."+t.split(".")[1]),i.innerHTML=t}getExcelFile1(a){if(a){this.error="";const i=a.target.files,s=(document.getElementById("importFile"),a.target.files[0].type),r=s.substring(s.lastIndexOf("/"));this.videoExtensions=this.commonService.getExtension(n.sc),-1==this.videoExtensions.indexOf(r)?(this.error="COMMON_VALIDATION_MESSAGES.VALID_FILETYPE",this.videoFile=""):(this.videoFile=i[0],this.displayFileName1(i[0].name))}}displayFileName1(a){const i=document.getElementById("importFile");let t=a;null!=t&&""!==t&&t.split(".")[0].length>25&&(t=t.split(".")[0].substring(0,25)+".."+t.split(".")[1]),i.innerHTML=t}changeImage(a){this.imgFile=a.value}backgroundImageRemove(){this.beaconImage="",this.imageError=""}deleteImgClick(a){a.value==n.A0.DELETE&&(this.viewData.message_file_path="")}updateRecord(){if((!1===this.beaconPromotionsEnable?this.validFacilityType.isValid()&&this.validFacility.isValid():this.validBeaconName.isValid())&&this.validMessageType.isValid()&&this.validTitle.isValid())if(this.commonService.getUTCDateObj(this.endDate)>=this.commonService.getUTCDateObj(this.startDate)){const a={enterprise:this.enterpriseObj,beacon_promotion:this.beaconPromotionsEnable,message_type:this.messageTypeObj,beacon:{beacon_id:this.beaconId,beacon_name:this.beconNameObj?this.beconNameObj.beacon_name:"",facility_type:{facility_type_id:this.facilityTypeId,facility_type_name:this.facilityTypeName},facility:{facility_id:this.facilityId,facility_name:this.facilityName}},start_datetime:this.commonService.convertUserTimeZoneDateToUTC(this.startDate,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign),end_datetime:this.commonService.convertUserTimeZoneDateToUTC(this.endDate,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign),original_message_file_name:this.viewData.message_file_name,original_message_thumbnail_path:this.viewData.message_thumbnail_path,message_file_name:this.viewData.message_file_name,message_file_path:this.viewData.message_file_path,message_title:this.title};this.imgFile=this.imgFile?this.commonService.dataURItoImgBlob(this.imgFile,"image/jpeg"):"",this.beaconMessagesService.update(a,this.recordId,this.imgFile,this.audioFile,this.videoFile).then(i=>{this.disableSubmitBtn=!1,this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_EDIT"),this.commonService.redirectToPreviousUrl()},i=>{this.commonErrorCodes(JSON.parse(i))})}else this.error="COMMON_VALIDATION_MESSAGES.VALID_NOBLANK_END_DATE_GREATER_START"}displayDateFormatter(a,i,t){try{const s=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,r={startDate:"",endDate:""};if(r.startDate=this.commonService.convertDateToUserFormat(s,n.eZ.HOURS_MINS,!0,"",!1),i){const d=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,c=E.utc(d).add(2,"hours");r.endDate=this.commonService.convertDateToUserFormat(c,n.eZ.HOURS_MINS,!0,"",!1)}return r}catch(s){this.loggerService.setLoggerError(this.constructor.name,"displayDateFormatter",s)}}commonErrorCodes(a){409===JSON.parse(a[n.BU.STATUS])&&(this.error=this.translateService.instant("COMMON_STATUS_CODES.409"))}cancelBtn(){this.commonService.redirectToPreviousUrl()}pageheadeActionClick(a){"BACK"==a.value&&this.cancelBtn()}static \u0275fac=function(i){return new(i||o)(e.Y36("apiEndPoint"),e.Y36(b),e.Y36(D.g),e.Y36(M.m),e.Y36(A.f),e.Y36(u.F0),e.Y36(v.sK),e.Y36(N.s),e.Y36(O.v),e.Y36(u.gz),e.Y36(S.yF))};static \u0275cmp=e.Xpm({type:o,selectors:[["app-beacon-message-edit"]],viewQuery:function(i,t){if(1&i&&(e.Gf(pe,5),e.Gf(me,5),e.Gf(he,5),e.Gf(ge,5),e.Gf(ue,5)),2&i){let s;e.iGM(s=e.CRH())&&(t.validBeaconName=s.first),e.iGM(s=e.CRH())&&(t.validFacility=s.first),e.iGM(s=e.CRH())&&(t.validFacilityType=s.first),e.iGM(s=e.CRH())&&(t.validMessageType=s.first),e.iGM(s=e.CRH())&&(t.validTitle=s.first)}},features:[e._Bn([b,D.g,A.f]),e.qOj],decls:57,vars:60,consts:[[1,"container-fluid"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"card-body"],[1,"row","form-bs"],[1,"col-md-4"],["disabled","true","id","beacon-messages-create-enterprise",3,"label","value"],[1,"col-md-4","d-flex","align-items-center"],["label","","mandatory","true","id","beacon-messages-create-checkboxoptions",3,"options","checked","valueChange"],["class","col-md-4",4,"ngIf"],[1,"col-lg-3","col-md-6","datetimepicker"],[1,"row"],[1,"col-8","col-md-8","pe-0"],["mandatory","true","disabled","false","id","reservation-create-start-date",3,"placeholder","dateformat","defaultDate","editvalueChange"],[1,"col-4","col-md-4","ps-2"],["disabled","false","mandatory","true",3,"label","options","defaultValue","selectedOption","searchValueChange"],["mandatory","true","disabled","false","id","reservation-create-end-date",3,"placeholder","defaultDate","dateformat","page","diffDays","editvalueChange"],[1,"col-md-3"],["mandatory","true","id","beacon-mgt-create-status",3,"label","options","defaultValue","valueChange"],["validMessageType",""],["class","col-md-3",4,"ngIf"],[1,"col-md-12","text-end","mt-2","mb-2"],["className","btn btn-primary btn-sm","id","beacon-mgt-create-submit",1,"mgr-5",3,"label","disabled","buttonOnClick"],["className","btn btn-danger btn-sm","id","beacon-mgt-create-cancel",3,"label","buttonOnClick"],[1,"text-danger","text-center"],[1,"card"],[1,"card-content"],[3,"createdBy","lastUpdatedBy","showrecordhistory","creationDate","lastUpdatedDate"],["disabled","false","mandatory","true","id","beacon-messages-create-beacontype",3,"label","options","defaultValue","valueChange"],["validBeaconName",""],["validFacilityType",""],["validFacility",""],[1,"position-relative"],["type","file","id","excelfile","accept","video/*|audio/*","name","file-input",1,"form-control",3,"change"],["id","importFile","for","customFile",1,"custom-file-label","input-margin"],["type","file","btnHide","true","action","create","imageid","image1","id","enterprise-create-image",1,"edit-pic",3,"enableImageDelete","defaultImage","imageRemove","valueChange","deleteClick"],["type","file","id","excelfile","accept","video/*","name","file-input",1,"form-control",3,"change"],["autoCaseFlag","true","mandatory","true","disabled","false","id","beacon-mgt-create-beaconname",3,"label","maxlength","value","valueChange"],["validTitle",""]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e._UZ(6,"app-pageheader",6),e.qZA(),e.TgZ(7,"div",7)(8,"div",8)(9,"div",9),e._UZ(10,"app-input",10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"div",11)(13,"app-checkbox",12),e.NdJ("valueChange",function(r){return t.getBeaconPromotionEnable(r)}),e.qZA()(),e.YNc(14,be,4,5,"div",13),e.YNc(15,ve,4,5,"div",13),e.YNc(16,fe,4,5,"div",13),e.TgZ(17,"div",14)(18,"div",15)(19,"div",16)(20,"app-datetimepicker",17),e.NdJ("editvalueChange",function(r){return t.changeStartDate(r)}),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"div",18)(23,"app-dropdown-search",19),e.NdJ("selectedOption",function(r){return t.changeTimeZone(r)})("searchValueChange",function(r){return t.getTimeZone(r)}),e.ALo(24,"translate"),e.qZA()()()(),e.TgZ(25,"div",14)(26,"div",15)(27,"div",16)(28,"app-datetimepicker",20),e.NdJ("editvalueChange",function(r){return t.changeEndDate(r)}),e.ALo(29,"translate"),e.qZA()(),e.TgZ(30,"div",18)(31,"app-dropdown-search",19),e.NdJ("selectedOption",function(r){return t.changeTimeZone(r)})("searchValueChange",function(r){return t.getTimeZone(r)}),e.ALo(32,"translate"),e.qZA()()()(),e.TgZ(33,"div",21)(34,"app-dropdown-singleselect",22,23),e.NdJ("valueChange",function(r){return t.changeMessageType(r)}),e.ALo(36,"translate"),e.qZA()(),e.YNc(37,_e,4,0,"div",13),e.YNc(38,Te,2,2,"div",13),e.YNc(39,ye,4,0,"div",13),e.YNc(40,Se,4,5,"div",24),e.YNc(41,Ee,4,5,"div",24),e.TgZ(42,"div",25)(43,"app-button",26),e.NdJ("buttonOnClick",function(){return t.updateRecord()}),e.ALo(44,"translate"),e.qZA(),e.TgZ(45,"app-button",27),e.NdJ("buttonOnClick",function(){return t.cancelBtn()}),e.ALo(46,"translate"),e.qZA()()(),e.TgZ(47,"div",15)(48,"div",28),e._uU(49),e.ALo(50,"translate"),e.qZA()(),e.TgZ(51,"div",15)(52,"div",3)(53,"div",29)(54,"div",30)(55,"p-accordion"),e._UZ(56,"app-recordhistory",31),e.qZA()()()()()()()()()()()),2&i&&(e.xp6(6),e.Q6J("pageName",t.dataJsonObj.pageName)("pageTitle",t.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),e.xp6(4),e.s9C("label",e.lcZ(11,42,"COMMON_PAGE_TITLES.ENTERPRISE")),e.s9C("value",null==t.viewData||null==t.viewData.enterprise?null:t.viewData.enterprise.short_name),e.xp6(3),e.Q6J("options",t.checkboxOptions)("checked",t.beaconPromotionsEnable),e.xp6(1),e.Q6J("ngIf",!0===t.beconName),e.xp6(1),e.Q6J("ngIf",!1===t.beconName),e.xp6(1),e.Q6J("ngIf",!1===t.beconName),e.xp6(4),e.s9C("placeholder",e.lcZ(21,44,"COMMON_FIELDS.START_DATE")),e.Q6J("dateformat",t.loginUserDateFormat)("defaultDate",t.startDate),e.xp6(3),e.s9C("label",e.lcZ(24,46,"PREFERENCES.TIMEZONE")),e.s9C("defaultValue",t.userTimeZoneObj.timeZoneCode),e.Q6J("options",t.timeZoneOptions),e.xp6(5),e.s9C("placeholder",e.lcZ(29,48,"COMMON_FIELDS.END_DATE")),e.s9C("page",t.pageName),e.s9C("diffDays",t.diffDays),e.Q6J("defaultDate",t.endDate)("dateformat",t.loginUserDateFormat),e.xp6(3),e.s9C("label",e.lcZ(32,50,"PREFERENCES.TIMEZONE")),e.s9C("defaultValue",t.userTimeZoneObj.timeZoneCode),e.Q6J("options",t.timeZoneOptions),e.xp6(3),e.s9C("label",e.lcZ(36,52,"NEW_VARIABLES.MESSAGE_TYPE")),e.s9C("defaultValue",null==t.viewData||null==t.viewData.message_type?null:t.viewData.message_type.lookup_id),e.Q6J("options",t.messageTypeOptions),e.xp6(3),e.Q6J("ngIf",!0===t.audioUpload),e.xp6(1),e.Q6J("ngIf",!0===t.imageUpload),e.xp6(1),e.Q6J("ngIf",!0===t.videoUpload),e.xp6(1),e.Q6J("ngIf",!1===t.textEnable),e.xp6(1),e.Q6J("ngIf",!0===t.textEnable),e.xp6(2),e.s9C("label",e.lcZ(44,54,"COMMON_BUTTONS.BUTTON_SUBMIT")),e.s9C("disabled",t.disableSubmitBtn),e.xp6(2),e.s9C("label",e.lcZ(46,56,"COMMON_BUTTONS.BUTTON_CANCEL")),e.xp6(4),e.hij(" ",e.lcZ(50,58,t.error)," "),e.xp6(7),e.Q6J("createdBy",null==t.viewData?null:t.viewData.created_by)("lastUpdatedBy",null==t.viewData?null:t.viewData.updated_by)("showrecordhistory",t.dataJsonObj.showrecordhistory)("creationDate",null==t.viewData?null:t.viewData.createdAt)("lastUpdatedDate",null==t.viewData?null:t.viewData.updatedAt))},dependencies:[w.UQ,I.O5,F.r,B.a,P.k,j.b,U.f,R.L,V.C,k.W,Z.q,v.X$]})}return o})();function Ce(o,m){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-input",23),e.ALo(2,"translate"),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(2,2,"NEW_VARIABLES.BEACON_NAME")),e.s9C("value",null==a.viewData||null==a.viewData.beacon?null:a.viewData.beacon.beacon_name)}}function De(o,m){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-input",24),e.ALo(2,"translate"),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(2,2,"NEW_VARIABLES.ASSET_TYPE")),e.s9C("value",null==a.viewData||null==a.viewData.beacon||null==a.viewData.beacon.facility_type?null:a.viewData.beacon.facility_type.facility_type_name)}}function Me(o,m){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-input",25),e.ALo(2,"translate"),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(2,2,"RESERVATIONS.ASSET")),e.s9C("value",null==a.viewData||null==a.viewData.beacon||null==a.viewData.beacon.facility?null:a.viewData.beacon.facility.facility_name)}}function Ae(o,m){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-input",26),e.ALo(2,"translate"),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(2,2,"NEW_VARIABLES.TITLE")),e.s9C("value",null==a.viewData?null:a.viewData.message_title)}}function Ne(o,m){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-input",27),e.ALo(2,"translate"),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(2,2,"COMMON_PAGE_TITLES.MESSAGE")),e.s9C("value",null==a.viewData?null:a.viewData.message_title)}}function Ie(o,m){if(1&o&&(e.TgZ(0,"div",9),e._UZ(1,"app-imageupload",28),e.qZA()),2&o){const a=e.oxw();e.xp6(1),e.s9C("defaultImage",a.imgFilepath)}}function Ze(o,m){1&o&&(e.TgZ(0,"div",9)(1,"div",29),e._UZ(2,"input",30)(3,"label",31),e.qZA()())}let G=(()=>{class o extends C.O{apiEndPointUrl;beaconMessagesService;loggerService;navigationService;router;translateService;uiUtils;commonService;route;toastController;apiEndPoint;beaconPromotionsEnable=!1;checkboxOptions;defaultTimeZone;endDate;imgFilepath;loginUserDateFormat;recordId;showAudio=!1;showImage=!1;showMessage=!1;startDate;url;userTimeZoneObj={};utcTimeZoneString;viewData;dataJsonObj={};constructor(a,i,t,s,r,d,c,p,h,g){super(h,p),this.apiEndPointUrl=a,this.beaconMessagesService=i,this.loggerService=t,this.navigationService=s,this.router=r,this.translateService=d,this.uiUtils=c,this.commonService=p,this.route=h,this.toastController=g}ngOnInit(){this.initializeComponent(),this.checkboxOptions=[{value:"",displayname:this.translateService.instant("NEW_VARIABLES.BEACON_PROMOTIONS"),key:"checkbox1"}]}nagAfterContentInit(){}initializeComponent(){this.dataJsonObj.pageName=n.hf.BEACON_MESSAGES,this.dataJsonObj.pageTitle=[{key:"COMMON_PAGE_TITLES.BEACON_MESSAGE",value:"",showSubMenuDisplayName:!1},{key:"",value:"-",showSubMenuDisplayName:!1},{key:"COMMON_BUTTONS.BUTTON_VIEW",value:"",showSubMenuDisplayName:!1}];const a=this.commonService.getLoginUserTimeZoneDateFormat();this.loginUserDateFormat=a.dateFormat,this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(a.timeZoneDescription),this.userTimeZoneObj.timeZoneCode=a.timeZoneCode,this.url=this.router.url.split("/")[4],this.route.params.subscribe(s=>{this.recordId=s.id,this.getRecordById()}),this.dataJsonObj.showrecordhistory=this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.RECORD_HISTORY),this.apiEndPoint=localStorage.getItem(n.BU.S3_URL)?localStorage.getItem(n.BU.S3_URL):this.apiEndPointUrl;const i=JSON.parse(localStorage.getItem(n.BU.ENTERPRISE));this.dataJsonObj.enterpriseId=i.enterprise_id,this.dataJsonObj.selectedPage=n.hf.BEACON_MESSAGES,this.getDynamicJson([{folderName:"menu_manager",jsonType:"",storingFieldName:"menuDataJson"}])}getDynamicJson(a){var i=this;return(0,y.Z)(function*(){for(let t of a)i.dataJsonObj[t.storingFieldName]=yield i.commonService.getDynamicJson(i.dataJsonObj.enterpriseId,t.folderName,t.jsonType);i.dataJsonObj.selectedObj={},i.dataJsonObj.selectedObj.recordId=i.recordId,i.dataJsonObj.selectedObj.pageObj=i.dataJsonObj.menuDataJson.filter(t=>t.menu_page.page_name===i.dataJsonObj.selectedPage),i.dataJsonObj.selectedObjEnabled=!0})()}getRecordById(){try{this.beaconMessagesService.get(this.recordId).subscribe(a=>{this.viewData=a;const i=this.displayDateFormatter(this.viewData.start_datetime,!1,!0);this.startDate=i.startDate;const t=this.displayDateFormatter(this.viewData.end_datetime,!1,!0);this.endDate=t.startDate,this.viewData.start_datetime=this.startDate+" "+this.userTimeZoneObj.timeZoneCode,this.viewData.end_datetime=this.endDate+" "+this.userTimeZoneObj.timeZoneCode,this.beaconPromotionsEnable=!0===this.viewData.message_description,this.viewData.message_type.lookup_name===n.V8.TEXT?(this.showMessage=!0,this.showImage=!1,this.showAudio=!1):this.viewData.message_type.lookup_name===n.V8.IMAGE?(this.showImage=!0,this.showMessage=!1,this.showAudio=!1):(this.viewData.message_type.lookup_name===n.V8.AUDIO||this.viewData.message_type.lookup_name===n.V8.VIDEO)&&(this.showAudio=!0,this.showMessage=!1,this.showImage=!1),this.imgFilepath=this.viewData.message_file_path&&this.viewData.message_file_name?this.apiEndPoint+this.viewData.message_file_path+"/"+this.viewData.message_file_name:"",setTimeout(()=>{this.displayFileNameAudio(this.viewData.message_file_name?this.viewData.message_file_name:"")},500)})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"getRecordById",a)}}displayFileNameAudio(a){try{const i=document.getElementById("importFile");let t=a;null!=t&&""!==t&&t.split(".")[0].length>25&&(t=t.split(".")[0].substring(0,25)+".."+t.split(".")[1]),i.innerHTML=t}catch(i){this.loggerService.setLoggerError(this.constructor.name,"displayFileNameAudio",i)}}cancelBtn(){this.commonService.redirectToPreviousUrl()}displayDateFormatter(a,i,t){try{const s=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,r={startDate:"",endDate:""};if(r.startDate=this.commonService.convertDateToUserFormat(s,n.eZ.HOURS_MINS,!0,"",!1),i){const d=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,c=E.utc(d).add(2,"hours");r.endDate=this.commonService.convertDateToUserFormat(c,n.eZ.HOURS_MINS,!0,"",!1)}return r}catch(s){this.loggerService.setLoggerError(this.constructor.name,"displayDateFormatter",s)}}static \u0275fac=function(i){return new(i||o)(e.Y36("apiEndPoint"),e.Y36(b),e.Y36(M.m),e.Y36(A.f),e.Y36(u.F0),e.Y36(v.sK),e.Y36(N.s),e.Y36(O.v),e.Y36(u.gz),e.Y36(S.yF))};static \u0275cmp=e.Xpm({type:o,selectors:[["app-beacon-message-view"]],features:[e._Bn([b]),e.qOj],decls:39,vars:39,consts:[[1,"container-fluid"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"card-body"],[1,"row","form-bs"],[1,"col-md-4"],["disabled","true","id","beacon-messages-view-enterprise",3,"label","value"],[1,"col-md-4","d-flex","align-items-center"],["label","","disabled","true","mandatory","true","id","beacon-messages-create-checkboxoptions",3,"options","checked"],["class","col-md-4",4,"ngIf"],["mandatory","true","disabled","true","id","iotevents-view-start_date",3,"label","value"],["mandatory","true","disabled","true","id","iotevents-view-end_date",3,"label","value"],["disabled","true","id","lookupcode-view-owner",3,"label","value"],[1,"col-md-12","text-end","mt-2","mb-2"],["className","btn btn-danger btn-sm","id","lookupcode-view-close",3,"label","buttonOnClick"],[1,"row"],[1,"card"],[1,"card-content"],[3,"createdBy","lastUpdatedBy","showrecordhistory","creationDate","lastUpdatedDate"],["disabled","true","id","beacon-messages-view-beaconname",3,"label","value"],["disabled","true","id","beacon-mgt-view-assettype",3,"label","value"],["mandatory","false","disabled","true","id","beacon-mgt-view-asset",3,"label","value"],["mandatory","false","disabled","true","id","lookupcode-view-lookupcode",3,"label","value"],["mandatory","false","disabled","true","id","lookupcode-view-displayname",3,"label","value"],[1,"thumbnail-view",3,"defaultImage"],[1,"position-relative"],["type","file","id","excelfile","disabled","true","accept","image/*|video/*","name","file-input",1,"form-control"],["id","importFile","for","customFile",1,"custom-file-label"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e._UZ(6,"app-pageheader",6),e.qZA(),e.TgZ(7,"div",7)(8,"div",8)(9,"div",9),e._UZ(10,"app-input",10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"div",11),e._UZ(13,"app-checkbox",12),e.qZA(),e.YNc(14,Ce,3,4,"div",13),e.YNc(15,De,3,4,"div",13),e.YNc(16,Me,3,4,"div",13),e.TgZ(17,"div",9),e._UZ(18,"app-input",14),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"div",9),e._UZ(21,"app-input",15),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"div",9),e._UZ(24,"app-input",16),e.ALo(25,"translate"),e.qZA(),e.YNc(26,Ae,3,4,"div",13),e.YNc(27,Ne,3,4,"div",13),e.YNc(28,Ie,2,1,"div",13),e.YNc(29,Ze,4,0,"div",13),e.TgZ(30,"div",17)(31,"app-button",18),e.NdJ("buttonOnClick",function(){return t.cancelBtn()}),e.ALo(32,"translate"),e.qZA()()(),e.TgZ(33,"div",19)(34,"div",3)(35,"div",20)(36,"div",21)(37,"p-accordion"),e._UZ(38,"app-recordhistory",22),e.qZA()()()()()()()()()()()),2&i&&(e.xp6(6),e.Q6J("pageName",t.dataJsonObj.pageName)("pageTitle",t.dataJsonObj.pageTitle)("selectedMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!1)("showDependencySubMenu",!0),e.xp6(4),e.s9C("label",e.lcZ(11,29,"COMMON_PAGE_TITLES.ENTERPRISE")),e.s9C("value",null==t.viewData||null==t.viewData.enterprise?null:t.viewData.enterprise.short_name),e.xp6(3),e.Q6J("options",t.checkboxOptions)("checked",null==t.viewData?null:t.viewData.message_description),e.xp6(1),e.Q6J("ngIf",!0===t.beaconPromotionsEnable),e.xp6(1),e.Q6J("ngIf",!1===t.beaconPromotionsEnable),e.xp6(1),e.Q6J("ngIf",!1===t.beaconPromotionsEnable),e.xp6(2),e.s9C("label",e.lcZ(19,31,"COMMON_FIELDS.START_DATE")),e.s9C("value",null==t.viewData?null:t.viewData.start_datetime),e.xp6(3),e.s9C("label",e.lcZ(22,33,"COMMON_FIELDS.END_DATE")),e.s9C("value",null==t.viewData?null:t.viewData.end_datetime),e.xp6(3),e.s9C("label",e.lcZ(25,35,"NEW_VARIABLES.MESSAGE_TYPE")),e.s9C("value",t.lookupLanguageTranslations(null==t.viewData||null==t.viewData.message_type?null:t.viewData.message_type.lookup_id)),e.xp6(2),e.Q6J("ngIf",!1===t.showMessage),e.xp6(1),e.Q6J("ngIf",!0===t.showMessage),e.xp6(1),e.Q6J("ngIf",!0===t.showImage),e.xp6(1),e.Q6J("ngIf",!0===t.showAudio),e.xp6(2),e.s9C("label",e.lcZ(32,37,"COMMON_BUTTONS.BUTTON_CLOSE")),e.xp6(7),e.Q6J("createdBy",null==t.viewData?null:t.viewData.created_by)("lastUpdatedBy",null==t.viewData?null:t.viewData.updated_by)("showrecordhistory",t.dataJsonObj.showrecordhistory)("creationDate",null==t.viewData?null:t.viewData.createdAt)("lastUpdatedDate",null==t.viewData?null:t.viewData.updatedAt))},dependencies:[w.UQ,I.O5,F.r,B.a,j.b,U.f,k.W,Z.q,v.X$]})}return o})();var we=l(35226),Fe=l.n(we),x=l(42863),Be=l(28168),Y=l(30578),je=l(88425);const Ue=["datatableComponent"],Je=[{path:"",data:{title:"Beacon Management"},children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",canActivate:[T.P],component:(()=>{class o extends C.O{actionSheetController;columnheaders;loggerService;router;translateService;beaconMessageService;commonService;listingVariables;route;toastController;uiUtils;datatableComponent;actions;beaconMessageMobileListData=[];beaconMessagesListData;defaultTimeZone;endDate;enterpriseId;fabMobileactions;forceRefresh;headers;isFilterClicked=!1;loginUserDateFormat;mobileroutesArray;noDuplicates=void 0;show=!0;statsShow=!0;searchString;startDate;statusObj;userTimeZoneObj={};utcTimeZoneString;dataJsonObj={};constructor(a,i,t,s,r,d,c,p,h,g,f){super(h,c),this.actionSheetController=a,this.columnheaders=i,this.loggerService=t,this.router=s,this.translateService=r,this.beaconMessageService=d,this.commonService=c,this.listingVariables=p,this.route=h,this.toastController=g,this.uiUtils=f,this.route.queryParams.subscribe(_=>{this.dataJsonObj.queryParamsObj={defaultView:_.default_view,selectedMenuId:_.selectedMenuId,selectedSubMenuId:_.selectedSubMenuId}})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.showSpinner(),this.dataJsonObj.pageName=n.hf.BEACON_MESSAGES,this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"COMMON_PAGE_TITLES.BEACON_MESSAGES",value:"",showSubMenuDisplayName:!1}],this.dataJsonObj.htmlPageRolesEnumValuesJson={pageEnum:n.hf,pageSettingEnum:n.AM,pageSettingFieldsEnum:n.In},this.dataJsonObj.advancedSearchObj={},document.getElementsByTagName("body");const i=this.commonService.getLoginUserTimeZoneDateFormat();this.loginUserDateFormat=i.dateFormat,this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(i.timeZoneDescription),this.userTimeZoneObj.timeZoneCode=i.timeZoneCode,this.headers=this.columnheaders.getBeaconMessagesHeaders(),this.searchString="",this.actions={EDIT:this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.EDIT),DELETE:this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.DELETE),VIEW:this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.VIEW)},this.forceRefresh=!1,this.commonService.currentEvent.subscribe(t=>{"beacon-messages"===t&&(this.forceRefresh=!0)}),this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.CREATE)&&this.dataJsonObj.pageActionsList.push({actionName:"CREATE",displayName:"COMMON_BUTTONS.BUTTON_CREATE",actionType:n.gL.URL,redirectURL:"/admin/beaconmessages/create",queryParams:"",iconClass:"fas fa-plus"}),this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.FILTERS)}ionViewWillEnter(){this.actions={EDIT:this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.EDIT),DELETE:this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.DELETE),VIEW:this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.VIEW)}}getSearchResults(a){this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.searchString=a,this.getAllRecords(),this.datatableComponent.reset()}searchClose(){this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.searchString="",this.getAllRecords(),this.datatableComponent.reset()}getAllRecords(){try{this.enterpriseId=localStorage.getItem(n.BU.SELECTED_ENTERPRISE);const a=this.commonService.getMobileViewCondition(this.dataJsonObj.selectedDisplayView),i=this.dataJsonObj.selectedFilter?"&filtertype="+this.dataJsonObj.selectedFilter:"";this.showSpinner(),this.beaconMessageService.getAll(this.searchString,this.enterpriseId,this.listingVariables.sortOrderColumn,this.listingVariables.rowsPerPage,this.listingVariables.pageNumbers,this.statusObj,this.forceRefresh,a,i,this.dataJsonObj.advancedSearchObj.inputAdvSearchObj).subscribe(t=>{if(this.hideSpinner(),t.rows.length>0){this.beaconMessageMobileListData&&this.beaconMessageMobileListData.length>0||(this.beaconMessageMobileListData=[]);for(let s=0;s<t.rows.length;s++){const r=this.displayDateFormatter(t.rows[s].start_datetime,!1,!0);this.startDate=r.startDate;const d=this.displayDateFormatter(t.rows[s].end_datetime,!1,!0);this.endDate=d.startDate,t.rows[s].start_datetime=this.startDate+" "+this.userTimeZoneObj.timeZoneCode,t.rows[s].end_datetime=this.endDate+" "+this.userTimeZoneObj.timeZoneCode;const c={url:`admin/beaconmessages/${t.rows[s]._id}/view`,queryParams:this.dataJsonObj.queryParamsObj?this.dataJsonObj.queryParamsObj:""},p=c.queryParams&&Object.keys(c.queryParams).length>0?`${c.url}?${JSON.stringify(c.queryParams)}`:c.url;t.rows[s].message_type.lookup_name=`<a class="enable" id="message_type.lookup_name${t.rows[s]._id}" href=${p}>${t.rows[s].message_type.lookup_name}`,t.rows[s].enterprise.short_name='<a class="enable" id="enterprise.short_name'+t.rows[s]._id+'" href="enterprises/enterprises/'+t.rows[s].enterprise.enterprise_id+'/view" >'+t.rows[s].enterprise.short_name,this.beaconMessageMobileListData=this.beaconMessageMobileListData.filter(h=>h._id!==t.rows[s]._id),this.beaconMessageMobileListData.push(t.rows[s])}t.totalCount&&(this.listingVariables.totalRecords=t.totalCount),1===this.listingVariables.pageNumbers&&(this.listingVariables.totalpages=t.pages),this.dataJsonObj.isLoadMoreClicked?(this.dataJsonObj.isLoadMoreClicked=!1,this.beaconMessagesListData=this.beaconMessagesListData.concat(t.rows)):this.beaconMessagesListData=t.rows}else this.beaconMessagesListData=[],this.beaconMessageMobileListData=[]},t=>{this.hideSpinner(),this.loggerService.setLoggerError(this.constructor.name,"getAllRecords",t)})}catch(a){this.hideSpinner(),this.loggerService.setLoggerError(this.constructor.name,"getAllRecords",a)}}loadPageData(a){this.listingVariables.pageNumbers=a.listingVariables.pageNumbers,a.clearMobileData&&(this.beaconMessageMobileListData=this.noDuplicates),a.isPaginationChange&&(this.dataJsonObj.selectedFilter=a.selectedFilterType,this.dataJsonObj.isLoadMoreClicked=a.isLoadMoreClicked,this.dataJsonObj.advancedSearchObj.inputAdvSearchObj=a.selectedAdvancedSearchObj),this.getAllRecords()}showSpinner(){this.dataJsonObj.showSpinner=!0}hideSpinner(){this.dataJsonObj.showSpinner=!1}toggle(){this.show=!this.show}createBeaconMessages(){try{this.router.navigate(["admin/beaconmessages/create"])}catch(a){this.loggerService.setLoggerError(this.constructor.name,"createBeaconMessages",a)}}onItemClicked(a){this.commonService.redirectToUrl(["..",a._id,"view"],!0,!0,this.dataJsonObj.queryParamsObj?this.dataJsonObj.queryParamsObj:"",this.route)}mobileEventAction(a){try{this.mobileroutesArray=[],!0===this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.DELETE)&&this.mobileroutesArray.push({text:this.translateService.instant("COMMON_BUTTONS.BUTTON_DELETE"),handler:()=>{this.delete(a._id),this.router.routeReuseStrategy.clearModuleRouteCache("beacon-messages")}}),!0===this.roleRightsValidationByPage(n.hf.BEACON_MESSAGES,n.AM.ACTIONS,n.In.EDIT)&&this.mobileroutesArray.push({text:this.translateService.instant("COMMON_BUTTONS.BUTTON_EDIT"),handler:()=>{this.router.navigate(["admin/beaconmessages/"+a._id+"/edit"]),this.router.routeReuseStrategy.clearModuleRouteCache("beacon-mgmt")}}),this.presentActionSheet(a)}catch(i){this.loggerService.setLoggerError(this.constructor.name,"mobileEventAction",i)}}presentActionSheet(a){var i=this;return(0,y.Z)(function*(){yield(yield i.actionSheetController.create({cssClass:"actionsheet",buttons:i.mobileroutesArray})).present()})()}onActionClicked(a){a.action===n.A0.EDIT?(this.router.navigate(["admin/beaconmessages/"+a.data._id+"/edit"]),this.router.routeReuseStrategy.clearModuleRouteCache("beacon-messages")):a.action===n.A0.VIEW?this.commonService.redirectToUrl(["..",a.data._id,"view"],!0,!0,this.dataJsonObj.queryParamsObj?this.dataJsonObj.queryParamsObj:"",this.route):a.action===n.A0.DELETE&&this.delete(a.data._id)}delete(a){try{Fe().fire({title:"",text:this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_DELETE"),showCancelButton:!0,cancelButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(i=>{i.value&&this.beaconMessageService.delete(a).then(t=>{this.beaconMessageMobileListData=this.noDuplicates,this.getAllRecords(),this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DELETE"),this.router.routeReuseStrategy.clearModuleRouteCache("beacon-messages")},t=>{}).catch(t=>{this.loggerService.setLoggerError(this.constructor.name,"delete",t)})})}catch(i){this.loggerService.setLoggerError(this.constructor.name,"delete",i)}}statusData(a){try{this.isFilterClicked=!0,this.statusObj=a.value,this.getAllRecords()}catch(i){this.loggerService.setLoggerError(this.constructor.name,"statusData",i)}}statsToggle(){try{this.statsShow=!this.statsShow}catch(a){this.loggerService.setLoggerError(this.constructor.name,"toggle",a)}}displayDateFormatter(a,i,t){try{const s=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,r={startDate:"",endDate:""};if(r.startDate=this.commonService.convertDateToUserFormat(s,n.eZ.HOURS_MINS,!0,"",!1),i){const d=t?this.commonService.convertDateToUserTimeZone(a,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):a,c=E.utc(d).add(2,"hours");r.endDate=this.commonService.convertDateToUserFormat(c,n.eZ.HOURS_MINS,!0,"",!1)}return r}catch(s){this.loggerService.setLoggerError(this.constructor.name,"displayDateFormatter",s)}}selectedViewType(a){this.dataJsonObj.selectedDisplayView=a}selectedFilterType(a){a?this.dataJsonObj.selectedFilter=a:(this.dataJsonObj.selectedFilter="",this.dataJsonObj.selectedAdvancedSearchObj={})}onPageLevelActionClicked(a){}advancedSearchFilterClicked(a){this.dataJsonObj.selectedAdvancedSearchObj=a}onHeaderItemClick(a){switch(a.type){case"search":this.getSearchResults(a.event);break;case"search_close":this.searchClose();break;case"display_views":this.selectedViewType(a.event);break;case"filters":this.selectedFilterType(a.event);break;case"advanced_search":this.advancedSearchFilterClicked(a.event);break;case"page_actions":this.onPageLevelActionClicked(a.event)}}static \u0275fac=function(i){return new(i||o)(e.Y36(S.BX),e.Y36(x.Y),e.Y36(M.m),e.Y36(u.F0),e.Y36(v.sK),e.Y36(b),e.Y36(O.v),e.Y36(Y.v),e.Y36(u.gz),e.Y36(S.yF),e.Y36(N.s))};static \u0275cmp=e.Xpm({type:o,selectors:[["app-beacon-messages-list"]],viewQuery:function(i,t){if(1&i&&e.Gf(Ue,5),2&i){let s;e.iGM(s=e.CRH())&&(t.datatableComponent=s.first)}},features:[e._Bn([b,Y.v,x.Y]),e.qOj],decls:9,vars:30,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","defaultView","isFabDisplay","pageActionsList","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu","headerItemClick"],["id","extraPaddingBottomID",1,"card-body","pdt-0"],[3,"header","actions","data","totalRecords","paginator","totalPages","mobileListData","expand","statsShow","showRights","statsSearch","listingVariables","selectedDisplayViewType","selectedFilterType","selectedAdvancedSearchObj","pageName","selectedMenuId","showSpinner","selectedSubMenuId","actionClicked","itemClickEvent","redirectionEvent","loadPageData"],["datatableComponent",""],[1,"mgt-5"],[3,"isFabDisplay","actionsList","selectedAction"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-pageheader",3),e.NdJ("headerItemClick",function(r){return t.onHeaderItemClick(r)}),e.qZA()(),e.TgZ(4,"div",4)(5,"app-datatable",5,6),e.NdJ("actionClicked",function(r){return t.onActionClicked(r)})("itemClickEvent",function(r){return t.onItemClicked(r)})("redirectionEvent",function(r){return t.mobileEventAction(r)})("loadPageData",function(r){return t.loadPageData(r)}),e.qZA(),e.TgZ(7,"div",7)(8,"app-page-actions",8),e.NdJ("selectedAction",function(r){return t.onPageLevelActionClicked(r)}),e.qZA()()()()()),2&i&&(e.xp6(3),e.Q6J("pageName",t.dataJsonObj.pageName)("defaultView",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.defaultView)("isFabDisplay",!1)("pageActionsList",t.dataJsonObj.pageActionsList)("pageTitle",t.dataJsonObj.pageTitle)("selectedMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!0)("showDependencySubMenu",!1),e.xp6(2),e.Q6J("header",t.headers)("actions",t.actions)("data",t.beaconMessagesListData)("totalRecords",t.listingVariables.totalRecords)("paginator",!0)("totalPages",t.listingVariables.totalpages)("mobileListData",t.beaconMessageMobileListData)("expand",!1)("statsShow",t.statsShow)("showRights",t.roleRightsValidationByPage(t.dataJsonObj.htmlPageRolesEnumValuesJson.pageEnum.BEACON_MESSAGES,t.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingEnum.ACTIONS,t.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.STATS))("statsSearch",t.searchString)("listingVariables",t.listingVariables)("selectedDisplayViewType",t.dataJsonObj.selectedDisplayView)("selectedFilterType",t.dataJsonObj.selectedFilter)("selectedAdvancedSearchObj",t.dataJsonObj.selectedAdvancedSearchObj)("pageName",t.dataJsonObj.pageName)("selectedMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedMenuId)("showSpinner",t.dataJsonObj.showSpinner)("selectedSubMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedSubMenuId),e.xp6(3),e.Q6J("isFabDisplay",!0)("actionsList",t.dataJsonObj.pageActionsList))},dependencies:[Be.n,Z.q,je.y]})}return o})(),data:{object_type:n.hf.BEACON_MESSAGES,title:"Beacon Messages list",responsibilityParam:n.bP.MENUS+"."+n.w1.ADMIN+"."+n.bP.SUBMENUS+"."+n.w1.BEACON_MESSAGES+"."+n.Iu.ENABLED,pageName:n.hf.BEACON_MESSAGES}},{path:"create",canActivate:[T.P],component:de,data:{title:"Beacon Messages Create",responsibilityParam:n.bP.MENUS+"."+n.w1.ADMIN+"."+n.bP.SUBMENUS+"."+n.w1.BEACON_MESSAGES+"."+n.In.CREATE,pageName:n.hf.BEACON_MESSAGES,pageSetting:n.AM.ACTIONS,settingField:n.In.CREATE}},{path:":id/edit",canActivate:[T.P],component:Oe,data:{title:"Beacon Messages Edit",responsibilityParam:n.bP.MENUS+"."+n.w1.ADMIN+"."+n.bP.SUBMENUS+"."+n.w1.BEACON_MESSAGES+"."+n.In.EDIT,pageName:n.hf.BEACON_MESSAGES,pageSetting:n.AM.ACTIONS,settingField:n.In.EDIT}},{path:":id/view",canActivate:[T.P],component:G,data:{title:"Beacon Messages View",responsibilityParam:n.bP.MENUS+"."+n.w1.ADMIN+"."+n.bP.SUBMENUS+"."+n.w1.BEACON_MESSAGES+"."+n.In.VIEW,pageName:n.hf.BEACON_MESSAGES,pageSetting:n.AM.ACTIONS,settingField:n.In.VIEW}},{path:":id/status",canActivate:[T.P],component:G,data:{title:"Beacon Messages View",responsibilityParam:n.bP.MENUS+"."+n.w1.ADMIN+"."+n.bP.SUBMENUS+"."+n.w1.BEACON_MESSAGES+"."+n.In.VIEW,pageName:n.hf.BEACON_MESSAGES,pageSetting:n.AM.ACTIONS,settingField:n.In.VIEW}}]}];let Pe=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=e.oAB({type:o});static \u0275inj=e.cJS({imports:[u.Bz.forChild(Je),u.Bz]})}return o})();var Re=l(32137),Q=l(24006),Ve=l(83748),ke=l(93144),Ge=l(65673);let xe=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=e.oAB({type:o});static \u0275inj=e.cJS({imports:[w.fx,I.ez,Re.D,Q.u5,Q.UX,Ve.v,ke.U$,v.aw,Pe,Ge.Q]})}return o})()}}]);