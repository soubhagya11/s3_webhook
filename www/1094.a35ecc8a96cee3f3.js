"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1094],{31094:($,b,r)=>{r.r(b),r.d(b,{GoalSettingsModule:()=>Q});var u=r(36895),T=r(11210),d=r(32236),h=r(62510),J=r(47561),v=r(42786),O=r(46335),S=r(71568),C=r(24655),j=r(75875),t=r(94650);let f=(()=>{class o{authService;constructor(s){this.authService=s}Create(s){return new Promise((e,a)=>{this.authService.postApiCall("api/v1/goalsettings/",s).subscribe(i=>{e(i)},i=>{a(i)})})}Update(s,e){return new Promise((a,i)=>{this.authService.putApiCall("api/v1/goalsettings/"+e,s).subscribe(n=>{a(n)},n=>{i(n)})})}getGoalSettingsData(s,e,a){return this.authService.getApiCall("api/v1/goalsettings?enterprise.enterprise_id="+s+"&athlete_id="+e+(a?"&coach_id="+a:""),!0)}static \u0275fac=function(e){return new(e||o)(t.LFG(j.e))};static \u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var I=r(27601),m=r(32174),A=r(10805),L=r(2387),N=r(56368),x=r(47178),G=r(37415),_=r(54463);const M=["statsDropDown"];function F(o,p){if(1&o){const s=t.EpF();t.TgZ(0,"app-button",25),t.NdJ("buttonOnClick",function(a){t.CHM(s);const i=t.oxw().$implicit,n=t.oxw();return n.enableEdit(i.sport.sport_name),t.KtG(n.onClick(a))}),t.ALo(1,"translate"),t.qZA()}if(2&o){const s=t.oxw().$implicit,e=t.oxw();t.s9C("label",t.lcZ(1,2,e.dataJsonObj.selectedStatsFieldsList[s.sport.sport_name].length<=0?"COMMON_BUTTONS.BUTTON_CREATE":"COMMON_BUTTONS.BUTTON_EDIT")),t.Q6J("isEmitMouseEvent",!0)}}function D(o,p){if(1&o){const s=t.EpF();t.TgZ(0,"div",26)(1,"app-input",27),t.NdJ("valueChange",function(a){const n=t.CHM(s).$implicit,l=t.oxw().$implicit,c=t.oxw();return t.KtG(c.changeInputFieldValue(a,n.NAME,l.sport.sport_name))}),t.qZA()()}if(2&o){const s=p.$implicit,e=t.oxw().$implicit,a=t.oxw();t.xp6(1),t.s9C("label",s.upperCase),t.s9C("value",a.dataJsonObj.selectedStatsFieldValuesList[e.sport.sport_name][s.NAME]),t.Q6J("disabled",!a.dataJsonObj.isEditEnabled[e.sport.sport_name]&&a.roleRightsValidationByPage(a.dataJsonObj.htmlPageRolesEnumValuesJson.pageEnum.GOAL_SETTINGS,a.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingEnum.ACTIONS,a.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.EDIT))}}function R(o,p){if(1&o&&(t.TgZ(0,"div",28)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&o){const s=t.oxw().$implicit;t.xp6(2),t.AsE("",t.lcZ(3,2,"COMMON_PAGE_TITLES.GOAL_NOT_CREATED_IN")," ",s.NAME,"")}}function V(o,p){if(1&o){const s=t.EpF();t.TgZ(0,"div",29)(1,"app-button",30),t.NdJ("buttonOnClick",function(){t.CHM(s);const a=t.oxw().$implicit,i=t.oxw();return t.KtG(i.createUpdateRecord(a.ID,a.sport.sport_name))}),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"app-button",31),t.NdJ("buttonOnClick",function(){t.CHM(s);const a=t.oxw().$implicit,i=t.oxw();return t.KtG(i.cancel(a.sport.sport_name))}),t.ALo(4,"translate"),t.qZA()()}if(2&o){const s=t.oxw(2);t.xp6(1),t.s9C("label",t.lcZ(2,3,"COMMON_BUTTONS.BUTTON_SUBMIT")),t.Q6J("disabled",s.submitenabled),t.xp6(2),t.s9C("label",t.lcZ(4,5,"COMMON_BUTTONS.BUTTON_CANCEL"))}}function U(o,p){if(1&o&&(t.TgZ(0,"div",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o){const s=t.oxw().$implicit,e=t.oxw();t.xp6(1),t.hij(" ",t.lcZ(2,1,e.dataJsonObj.error[s.sport.sport_name])," ")}}function P(o,p){if(1&o){const s=t.EpF();t.TgZ(0,"p-accordionTab",13)(1,"p-header",14)(2,"span"),t._uU(3),t.qZA(),t.YNc(4,F,2,4,"app-button",15),t.qZA(),t.TgZ(5,"div",16)(6,"div",17)(7,"div",18)(8,"app-dropdown-multiselect-v2",19,20),t.NdJ("valueChange",function(a){const n=t.CHM(s).$implicit,l=t.oxw();return t.KtG(l.changeMultiSelectFieldValue(a,null==l.dataJsonObj?null:l.dataJsonObj.selectedStatsFieldsList,n.sport.sport_name,["ID","NAME","upperCase"]))})("searchValueChange",function(a){const n=t.CHM(s).$implicit,l=t.oxw();return t.KtG(l.getStatsList(n.sport.sport_name,a))}),t.ALo(10,"translate"),t.qZA()(),t.YNc(11,D,2,3,"div",21),t.YNc(12,R,4,4,"div",22),t.YNc(13,V,5,7,"div",23),t.YNc(14,U,3,3,"div",24),t.qZA()()()}if(2&o){const s=p.$implicit,e=t.oxw();t.Q6J("selected",!0),t.xp6(3),t.Oqu(s.NAME),t.xp6(1),t.Q6J("ngIf",!e.dataJsonObj.isEditEnabled[s.sport.sport_name]&&e.roleRightsValidationByPage(e.dataJsonObj.htmlPageRolesEnumValuesJson.pageEnum.GOAL_SETTINGS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingEnum.ACTIONS,e.dataJsonObj.selectedStatsFieldsList[s.sport.sport_name].length<=0?e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.CREATE:e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.EDIT)),t.xp6(4),t.s9C("label",t.lcZ(10,11,"COMMON_BLOCK_TITLES.STATS")),t.Q6J("disabled",!e.dataJsonObj.isEditEnabled[s.sport.sport_name]&&e.roleRightsValidationByPage(e.dataJsonObj.htmlPageRolesEnumValuesJson.pageEnum.GOAL_SETTINGS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingEnum.ACTIONS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.EDIT))("options",e.dataJsonObj.statsList[s.sport.sport_name])("selectedOptions",e.dataJsonObj.selectedStatsFieldsList[s.sport.sport_name]),t.xp6(3),t.Q6J("ngForOf",e.dataJsonObj.selectedStatsFieldsList[s.sport.sport_name]),t.xp6(1),t.Q6J("ngIf",e.dataJsonObj.selectedStatsFieldsList[s.sport.sport_name].length<=0),t.xp6(1),t.Q6J("ngIf",e.dataJsonObj.isEditEnabled[s.sport.sport_name]&&e.roleRightsValidationByPage(e.dataJsonObj.htmlPageRolesEnumValuesJson.pageEnum.GOAL_SETTINGS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingEnum.ACTIONS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.EDIT)),t.xp6(1),t.Q6J("ngIf",e.dataJsonObj.isEditEnabled[s.sport.sport_name]&&e.roleRightsValidationByPage(e.dataJsonObj.htmlPageRolesEnumValuesJson.pageEnum.GOAL_SETTINGS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingEnum.ACTIONS,e.dataJsonObj.htmlPageRolesEnumValuesJson.pageSettingFieldsEnum.EDIT))}}function y(o,p){1&o&&(t.TgZ(0,"div"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"COMMON_PAGE_TITLES.SPORT_NOT_ASSIGNED")," "))}let E=(()=>{class o extends J.O{userService;loggerService;commonService;route;sportsService;uiUtils;goalSettingsService;statsDropDown;dataJsonObj={};athleteId;constructor(s,e,a,i,n,l,c){super(i,a),this.userService=s,this.loggerService=e,this.commonService=a,this.route=i,this.sportsService=n,this.uiUtils=l,this.goalSettingsService=c,this.route.params.subscribe(g=>{g&&(this.athleteId=isNaN(+g.athleteId)?null:g.athleteId)})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.dataJsonObj.htmlPageRolesEnumValuesJson={pageEnum:d.hf,pageSettingEnum:d.AM,pageSettingFieldsEnum:d.In},this.dataJsonObj.pageName=d.hf.GOAL_SETTINGS,this.dataJsonObj.pageTitle=[{key:"COMMON_PAGE_TITLES.GOAL_SETTINGS",value:"",showSubMenuDisplayName:!1}],this.dataJsonObj.selectedEnterpriseId=localStorage.getItem(d.BU.SELECTED_ENTERPRISE),this.dataJsonObj.loginUserId=this.athleteId?this.athleteId:localStorage.getItem(d.BU.LOG_IN_USER_ID),this.dataJsonObj.enterpriseObj=localStorage.getItem(d.BU.SELECTED_ENTERPRISE_OBJ)?JSON.parse(localStorage.getItem(d.BU.SELECTED_ENTERPRISE_OBJ)):{},this.dataJsonObj.isEditEnabled={},this.dataJsonObj.error={},this.dataJsonObj.editApi={},this.dataJsonObj.editRecordId={},this.dataJsonObj.userSportsData=[],this.dataJsonObj.statsList=[],this.dataJsonObj.selectedStatsFieldsList=[],this.dataJsonObj.selectedStatsFieldValuesList=[],this.getExistingGoalSettingsData()}getExistingGoalSettingsData(){this.commonService.getJsonData(`assets/enterprises/${this.dataJsonObj.selectedEnterpriseId}/sports/`,"sports.json").then(s=>{this.dataJsonObj.sportsJsonData=s,this.userService.get(this.dataJsonObj.loginUserId).subscribe(e=>{const a=e.athleteProfileData?.sports?e.athleteProfileData.sports:[];this.dataJsonObj.userSportsData=[];for(let i=0;i<a.length;i++){for(let n=0;n<s.length;n++)a[i].sport_id==s[n].ID&&(this.dataJsonObj.isEditEnabled[s[n].sport.sport_name]=!1,this.dataJsonObj.editApi[s[n].sport.sport_name]=!1,this.dataJsonObj.editRecordId[s[n].sport.sport_name]=null,this.dataJsonObj.error[s[n].sport.sport_name]="",this.dataJsonObj.userSportsData.push(s[n]),this.getStatsList(s[n].sport.sport_name,""),this.dataJsonObj.selectedStatsFieldsList[s[n].sport.sport_name]=[],this.dataJsonObj.selectedStatsFieldValuesList[s[n].sport.sport_name]=[]);i===a.length-1&&this.getUserGoalSettingsData()}})})}getStatsList(s,e){let a="";switch(s){case d.I6.BASKETBALL:a="basketball_event_stats";break;case d.I6.AMERICAN_FOOTBALL:a="american_football_event_stats";break;case d.I6.BASEBALL:a="baseball_event_stats";break;case d.I6.CRICKET:a="cricket_event_stats";break;case d.I6.SOCCER:a="soccer_event_stats";break;case d.I6.SOFTBALL:a="softball_event_stats";break;case d.I6.VOLLEYBALL:a="volleyball_event_stats"}this.dataJsonObj.statsList[s]=[],this.sportsService.getFieldNames(a,e).then(i=>{this.dataJsonObj.statsList[s]=[];for(let l=0;l<i.columns.length;l++)if(i.columns[l].includes("tournament_event_stats.$.stats.")){var n={ID:l,NAME:i.columns[l].replace("tournament_event_stats.$.stats.","")};n.upperCase=n.NAME.toUpperCase().replace("_PERCENTAGE"," %"),this.dataJsonObj.statsList[s].push(n)}})}changeDropDownFieldValue(s,e){try{this.dataJsonObj.selectedStatsFieldsList[e]=s.value,this.dataJsonObj.error[e]=""}catch(a){this.loggerService.setLoggerError(this.constructor.name,"changeDropDownFieldValue",a)}}changeMultiSelectFieldValue(s,e,a,i){try{if(s.value){this.dataJsonObj.error[a]="",e[a]=[];const n=s.value;for(let l of n){const c={};for(let g of i)c[g]=l[g];e[a].push(c)}}this.dataJsonObj.error[a]=""}catch(n){this.loggerService.setLoggerError(this.constructor.name,"changeMultiSelectFieldValue",n)}}changeInputFieldValue(s,e,a){try{this.dataJsonObj.selectedStatsFieldValuesList[a][e]=s.value,this.dataJsonObj.error[a]=""}catch(i){this.loggerService.setLoggerError(this.constructor.name,"changeInputFieldValue",i)}}enableEdit(s){this.dataJsonObj.isEditEnabled[s]=!0}onClick(s){s.stopPropagation()}createUpdateRecord(s,e){try{const i={enterprise:this.dataJsonObj.enterpriseObj,sport_id:s,athlete_id:this.dataJsonObj.loginUserId,stats_values:[]};for(let n of this.dataJsonObj.selectedStatsFieldsList[e])if(this.dataJsonObj.selectedStatsFieldValuesList&&this.dataJsonObj.selectedStatsFieldValuesList[e]&&n.NAME){const c={};c[n.NAME]=this.dataJsonObj.selectedStatsFieldValuesList[e][n.NAME]||"",i.stats_values.push(c)}this.athleteId&&(i.coach_id=localStorage.getItem(d.BU.LOG_IN_USER_ID)),this.dataJsonObj.selectedStatsFieldsList[e].length<=0?this.dataJsonObj.error[e]="COMMON_PAGE_TITLES.NO_STATS_ARE_SELECTED":this.dataJsonObj.editApi[e]?this.goalSettingsService.Update(i,this.dataJsonObj.editRecordId[e]).then(n=>{this.cancel(e),this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_EDIT")}):this.goalSettingsService.Create(i).then(n=>{this.cancel(e),this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_CREATE")})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"createUpdateRecord",a)}}getUserGoalSettingsData(){try{this.goalSettingsService.getGoalSettingsData(this.dataJsonObj.selectedEnterpriseId,this.dataJsonObj.loginUserId,this.athleteId?localStorage.getItem(d.BU.LOG_IN_USER_ID):"").subscribe(s=>{const e=s.rows.length>0?s.rows:[];for(let a=0;a<e.length;a++){const n=this.dataJsonObj.sportsJsonData.find(l=>l.ID===e[a].sport_id).sport.sport_name;this.dataJsonObj.editApi[n]=!0,this.dataJsonObj.editRecordId[n]=e[a]._id,this.dataJsonObj.selectedStatsFieldsList[n]=[],this.dataJsonObj.selectedStatsFieldValuesList[n]={};for(let l of this.dataJsonObj.statsList[n]){const c=e[a].stats_values?e[a].stats_values.find(g=>Object.keys(g).includes(l.NAME)):"";c&&(this.dataJsonObj.selectedStatsFieldsList[n].push(l),this.dataJsonObj.selectedStatsFieldValuesList[n][l.NAME]=c[l.NAME])}}})}catch(s){this.loggerService.setLoggerError(this.constructor.name,"getGoalSettingsData",s)}}cancel(s){this.dataJsonObj.selectedStatsFieldsList[s]=[],this.dataJsonObj.isEditEnabled[s]=!1,this.dataJsonObj.error[s]="",this.getUserGoalSettingsData()}static \u0275fac=function(e){return new(e||o)(t.Y36(O.K),t.Y36(v.m),t.Y36(S.v),t.Y36(h.gz),t.Y36(C.V),t.Y36(I.s),t.Y36(f))};static \u0275cmp=t.Xpm({type:o,selectors:[["app-goal-settings-create"]],viewQuery:function(e,a){if(1&e&&t.Gf(M,5),2&e){let i;t.iGM(i=t.CRH())&&(a.statsDropDown=i.first)}},features:[t._Bn([O.K,S.v]),t.qOj],decls:14,vars:7,consts:[[1,"container-fluid","config-optns"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],[1,"card-body","pdt-0","bdt-lightblue"],[1,"card","bd-0"],[1,"card-content"],[3,"multiple"],["class","list-accordion-tab","id","view-generalsettings",3,"selected",4,"ngFor","ngForOf"],[4,"ngIf"],["id","view-generalsettings",1,"list-accordion-tab",3,"selected"],[1,"d-flex","justify-content-between","w-100","accordion-header"],["id","configoptions-generalsettings-edit","className","btn btn-danger btn-sm",3,"label","isEmitMouseEvent","buttonOnClick",4,"ngIf"],[1,"card-body"],[1,"row","form-bs"],[1,"col-md-3"],["mandatory","false","id","configoptions-generalsettings-view-languages",3,"label","disabled","options","selectedOptions","valueChange","searchValueChange"],["statsDropDown",""],["class","col-md-2",4,"ngFor","ngForOf"],["class","col-md-4",4,"ngIf"],["class","col-md-12 text-end mt-2 ",4,"ngIf"],["class","error-msg col-md-12 text-danger text-center mb-0",4,"ngIf"],["id","configoptions-generalsettings-edit","className","btn btn-danger btn-sm",3,"label","isEmitMouseEvent","buttonOnClick"],[1,"col-md-2"],["id","enterprise-create-enterprisename",3,"label","disabled","value","valueChange"],[1,"col-md-4"],[1,"col-md-12","text-end","mt-2"],["className","btn btn-primary btn-sm","id","groups-create-submit",1,"mgr-5",3,"label","disabled","buttonOnClick"],["className","btn btn-danger btn-sm","id","groups-create-cancel",3,"label","buttonOnClick"],[1,"error-msg","col-md-12","text-danger","text-center","mb-0"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t._UZ(6,"app-pageheader",6),t.qZA(),t.TgZ(7,"div",7)(8,"div",3)(9,"div",8)(10,"div",9)(11,"p-accordion",10),t.YNc(12,P,15,13,"p-accordionTab",11),t.YNc(13,y,3,3,"div",12),t.qZA()()()()()()()()()()),2&e&&(t.xp6(6),t.Q6J("pageName",a.dataJsonObj.pageName)("pageTitle",a.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),t.xp6(5),t.Q6J("multiple",!0),t.xp6(1),t.Q6J("ngForOf",null==a.dataJsonObj?null:a.dataJsonObj.userSportsData),t.xp6(1),t.Q6J("ngIf",a.dataJsonObj.userSportsData.length<=0))},dependencies:[u.sg,u.O5,m.UQ,m.US,A.h4,L.r,N.a,x.E,G.q,_.X$]})}return o})();const B=[{path:"",data:{title:"goalsettings"},children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",canActivate:[T.P],component:E,data:{pageName:d.hf.GOAL_SETTINGS}},{path:"coach/:athleteId",component:E}]}];let w=(()=>{class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=t.oAB({type:o});static \u0275inj=t.cJS({imports:[h.Bz.forChild(B),h.Bz]})}return o})();var Z=r(65673);let Q=(()=>{class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=t.oAB({type:o});static \u0275inj=t.cJS({imports:[u.ez,w,_.aw,m.fx,Z.Q]})}return o})()}}]);