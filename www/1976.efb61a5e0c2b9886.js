"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1976],{41976:(ee,O,r)=>{r.r(O),r.d(O,{BookmarksModule:()=>z});var T=r(36895),p=r(54463),h=r(62510),g=r(15861),t=r(94650),v=r(42786),u=r(71568),S=r(30578),k=r(42863),j=r(75875),I=r(90313),s=r(32236);let A=(()=>{class d{authService;constructor(e){this.authService=e}getAllAsync(e,o,a,i,n,b,c,l,m,f,J){var Q=this;return(0,g.Z)(function*(){const X=n?"&condition="+n:"",W=f||"",q=localStorage.getItem(s.BU.BOOKMARK_DEVICE_ID),x=I.L.isEmpty(J)?"":"&advSearchString="+JSON.stringify(J);return yield Q.authService.getApiCallAsync("api/v1/pigeonbookmarks?&enterprise.enterprise_id="+l+"&skip="+e+"&limit="+o+"&type=list&sort="+a+"&search="+i+m+X+W+x+"&rowList=true&deviceId="+q,!0)})()}update(e,o){return new Promise((a,i)=>{this.authService.putApiCall("api/v1/pigeonbookmarks/"+e,o).subscribe(n=>{a(n)},n=>{i(n)})})}delete(e){return new Promise((o,a)=>{this.authService.deleteApiCall("api/v1/pigeonbookmarks/"+e).subscribe(i=>{o(i)},i=>{a(i)})})}static \u0275fac=function(o){return new(o||d)(t.LFG(j.e))};static \u0275prov=t.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})();var E=r(28168),N=r(35226),L=r.n(N),B=r(47561),M=r(27601),y=r(2387),D=r(56368),R=r(37415),U=r(88425);const P=["datatableComponent"],V=["bookmarkNamevalid"],_=[{path:"bookmarks/list",component:(()=>{class d extends B.O{listingVariables;commonService;BookmarksService;route;ColumnHeader;loggerService;uiUtils;translateService;datatableComponent;bookmarkNamevalid;searchValueChange=new t.vpe;dataJsonObj={};constructor(e,o,a,i,n,b,c,l){super(i,o),this.listingVariables=e,this.commonService=o,this.BookmarksService=a,this.route=i,this.ColumnHeader=n,this.loggerService=b,this.uiUtils=c,this.translateService=l,this.route.queryParams.subscribe(m=>{this.dataJsonObj.queryParamsObj={defaultView:m.default_view,selectedMenuId:m.selectedMenuId,selectedSubMenuId:m.selectedSubMenuId}})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.showSpinner(),this.dataJsonObj.pageName=s.hf.BOOKMARKS,this.dataJsonObj.selectedEnterpriseId=localStorage.getItem(s.BU.SELECTED_ENTERPRISE),this.dataJsonObj.pageActionsList=[],this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"MAP.BOOKMARKS",value:"",showSubMenuDisplayName:!0}],this.dataJsonObj.tableColumnheaders=this.ColumnHeader.getBookmarksColumnHeaders(),this.getDynamicJson([{folderName:"menu_manager",jsonType:"",storingFieldName:"menuDataJson"}]),this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.searchTerm="",this.dataJsonObj.forceRefresh=!0,this.dataJsonObj.actionsList={EDIT:this.roleRightsValidationByPage(s.hf.BOOKMARKS,s.AM.ACTIONS,s.In.EDIT),LOCATE:this.roleRightsValidationByPage(s.hf.BOOKMARKS,s.AM.ACTIONS,s.In.LOCATE),DELETE:this.roleRightsValidationByPage(s.hf.BOOKMARKS,s.AM.ACTIONS,s.In.DELETE),DIRECTION:this.roleRightsValidationByPage(s.hf.BOOKMARKS,s.AM.ACTIONS,s.In.DIRECTIONS)}}getDynamicJson(e){var o=this;return(0,g.Z)(function*(){for(let a of e)try{o.dataJsonObj[a.storingFieldName]=yield o.commonService.getDynamicJson(o.dataJsonObj.selectedEnterpriseId,a.folderName,a.jsonType)}catch{o.dataJsonObj[a.storingFieldName]={}}o.hideSpinner()})()}getMapJSON(){var e=this;return(0,g.Z)(function*(){const o=localStorage.getItem(s.BU.LOGIN_USER_LANGUAGE)?localStorage.getItem(s.BU.LOGIN_USER_LANGUAGE):"en",a=localStorage.getItem(s.BU.BUILDING_CODE);e.dataJsonObj.mapJSONData=yield e.commonService.getDynamicJsonByPath(`assets/enterprises/${e.dataJsonObj.selectedEnterpriseId}/facilities/${a}/`,`${o}.json`)})()}getSearchResult(e){try{this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.searchTerm=e,this.dataJsonObj.mobileListData=[],this.getAllRecords(),this.datatableComponent.reset(),this.searchValueChange.emit(e)}catch(o){this.loggerService.setLoggerError(this.constructor.name,"getSearchResult",o)}}searchClose(){try{this.dataJsonObj.searchTerm="",this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.mobileListData=[],this.getAllRecords(),this.datatableComponent.reset(),this.searchValueChange.emit("")}catch(e){this.loggerService.setLoggerError(this.constructor.name,"searchClose",e)}}getAllRecords(){var e=this;return(0,g.Z)(function*(){try{e.commonService.getMobileViewCondition(e.dataJsonObj.selectedDisplayView),e.showSpinner();const n=localStorage.getItem(s.BU.SELECTED_USER_TYPE_OBJ)?JSON.parse(localStorage.getItem(s.BU.SELECTED_USER_TYPE_OBJ)):{},b=window.localStorage.getItem("bookmarksData")?JSON.parse(window.localStorage.getItem("bookmarksData")):[];e.dataJsonObj.bookmarksFilteredData=b.filter(n?.user_type_name===s.ox.GUEST_USER?l=>l.enterprise.enterprise_id===parseInt(e.dataJsonObj.selectedEnterpriseId,10)&&l.user_profile.user_profile_id===parseInt(localStorage.getItem(s.BU.LOG_IN_USER_ID),10)&&l.device_id===localStorage.getItem(s.BU.BOOKMARK_DEVICE_ID):l=>l.enterprise.enterprise_id===parseInt(e.dataJsonObj.selectedEnterpriseId,10)&&l.user_profile.user_profile_id===parseInt(localStorage.getItem(s.BU.LOG_IN_USER_ID),10));const c=e.dataJsonObj.bookmarksFilteredData;if(e.hideSpinner(),e.dataJsonObj.forceRefresh&&(e.dataJsonObj.mobileListData=[],e.dataJsonObj.dataList=[]),c.length>0){e.dataJsonObj.mobileListData&&e.dataJsonObj.mobileListData.length>0||(e.dataJsonObj.mobileListData=[]);for(let l=0;l<c.length;l++)c[l].page_name=s.hf.BOOKMARKS,c[l].display_grid_title=c[l].bookmark_name,c[l].imageName=c[l].bookmark_name,c[l].mobile_display_data=[c[l].bookmark_name],e.dataJsonObj.mobileListData=e.dataJsonObj.mobileListData.filter(m=>m.id!==c[l].id),e.dataJsonObj.mobileListData.push(c[l]);c.totalCount&&(e.listingVariables.totalRecords=c.length),1===e.listingVariables.pageNumbers&&(e.listingVariables.totalpages=c.pages),e.dataJsonObj.isLoadMoreClicked?(e.dataJsonObj.isLoadMoreClicked=!1,e.dataJsonObj.dataList=e.dataJsonObj.dataList.concat(c)):e.dataJsonObj.dataList=c}else e.listingVariables.totalRecords=1,e.dataJsonObj.dataList=[],e.dataJsonObj.mobileListData=[]}catch(o){e.hideSpinner(),e.loggerService.setLoggerError(e.constructor.name,"getAllRecords",o)}})()}onItemClicked(e){try{localStorage.removeItem(s.BU.MAP_URL),localStorage.setItem("selectedBookmarkData",JSON.stringify(e)),this.commonService.redirectToUrl(["maps","maps","list"],!0,!1,{},this.route)}catch(o){this.loggerService.setLoggerError(this.constructor.name,"onItemClicked",o)}}loadPageData(e){this.dataJsonObj.forceRefresh=e.forceRefresh,this.listingVariables.pageNumbers=e.listingVariables.pageNumbers,e.clearMobileData&&(this.dataJsonObj.mobileListData=this.dataJsonObj.noDuplicates),e.isPaginationChange&&(this.dataJsonObj.selectedFilter=e.selectedFilterType,this.dataJsonObj.isLoadMoreClicked=e.isLoadMoreClicked),this.getAllRecords()}showSpinner(){this.dataJsonObj.showSpinner=!0}hideSpinner(){this.dataJsonObj.showSpinner=!1}changeBookmarkName(e){this.dataJsonObj.bookmarkPopupError="",this.dataJsonObj.bookmarkName=e.value}bookmarkNamePopup(e){this.dataJsonObj.bookmarkId=e._id,this.dataJsonObj.bookmarkName=e.bookmark_name,this.dataJsonObj.enterpriseObj=e.enterprise,$("#bookmarkNameUpdate").modal("show"),$(".modal-backdrop").insertAfter("#bookmarkNameUpdate")}cancelBtn(){try{document.getElementsByTagName("body")[0].classList.remove("modale-popup-open")}catch(e){this.loggerService.setLoggerError(this.constructor.name,"cancelBtn",e)}}onActionClicked(e){try{localStorage.removeItem(s.BU.FROM_LOCATION),localStorage.removeItem(s.BU.TO_ASSET),localStorage.removeItem(s.BU.FROM_ASSET),e.action===s.A0.EDIT?(this.dataJsonObj.selectedBookmarkDataForEdit=e.data,this.bookmarkNamePopup(e.data)):e.action===s.A0.DELETE?this.deleteRecordFromLocalStorage(e.data):e.action===s.A0.LOCATE?this.bookmarkLocate(e.data):e.action===s.A0.DIRECTION&&this.bookmarkDirection(e.data)}catch(o){this.loggerService.setLoggerError(this.constructor.name,"onActionClicked",o)}}deleteRecord(e){try{L().fire({title:"",text:this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_DELETE"),showCancelButton:!0,cancelButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(o=>{o.value?this.BookmarksService.delete(e).then(a=>{this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DELETE"),this.dataJsonObj.forceRefresh=!0,this.getAllRecords()},a=>{this.uiUtils.displayWarningMessage(this.translateService.instant("COMMON_VALIDATION_MESSAGES.VALID_PERFORM_ACTIONS"))}):this.getAllRecords()})}catch(o){this.loggerService.setLoggerError(this.constructor.name,"deleteRecord",o)}}deleteRecordFromLocalStorage(e){let o=localStorage.getItem(s.BU.BOOKMARKS_DATA)?JSON.parse(localStorage.getItem(s.BU.BOOKMARKS_DATA)):[];o=o.filter(i=>i.id!==e.id),localStorage.setItem(s.BU.BOOKMARKS_DATA,JSON.stringify(o)),localStorage.removeItem(s.BU.LEAFLET_BOOKMARKS+e.id),this.getAllRecords()}updateRecord(){try{if(this.bookmarkNamevalid.isValid()){const e=this.dataJsonObj.bookmarkName.toLowerCase().trim().replace(/  +/g," "),o=this.dataJsonObj.dataList.find(a=>a.bookmark_name.toLowerCase().trim().replace(/  +/g," ").match(e));o&&o._id!==this.dataJsonObj.bookmarkId?this.dataJsonObj.bookmarkPopupError="MAP.BOOKMARK_ALREADY_EXIST":this.BookmarksService.update(this.dataJsonObj.bookmarkId,{bookmark_name:this.dataJsonObj.bookmarkName,enterprise:this.dataJsonObj.enterpriseObj}).then(i=>{this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_EDIT"),$("#bookmarkNameUpdate").modal("hide"),this.getAllRecords()},i=>{this.commonErrorCodes(JSON.parse(i))})}}catch(e){this.loggerService.setLoggerError(this.constructor.name,"updateRecord",e)}}updateLocalStorageRecord(){let e=localStorage.getItem(s.BU.BOOKMARKS_DATA)?JSON.parse(localStorage.getItem(s.BU.BOOKMARKS_DATA)):[],o=null;for(let i of e)if(this.dataJsonObj.selectedBookmarkDataForEdit.id===i.id){i.bookmark_name=this.dataJsonObj.bookmarkName,o=i;break}localStorage.setItem(s.BU.LEAFLET_BOOKMARKS+this.dataJsonObj.selectedBookmarkDataForEdit.id,JSON.stringify(o)),localStorage.setItem(s.BU.BOOKMARKS_DATA,JSON.stringify(e)),this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_EDIT"),$("#bookmarkNameUpdate").modal("hide"),this.getAllRecords()}bookmarkLocate(e){localStorage.removeItem(s.BU.MAP_URL),localStorage.setItem("selectedBookmarkData",JSON.stringify(e)),this.commonService.redirectToUrl(["maps","maps","list"],!0,!1,{},this.route)}bookmarkDirection(e){localStorage.removeItem(s.BU.FROM_ASSET),localStorage.setItem(s.BU.TO_LOCATE_FLEET_NAME,e.bookmark_name);const o=JSON.parse(JSON.stringify(e));o.geometry={type:"Point",coordinates:o.geo_coordinates?[o.geo_coordinates[1],o.geo_coordinates[0]]:["",""]},o.properties||(o.properties={level:e.floor_name,levelDisplay:e.floor_name}),localStorage.setItem(s.BU.TO_ASSET,JSON.stringify(o)),this.commonService.redirectToUrl(["facilities","facilities","locate"],!0,!1,{bookmarkId:e.id},this.route)}commonErrorCodes(e){const o=JSON.parse(e[s.BU.STATUS]);409===o&&(this.dataJsonObj.error="COMMON_STATUS_CODES."+o)}onHeaderItemClick(e){switch(e.type){case"search":this.getSearchResult(e.event);break;case"search_close":this.searchClose();break;case"display_views":this.selectedViewType(e.event)}}selectedViewType(e){this.dataJsonObj.selectedDisplayView=e}onPageLevelActionClicked(e){}ngAfterContentInit(){this.commonService.showHeaderFooter()}static \u0275fac=function(o){return new(o||d)(t.Y36(S.v),t.Y36(u.v),t.Y36(A),t.Y36(h.gz),t.Y36(k.Y),t.Y36(v.m),t.Y36(M.s),t.Y36(p.sK))};static \u0275cmp=t.Xpm({type:d,selectors:[["app-bookmark-list"]],viewQuery:function(o,a){if(1&o&&(t.Gf(P,5),t.Gf(V,5)),2&o){let i;t.iGM(i=t.CRH())&&(a.datatableComponent=i.first),t.iGM(i=t.CRH())&&(a.bookmarkNamevalid=i.first)}},outputs:{searchValueChange:"searchValueChange"},features:[t._Bn([A,k.Y,S.v,u.v]),t.qOj],decls:32,vars:47,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","defaultView","isFabDisplay","pageActionsList","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu","headerItemClick"],["id","extraPaddingBottomID",1,"card-body","pdt-0"],["id","tagid",3,"header","actions","listingVariables","paginator","totalPages","totalRecords","data","mobileListData","expand","statsSearch","pageName","showSpinner","selectedDisplayViewType","selectedFilterType","selectedMenuId","selectedSubMenuId","actionClicked","itemClickEvent","loadPageData"],["datatableComponent",""],[1,"mgt-5"],[3,"isFabDisplay","actionsList","selectedAction"],["id","bookmarkNameUpdate","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade","spotlight-add-modal"],["role","document",1,"modal-dialog","modal-sm","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header",2,"border-top-left-radius","2px","border-top-right-radius","2px"],["id","exampleModalLabel",1,"modal-title"],[1,"modal-body","ios-content"],[1,"forms-wrapper","mgb-10"],[1,"row","form-bs"],[1,"col-md-12"],["disabled","false","mandatory","true","autoCaseFlag","false","id","bookmark-list-addpopup-bookmarkname",3,"label","value","maxlength","valueChange"],["bookmarkNamevalid",""],[1,"error-msg","col-md-12","text-danger","text-center","mb-0"],[1,"col-md-12","text-end","mt-2"],["className","btn btn-primary btn-sm","id","bookmark-list-addpopup-update",1,"mgr-5",3,"label","buttonOnClick"],["className","btn btn-danger btn-sm","data-bs-dismiss","modal","aria-label","Close","id","bookmark-list-addpopup-close",3,"label","buttonOnClick"]],template:function(o,a){1&o&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-pageheader",3),t.NdJ("headerItemClick",function(n){return a.onHeaderItemClick(n)}),t.qZA()(),t.TgZ(4,"div",4)(5,"app-datatable",5,6),t.NdJ("actionClicked",function(n){return a.onActionClicked(n)})("itemClickEvent",function(n){return a.onItemClicked(n)})("loadPageData",function(n){return a.loadPageData(n)}),t.qZA(),t.TgZ(7,"div",7)(8,"app-page-actions",8),t.NdJ("selectedAction",function(n){return a.onPageLevelActionClicked(n)}),t.qZA()()()()(),t.TgZ(9,"div",9)(10,"div",10)(11,"div",11)(12,"div",12)(13,"div",13),t._uU(14),t.ALo(15,"translate"),t.ALo(16,"translate"),t.qZA()(),t.TgZ(17,"div",14)(18,"div",15)(19,"div",16)(20,"div",17)(21,"app-input",18,19),t.NdJ("valueChange",function(n){return a.changeBookmarkName(n)}),t.ALo(23,"translate"),t.qZA()(),t.TgZ(24,"div",20),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"div",21)(28,"app-button",22),t.NdJ("buttonOnClick",function(){return a.updateLocalStorageRecord()}),t.ALo(29,"translate"),t.qZA(),t.TgZ(30,"app-button",23),t.NdJ("buttonOnClick",function(){return a.cancelBtn()}),t.ALo(31,"translate"),t.qZA()()()()()()()()),2&o&&(t.xp6(3),t.Q6J("pageName",a.dataJsonObj.pageName)("defaultView",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.defaultView)("isFabDisplay",!1)("pageActionsList",a.dataJsonObj.pageActionsList)("pageTitle",a.dataJsonObj.pageTitle)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!0)("showDependencySubMenu",!1),t.xp6(2),t.Q6J("header",a.dataJsonObj.tableColumnheaders)("actions",a.dataJsonObj.actionsList)("listingVariables",a.listingVariables)("paginator",!0)("totalPages",a.listingVariables.totalpages)("totalRecords",a.listingVariables.totalRecords)("data",a.dataJsonObj.dataList)("mobileListData",a.dataJsonObj.mobileListData)("expand",!1)("statsSearch",a.dataJsonObj.searchTerm)("pageName",a.dataJsonObj.pageName)("showSpinner",a.dataJsonObj.showSpinner)("selectedDisplayViewType",a.dataJsonObj.selectedDisplayView)("selectedFilterType",a.dataJsonObj.selectedFilter)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId),t.xp6(3),t.Q6J("isFabDisplay",!0)("actionsList",a.dataJsonObj.pageActionsList),t.xp6(6),t.AsE("",t.lcZ(15,35,"MAP.BOOKMARK")," - ",t.lcZ(16,37,"COMMON_BUTTONS.BUTTON_EDIT"),""),t.xp6(7),t.s9C("label",t.lcZ(23,39,"MAP.BOOKMARK_NAME")),t.s9C("value",null==a.dataJsonObj?null:a.dataJsonObj.bookmarkName),t.Q6J("maxlength",40),t.xp6(4),t.hij(" ",t.lcZ(26,41,a.dataJsonObj.bookmarkPopupError)," "),t.xp6(3),t.s9C("label",t.lcZ(29,43,"COMMON_BUTTONS.BUTTON_SUBMIT")),t.xp6(2),t.s9C("label",t.lcZ(31,45,"COMMON_BUTTONS.BUTTON_CANCEL")))},dependencies:[y.r,D.a,E.n,R.q,U.y,p.X$]})}return d})(),data:{pageName:s.hf.BOOKMARKS}}];let K=(()=>{class d{static \u0275fac=function(o){return new(o||d)};static \u0275mod=t.oAB({type:d});static \u0275inj=t.cJS({imports:[h.Bz.forChild(_),h.Bz]})}return d})();var F=r(93144),C=r(24006),w=r(32174),Z=r(65673),G=r(73162),Y=r(75896),H=r(3848);let z=(()=>{class d{static \u0275fac=function(o){return new(o||d)};static \u0275mod=t.oAB({type:d});static \u0275inj=t.cJS({imports:[T.ez,p.aw,K,F.U$,C.u5,C.UX,w.fx,Z.Q,G.Cv,Y.ActivitiesModule,H.Nh]})}return d})()}}]);