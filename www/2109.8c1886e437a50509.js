"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2109],{92109:(K,v,s)=>{s.r(v),s.d(v,{CouponsMobileModule:()=>X});var w=s(32174),g=s(36895),N=s(32137),_=s(11210),m=s(15439),h=s(71568),V=s(75875),e=s(94650);let b=(()=>{class n{authService;commonService;constructor(o,i){this.authService=o,this.commonService=i}getCouponsMobileList(o){return this.commonService.getStaticApiCall("assets/enterprises/"+o+"/coupons/coupons.json","assets/enterprises/"+o+"/coupons/","coupons.json")}static \u0275fac=function(i){return new(i||n)(e.LFG(V.e),e.LFG(h.v))};static \u0275prov=e.Yz7({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var E=s(30578),I=s(42786),a=s(32236),y=s(81145),u=s(62510),U=s(11481),M=s(30958),O=s(37415),d=s(54463),C=s(63556);function P(n,c){if(1&n&&(e.TgZ(0,"div")(1,"ion-avatar",14),e._UZ(2,"img",15),e.ALo(3,"imageTransform"),e.qZA()()),2&n){const o=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("src",e.Dn7(3,1,null==o?null:o.coupon_image_file_path,null==o?null:o.coupon_barcode_image,i.publishEnabled),e.LSH)}}function A(n,c){if(1&n&&(e.TgZ(0,"div")(1,"ion-avatar",14),e._UZ(2,"img",15),e.ALo(3,"imageTransform"),e.qZA()()),2&n){const o=e.oxw().$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("src",e.Dn7(3,1,null==o?null:o.coupon_image_file_path,null==o?null:o.coupon_image,i.publishEnabled),e.LSH)}}function L(n,c){if(1&n){const o=e.EpF();e.TgZ(0,"ion-list",9)(1,"ion-item",10),e.NdJ("click",function(){const l=e.CHM(o).$implicit,r=e.oxw(2);return e.KtG(r.coupondetail(l))}),e.YNc(2,P,4,5,"div",6),e.YNc(3,A,4,5,"div",6),e.TgZ(4,"ion-label",11)(5,"p",12),e._uU(6),e.qZA(),e.TgZ(7,"p",13),e._uU(8),e.qZA()()()()}if(2&n){const o=c.$implicit;e.xp6(2),e.Q6J("ngIf",!0===(null==o?null:o.is_display_html)),e.xp6(1),e.Q6J("ngIf",!1===(null==o?null:o.is_display_html)),e.xp6(3),e.Oqu(null==o?null:o.coupon_name),e.xp6(2),e.AsE("Offer Valid ",null==o?null:o.startdatetime," To ",null==o?null:o.enddatetime,"")}}function Z(n,c){if(1&n&&(e.TgZ(0,"div"),e.YNc(1,L,9,5,"ion-list",8),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("ngForOf",o.couponsMobileData)}}function R(n,c){if(1&n&&(e.TgZ(0,"ion-grid",16)(1,"ion-row")(2,"ion-col",17)(3,"div",18),e._UZ(4,"img",19),e.ALo(5,"imageTransform"),e.TgZ(6,"h3",20),e._uU(7),e.ALo(8,"translate"),e.qZA()()()()()),2&n){const o=e.oxw();e.xp6(4),e.Q6J("src",e.Dn7(5,2,null==o.DefaultUiSettingsData?null:o.DefaultUiSettingsData.enterprise_top_image_file_path,null==o.DefaultUiSettingsData?null:o.DefaultUiSettingsData.enterprise_top_image_file_name,o.publishEnabled),e.LSH),e.xp6(3),e.hij(" ",e.lcZ(8,6,"COUPONS.NO_COUPONS_VALIDATION_MESSAGES")," ")}}let Y=(()=>{class n{apiEndPointUrl;loggerService;router;sanitizer;commonService;couponMobileService;listingVariables;platform;syncService;DefaultUiSettingsData;apiEndPoint;contentPageObj;couponsMobileData;enterpriseId;forceRefresh=!1;fossilrimImage;localendpoint;noResultFound=!1;publishEnabled=!1;syncEnabled=!1;syncFreq;dataJsonObj={};errorObj={};constructor(o,i,t,l,r,p,f,S,D){this.apiEndPointUrl=o,this.loggerService=i,this.router=t,this.sanitizer=l,this.commonService=r,this.couponMobileService=p,this.listingVariables=f,this.platform=S,this.syncService=D}ngOnInit(){this.dataJsonObj.pageName=a.hf.COUPONS,this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"COMMON_PAGE_TITLES.SAVINGS",value:"",showSubMenuDisplayName:!1}],this.commonService.trackView(a.sn.COUPON_LIST),this.DefaultUiSettingsData=JSON.parse(localStorage.getItem(a.BU.DEFAULT_UI_SETTINGS_DATA)),this.enterpriseId=localStorage.getItem(a.BU.SELECTED_ENTERPRISE)?localStorage.getItem(a.BU.SELECTED_ENTERPRISE):localStorage.getItem(a.BU.PARENT_ENTERPRISE_ID),this.apiEndPoint=localStorage.getItem(a.BU.S3_URL)?localStorage.getItem(a.BU.S3_URL):this.apiEndPointUrl,this.localendpoint=localStorage.getItem(a.BU.S3_URL)?localStorage.getItem(a.BU.S3_URL):this.apiEndPointUrl,this.fossilrimImage=this.localendpoint+this.DefaultUiSettingsData.enterprise_top_image_file_path+"/"+this.DefaultUiSettingsData.enterprise_top_image_file_name,this.getAllRecords(),this.getsyncSettings()}getsyncSettings(){let o=this.commonService.getSyncSettingsForOffileApk(a.hf.COUPONS);this.syncEnabled=o.syncEnabled,this.syncFreq=o.syncFreq,this.forceRefresh=o.forceRefresh,this.publishEnabled=o.publishEnabled}getAllRecords(){try{this.couponMobileService.getCouponsMobileList(this.enterpriseId).then(o=>{const i=[];if(o.length>0){this.noResultFound=!1,this.couponsMobileData&&this.couponsMobileData.length>0||(this.couponsMobileData=[]);for(let t=0;t<o.length;t++){o[t].imageDisplay=o[t].coupon_image_file_path&&o[t].coupon_barcode_image?this.apiEndPoint+o[t].coupon_image_file_path+"/"+o[t].coupon_barcode_image:"assets/coupon.png",o[t].couponImage=o[t].coupon_image_file_path&&o[t].coupon_image?this.apiEndPoint+o[t].coupon_image_file_path+"/"+o[t].coupon_image:"assets/coupon.png",o[t].startdatetime=m(o[t].start_datetime).format("DD-MMM-YYYY"),o[t].enddatetime=m(o[t].end_datetime).format("DD-MMM-YYYY"),o[t].imageName=o[t].coupon_name;const l=this.couponsMobileData.find(p=>p._id===parseInt(o[t]._id,10)),r=(new Date).toString();!l&&Date.parse(o[t].end_datetime)>=Date.parse(r)&&(this.couponsMobileData=this.couponsMobileData.filter(p=>p._id!==o[t]._id),this.couponsMobileData.push(o[t])),i.push(o[t])}this.couponsMobileData=i,this.listingVariables.totalRecords=i.length}else this.noResultFound=!0,this.couponsMobileData=[],this.contentPageObj=[]},o=>{this.noResultFound=!0,this.couponsMobileData=[],this.loggerService.setLoggerError(this.constructor.name,"getAllRecords",o)})}catch(o){this.loggerService.setLoggerError(this.constructor.name,"getAllRecords",o)}}coupondetail(o){this.router.navigate(["couponsui/"+o._id+"/couponsui/view"])}getMediaFiles(o){try{let i;if(o.is_display_html?(o.imageDisplay=this.apiEndPoint+o.coupon_image_file_path+"/"+o.coupon_barcode_image,i=o.coupon_barcode_image):(o.couponImage=this.apiEndPoint+o.coupon_image_file_path+"/"+o.coupon_image,i=o.coupon_image),this.platform.is("android")||this.platform.is("ios")||this.platform.is("ipad")||this.platform.is("iphone")||this.platform.is("tablet"))try{this.syncService.getMobileAssetsData(o.coupon_image_file_path,i,"image").then(t=>{let l=this.sanitizer.bypassSecurityTrustUrl(t);o.is_display_html?o.imageDisplay=l:o.couponImage=l}).catch(t=>{})}catch(t){this.loggerService.setLoggerError(this.constructor.name,"getMobileAssetsData",t)}}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getMediaFiles",i)}}ngAfterContentInit(){this.commonService.showHeaderFooter(),this.commonService.getDynamicHeight()}static \u0275fac=function(i){return new(i||n)(e.Y36("apiEndPoint"),e.Y36(I.m),e.Y36(u.F0),e.Y36(U.H7),e.Y36(h.v),e.Y36(b),e.Y36(E.v),e.Y36(M.t4),e.Y36(y._))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-coupons-mobile-list"]],features:[e._Bn([E.v])],decls:8,vars:6,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"container-fluid"],["color","primary",1,"m-3","d-block"],[4,"ngIf"],["class","coupons-wrapper",4,"ngIf"],["class","coupons-list",4,"ngFor","ngForOf"],[1,"coupons-list"],["lines","full","detail","",1,"coupons-item",3,"click"],[1,"ion-no-margin"],["id","coupons-description",1,"coupon-desc"],["id","coupons-validity",1,"coupon-validity"],[1,"asset-avatar-img","bd-1"],["id","facilities-imagepath","onerror","this.onerror=null;this.src='assets/coupon.png';",3,"src"],[1,"coupons-wrapper"],["size","12",1,"ion-no-padding","ion-text-center"],[1,"logo","text-center"],["id","homefossil-fossilrim-logo",1,"mgt-5",3,"src"],["id","coupons-validationmessage",1,"coupons-validation-txt"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"app-pageheader",3),e.qZA(),e.TgZ(4,"div",4),e._UZ(5,"ion-label",5),e.YNc(6,Z,2,1,"div",6),e.YNc(7,R,9,8,"ion-grid",7),e.qZA()()()),2&i&&(e.xp6(3),e.Q6J("pageName",t.dataJsonObj.pageName)("pageTitle",t.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),e.xp6(3),e.Q6J("ngIf",!1===t.noResultFound),e.xp6(1),e.Q6J("ngIf",!0===t.noResultFound))},dependencies:[g.sg,g.O5,O.q,d.X$,C.D],styles:[".logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100px}"]})}return n})();var x=s(15861),F=s(96971),J=s(65063);function B(n,c){if(1&n&&(e.TgZ(0,"div",11),e._UZ(1,"img",12),e.ALo(2,"imageTransform"),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("src",e.Dn7(2,1,null==o.couponViewData?null:o.couponViewData.coupon_image_file_path,null==o.couponViewData?null:o.couponViewData.coupon_barcode_image,o.publishEnabled),e.LSH)}}function j(n,c){if(1&n&&(e.TgZ(0,"div",11),e._UZ(1,"img",12),e.ALo(2,"imageTransform"),e.qZA()),2&n){const o=e.oxw();e.xp6(1),e.Q6J("src",e.Dn7(2,1,null==o.couponViewData?null:o.couponViewData.coupon_image_file_path,null==o.couponViewData?null:o.couponViewData.coupon_image,o.publishEnabled),e.LSH)}}const Q=[{path:"",data:{title:"dashboard"},children:[{path:"",redirectTo:"couponsui/list",pathMatch:"full"},{path:"couponsui/list",canActivate:[_.P],component:Y,data:{object_type:a.hf.COUPONSUI,title:"",responsibilityParam:a.bP.MENUS+"."+a.R0.COUPONSUI+"."+a.bP.SUBMENUS+"."+a.R0.COUPONSUI+"."+a.In.ENABLED,pageName:a.hf.COUPONSUI}},{path:":id/couponsui/view",canActivate:[_.P],component:(()=>{class n{apiEndPointUrl;loggerService;router;sanitizer;commonService;couponMobileService;platform;route;syncService;apiEndPoint;couponViewData;enterpriseId;forceRefresh=!1;publishEnabled=!1;recordId;syncEnabled=!1;syncFreq;dataJsonObj={};errorObj={};constructor(o,i,t,l,r,p,f,S,D){this.apiEndPointUrl=o,this.loggerService=i,this.router=t,this.sanitizer=l,this.commonService=r,this.couponMobileService=p,this.platform=f,this.route=S,this.syncService=D,this.route.params.subscribe(q=>{this.recordId=q.id,this.getCouponsViewData()})}ngOnInit(){this.dataJsonObj.pageName=a.hf.COUPONS,this.dataJsonObj.pageTitle=[{key:"COMMON_PAGE_TITLES.SAVINGS",value:"",showSubMenuDisplayName:!1},{key:"",value:"-",showSubMenuDisplayName:!1},{key:"COMMON_BUTTONS.BUTTON_VIEW",value:"",showSubMenuDisplayName:!1}],this.enterpriseId=localStorage.getItem(a.BU.SELECTED_ENTERPRISE)?localStorage.getItem(a.BU.SELECTED_ENTERPRISE):localStorage.getItem(a.BU.PARENT_ENTERPRISE_ID),this.getCouponsViewData(),this.apiEndPoint=localStorage.getItem(a.BU.S3_URL)?localStorage.getItem(a.BU.S3_URL):this.apiEndPointUrl,this.getsyncSettings()}getsyncSettings(){var o=this;return(0,x.Z)(function*(){const i=yield o.commonService.getCacheSettings(a.hf.COUPONS);o.syncEnabled=i.cacheEnabled,o.syncFreq=i.syncFreq,o.forceRefresh=i.forceRefresh,o.publishEnabled=i.publishEnabled})()}getCouponsViewData(){try{this.couponMobileService.getCouponsMobileList(this.enterpriseId).then(o=>{o.length>0&&(this.couponViewData=o.find(i=>i._id===parseInt(this.recordId,10)),this.couponViewData&&(this.commonService.trackView(a.sn.COUPON_VIEW+"-"+this.couponViewData.coupon_name),this.couponViewData.isDisplayHtml?this.couponViewData.imgFile=this.couponViewData.coupon_barcode_image?this.apiEndPoint+this.couponViewData.coupon_image_file_path+"/"+this.couponViewData.coupon_barcode_image:"assets/coupon.png":this.couponViewData.couponImage=this.couponViewData.coupon_image_file_path&&this.couponViewData.coupon_image?this.apiEndPoint+this.couponViewData.coupon_image_file_path+"/"+this.couponViewData.coupon_image:"assets/coupon.png",this.couponViewData.startDateValue=m(this.couponViewData.start_datetime).format("DD-MMM-YYYY"),this.couponViewData.endDateValue=m(this.couponViewData.end_datetime).format("DD-MMM-YYYY")))},o=>{this.loggerService.setLoggerError(this.constructor.name,"getCouponsViewData",o)})}catch(o){this.loggerService.setLoggerError(this.constructor.name,"getCouponsViewData",o)}}couponList(){this.router.navigate(["couponsui/couponsui/list"])}getMediaFiles(o){try{let i;if(o.is_display_html?(o.imgFile=this.apiEndPoint+o.coupon_image_file_path+"/"+o.coupon_barcode_image,i=o.coupon_barcode_image):(o.couponImage=this.apiEndPoint+o.coupon_image_file_path+"/"+o.coupon_image,i=o.coupon_image),this.platform.is("android")||this.platform.is("ios")||this.platform.is("ipad")||this.platform.is("iphone")||this.platform.is("tablet"))try{this.syncService.getMobileAssetsData(o.coupon_image_file_path,i,"image").then(t=>{let l=this.sanitizer.bypassSecurityTrustUrl(t);o.is_display_html?o.imgFile=l:o.couponImage=l}).catch(t=>{})}catch(t){this.loggerService.setLoggerError(this.constructor.name,"getMobileAssetsData",t)}}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getMediaFiles",i)}}static \u0275fac=function(i){return new(i||n)(e.Y36("apiEndPoint"),e.Y36(I.m),e.Y36(u.F0),e.Y36(U.H7),e.Y36(h.v),e.Y36(b),e.Y36(M.t4),e.Y36(u.gz),e.Y36(y._))};static \u0275cmp=e.Xpm({type:n,selectors:[["app-coupons-mobile-view"]],features:[e._Bn([d.sK,J.f,F.j])],decls:16,vars:11,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"card-body","pdt-0","pdl-5","pdr-5"],[1,"coupondetails-block"],["id","coupondetail-title"],["id","coupondetails-description",1,"coupon-light-txt","fs-15"],["id","coupondetails-validity",1,"coupon-dark-txt","fs-13"],["id","coupondetails-validationmessage",1,"coupon-light-txt","fs-13"],["class","text-center",4,"ngIf"],[1,"text-center"],["onerror","this.onerror=null;this.src='assets/coupon.png';",3,"src"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._UZ(3,"app-pageheader",3),e.qZA(),e.TgZ(4,"div",4)(5,"div",5)(6,"h2",6),e._uU(7),e.qZA(),e.TgZ(8,"p",7),e._uU(9),e.qZA(),e.TgZ(10,"p",8),e._uU(11),e.qZA(),e.TgZ(12,"p",9),e._uU(13),e.qZA(),e.YNc(14,B,3,5,"div",10),e.YNc(15,j,3,5,"div",10),e.qZA()()()()),2&i&&(e.xp6(3),e.Q6J("pageName",t.dataJsonObj.pageName)("pageTitle",t.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),e.xp6(4),e.Oqu(null==t.couponViewData?null:t.couponViewData.coupon_name),e.xp6(2),e.Oqu(null==t.couponViewData?null:t.couponViewData.description),e.xp6(2),e.AsE("Offer Valid:- ",null==t.couponViewData?null:t.couponViewData.startDateValue," To ",null==t.couponViewData?null:t.couponViewData.endDateValue,""),e.xp6(2),e.hij("Coupon Code:- ",null==t.couponViewData?null:t.couponViewData.coupon_code,""),e.xp6(1),e.Q6J("ngIf",1==(null==t.couponViewData?null:t.couponViewData.is_display_html)),e.xp6(1),e.Q6J("ngIf",0==(null==t.couponViewData?null:t.couponViewData.is_display_html)))},dependencies:[g.O5,O.q,C.D]})}return n})(),data:{object_type:a.hf.COUPONSUI,title:"",responsibilityParam:a.bP.MENUS+"."+a.R0.COUPONSUI+"."+a.bP.SUBMENUS+"."+a.R0.COUPONSUI+"."+a.In.ENABLED,pageName:a.hf.COUPONSUI}}]}];let z=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[u.Bz.forChild(Q),u.Bz]})}return n})();var T=s(24006),G=s(93144),$=s(65673);let X=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=e.oAB({type:n});static \u0275inj=e.cJS({imports:[z,g.ez,d.aw,T.u5,T.UX,G.U$,w.fx,$.Q,N.D]})}return n})()}}]);