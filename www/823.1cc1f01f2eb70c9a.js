"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[823],{10823:(ie,w,n)=>{n.r(w),n.d(w,{CallrecordsModule:()=>ae});var S=n(36895),j=n(24006),P=n(65673),R=n(93144),O=n(54463),_=n(32174),F=n(73162),f=n(62510),y=n(15861),v=n(75890),I=n(71568),L=n(42786),o=n(32236),N=n(47561),C=n(30578),E=n(90313),J=n(26850),B=n(75023),t=n(94650),k=n(10805),Y=n(2387),H=n(56368),T=n(28168),q=n(11735),U=n(37415);function G(l,se){if(1&l){const e=t.EpF();t.TgZ(0,"app-button",34),t.NdJ("buttonOnClick",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.playRecordedVideo())}),t.ALo(1,"translate"),t.qZA()}2&l&&t.s9C("label",t.lcZ(1,1,"COMMON_BUTTONS.BUTTON_PLAY"))}function Q(l,se){if(1&l){const e=t.EpF();t.TgZ(0,"app-button",34),t.NdJ("buttonOnClick",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.callintiate())}),t.ALo(1,"translate"),t.qZA()}2&l&&t.s9C("label",t.lcZ(1,1,"COMMON_FIELDS.CALL"))}let z=(()=>{class l extends N.O{route;router;commonService;callrecordService;listingVariables;translateService;socketService;facilitiesService;loggerService;callCreateUserid;callRecordViewObj;calledBy;calledstatus;callrecordPath;callrecordStatus;checkBoxtooltip;checkboxOptions;checkboxValue;createdBy;createdDate;enableSubmitButton=!1;enterpriseId;header1;isCoordinator;isEnableCheckBox=!1;lastUpdatedBy;lastUpdatedDate;loginUserId;palyRecordAccess=!1;participantsListData=[];recordId;rowsPerPage;totalRecords;userToken;accordionOrderNumber;className;codeobj;friendId;actions;addressUrl;loginUserDateFormat;userTimeZoneObj={};startDate;joinedAt;dataJsonObj={};constructor(e,i,a,s,r,d,u,h,b){super(e,a),this.route=e,this.router=i,this.commonService=a,this.callrecordService=s,this.listingVariables=r,this.translateService=d,this.socketService=u,this.facilitiesService=h,this.loggerService=b,this.route.params.subscribe(c=>{this.recordId=c.id}),this.route.queryParams.subscribe(c=>{this.dataJsonObj.queryParamsObj={defaultView:c.defaultView,selectedMenuId:c.selectedMenuId,selectedSubMenuId:c.selectedSubMenuId}})}ngOnInit(){this.actions={LOCATE:this.roleRightsValidationByPage(o.hf.CALL_RECORDS,o.AM.ACTIONS,o.In.LOCATE)},this.initializeComponent(),$("#recordpopup").appendTo($("body"))}initializeComponent(){this.dataJsonObj.pageName=o.hf.CALL_RECORD,this.loginUserId=localStorage.getItem(o.BU.USER_ID),this.getRecordById(this.recordId),this.accordionOrderNumber=0;const e=this.commonService.getLoginUserTimeZoneDateFormat();this.loginUserDateFormat=e.dateFormat,this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(e.timeZoneDescription),this.userTimeZoneObj.timeZoneCode=e.timeZoneCode,this.className="callrecords-mobile-content",this.dataJsonObj.selectedPage=o.hf.CALL_RECORD,this.getDynamicJson([{folderName:"menu_manager",jsonType:"",storingFieldName:"menuDataJson"}]),this.dataJsonObj.showrecordhistory=this.roleRightsValidationByPage(o.hf.CALL_RECORD,o.AM.ACTIONS,o.In.RECORD_HISTORY)}getDynamicJson(e){var i=this;return(0,y.Z)(function*(){for(let a of e)i.dataJsonObj[a.storingFieldName]=yield i.commonService.getDynamicJson(i.enterpriseId,a.folderName,a.jsonType);i.dataJsonObj.selectedObj={},i.dataJsonObj.selectedObj.recordId=i.recordId,i.dataJsonObj.selectedObj.pageObj=i.dataJsonObj.menuDataJson.filter(a=>a.menu_page.page_name===i.dataJsonObj.selectedPage),i.dataJsonObj.selectedObjEnabled=!0})()}ionViewWillEnter(){this.getRecordById(this.recordId)}getRecordById(e){try{this.callrecordService.get(this.userToken,e).subscribe(i=>{this.dataJsonObj.pageTitle=[{key:"COMMON_PAGE_TITLES.CALL_LOG",value:"",showSubMenuDisplayName:!1},{key:"",value:"-",showSubMenuDisplayName:!1},{key:"COMMON_BUTTONS.BUTTON_VIEW",value:"",showSubMenuDisplayName:!1}],this.callCreateUserid=i.created_by.user_id,this.isEnableCheckBox=this.callCreateUserid===parseInt(this.loginUserId,10),i.notification_type=i.notification_type,this.callRecordViewObj=i;const a=this.displayDateFormatter(i.createdAt,!1,!0);this.startDate=a.startDate,this.callRecordViewObj.createdAt=this.startDate,this.calledBy=this.callRecordViewObj.participants[0].user_profile_id.l_name+" "+this.callRecordViewObj.participants[0].user_profile_id.f_name,this.calledstatus=this.lookupLanguageTranslations(i.status.lookup_id),this.participantsListData=i.participants,this.totalRecords=this.participantsListData.lenth;for(let s=0;s<this.participantsListData.length;s++){const r=this.displayDateFormatter(this.participantsListData[s].joined_at,!1,!0);this.joinedAt=r.startDate,this.callRecordViewObj.createdAt=this.startDate,this.participantsListData[s].participantName=this.participantsListData[s].user_profile_id.l_name+", "+this.participantsListData[s].user_profile_id.f_name,this.participantsListData[s].displystatus=this.lookupLanguageTranslations(this.participantsListData[s].status.lookup_id),this.participantsListData[s].joinedAt=this.participantsListData[s].joined_at?this.joinedAt:"",this.palyRecordAccess=this.callCreateUserid===parseInt(this.loginUserId,10)&&!0===this.participantsListData[s].record_access,i.participants&&i.participants.length>0&&(this.participantsListData[s].mobile_display_data=[],this.participantsListData[s].mobile_display_data[0]=this.participantsListData[s].user_profile_id.l_name+", "+this.participantsListData[s].user_profile_id.f_name,this.participantsListData[s].mobile_display_data[1]=this.participantsListData[s].joined_at?this.joinedAt:"",this.participantsListData[s].mobile_display_data[2]=this.lookupLanguageTranslations(this.participantsListData[s].status.lookup_id))}this.callRecordViewObj.record_files&&this.callRecordViewObj.record_files.length>0&&(this.callrecordPath=this.callRecordViewObj.record_files[0].record_file_path),this.lastUpdatedBy=this.callRecordViewObj.updated_by,this.createdBy=this.callRecordViewObj.created_by,this.enterpriseId=this.callRecordViewObj.enterprise.enterprise_id},i=>{this.loggerService.setLoggerError(this.constructor.name,"getViewDetails",i)})}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getViewDetails",i)}this.header1=[[{field:"participantName",header:this.translateService.instant("COMMON_FIELDS.USER_NAME")},{field:"joinedAt",header:this.translateService.instant("CALL.JOINED_AT"),class:"w-160 list-value-right"},{field:"displystatus",header:this.translateService.instant("COMMON_ADDRESS_BLOCK.STATE"),class:"w-120"},{headersort:"disableth",sortfield:"users",field:"users",header:"COMMON_FIELDS.ACTIONS",class:"w-60"}]],this.checkboxOptions=[{displayname:"",key:"checkbox1"}]}changecheckBox(e,i){this.enableSubmitButton=!0;for(let a=0;a<this.participantsListData.length;a++)i===a&&(this.participantsListData[a].record_access=e.value)}playRecordedVideo(){$("#recordpopup").modal("show"),$(".modal-backdrop").insertAfter("#recordpopup")}update(){for(let e=0;e<this.participantsListData.length;e++)this.participantsListData[e].participantName=this.participantsListData[e].user_profile_id.f_name,this.participantsListData[e].status="Active"===this.participantsListData[e].status?o.oP.ACTIVE:o.oP.INACTIVE;try{this.callrecordService.update(this.recordId,{participants:this.participantsListData}).then(i=>{this.router.navigateByUrl("/callrecords")},i=>{})}catch(e){this.loggerService.setLoggerError(this.constructor.name,"update",e)}}closeBtn(){this.router.navigateByUrl("/callrecords")}doInfinite(e){this.listingVariables.pageNumbers=e,this.getRecordById(this.recordId)}callintiate(){const e={room:this.callRecordViewObj.room,user:JSON.parse(localStorage.getItem(o.BU.USER)),group:"",groupId:"",usernames:""};let a,i=this.participantsListData;if(i){const r=i.findIndex(d=>d.user_profile_id._id==+localStorage.getItem(o.BU.LOG_IN_USER_ID));r>-1&&i.splice(r,1)}const s=i.length-2;i.length>1&&(a=i[0].user_profile_id.f_name+" "+i[0].user_profile_id.l_name,E.L.isEmpty(i[1])||(a=a+", "+i[1].user_profile_id.f_name+" "+i[1].user_profile_id.l_name),s>0&&(a=a+" and "+s+" Others")),e.usernames=a;for(let r=0;r<i.length;r++)this.socketService.subscribeForAudioVideoCall(i[r].user_profile_id._id),this.socketService.emitForAudioVideoCall(e);this.router.navigate(["call/"+this.callRecordViewObj.room])}onActionClicked(e){try{e.action===o.A0.LOCATE&&this.locateUser(e)}catch(i){this.loggerService.setLoggerError(this.constructor.name,"onActionClicked",i)}}locateUser(e){this.friendId=e.data.user_profile_id._id,this.facilitiesService.getBuildingId(this.friendId,"userprofiles").then(i=>{if(this.codeobj=i,this.codeobj&&this.codeobj.buildingCode)localStorage.setItem(o.BU.SELECTED_FLEET,JSON.stringify({facilityId:this.codeobj.facilityId,geometry:{type:"Point",coordinates:[this.codeobj.facilityCoordinates[1],this.codeobj.facilityCoordinates[0]]}})),this.facilitiesService.getStaticContentJson(localStorage.getItem(o.BU.SELECTED_ENTERPRISE),this.codeobj.buildingCode,"").then(s=>{localStorage.setItem(o.BU.LC_USER_INFO,JSON.stringify(s)),localStorage.setItem(o.BU.UCURRENT_FLOOR_NAME,this.codeobj.currentFloor),this.callrecordService.singlelocateuser("locate",s.floorsData[0]._id,!0,"ucurrentfloorname",this.friendId,this.codeobj.facilityId,this.codeobj.currentFloorId,s.facility_name,this.codeobj.facilityCoordinates[0],this.codeobj.facilityCoordinates[1])});else try{this.commonService.getUserProfileDetails(this.friendId).then(a=>{a.address.length>0&&(a.address[0].address_line1.includes("# ")&&(a.address[0].address_line1=a.address[0].address_line1.split("#")[1]),this.addressUrl=this.commonService.getLocationMapUrl(a.address[0].address_line1+", "+a.address[0].address_line2+", "+a.address[0].city+", "+a.address[0].state.state_name+" "+a.address[0].ZIP),window.open(this.addressUrl[0],this.addressUrl[1]))})}catch(a){this.loggerService.setLoggerError(this.constructor.name,"locateUser",a)}},i=>{})}displayDateFormatter(e,i,a){try{const s=a?this.commonService.convertDateToUserTimeZone(e,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):e,r={startDate:"",endDate:""};if(r.startDate=this.commonService.convertDateToUserFormat(s,o.eZ.HOURS_MINS,!0,"",!1),i){const d=a?this.commonService.convertDateToUserTimeZone(e,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):e,u=this.commonService.addHoursToDate(d,120);r.endDate=this.commonService.convertDateToUserFormat(u,o.eZ.HOURS_MINS,!0,"",!1)}return r}catch{}}static \u0275fac=function(i){return new(i||l)(t.Y36(f.gz),t.Y36(f.F0),t.Y36(I.v),t.Y36(v.R),t.Y36(C.v),t.Y36(O.sK),t.Y36(J.$),t.Y36(B.g),t.Y36(L.m))};static \u0275cmp=t.Xpm({type:l,selectors:[["app-callrecord-view"]],features:[t._Bn([v.R,I.v,C.v]),t.qOj],decls:53,vars:56,consts:[[1,"container-fluid"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu"],[1,"card-body"],[1,"row","form-bs"],[1,"col-md-4"],["disabled","true","id","callrecord-view-enterprise",3,"label","value"],["disabled","true","id","callrecord-view-room",3,"label","value"],["disabled","true","id","callrecord-view-calledby",3,"label","value"],["disabled","true","id","callrecord-view-createddatetime",3,"label","value"],["disabled","true","id","callrecord-view-callestaus",3,"label","value"],[1,"col-md-4","text-end","mt-2"],["id","notification-view-close","className","btn btn-primary btn-sm","class","mgr-5",3,"label","buttonOnClick",4,"ngIf"],["id","notification-view-close","className","btn btn-danger btn-sm",3,"label","buttonOnClick"],[1,"card"],[1,"card-content"],[3,"multiple"],[3,"selected"],[1,"d-flex","justify-content-between","w-100","accordion-header"],[1,"row"],["id","tagid",3,"className","totalRecords","header","expand","actions","paginator","data","enablethreedots","mobileListData","totalPages","ignoreDisplayView","actionClicked","infiniteScrollCalled"],["datatableComponent",""],[3,"createdBy","lastUpdatedBy","showrecordhistory","creationDate","lastUpdatedDate"],["id","recordpopup","tabindex","-1","role","dialog","aria-labelledby","exampleModalLabel","aria-hidden","true",1,"modal","fade"],["role","document",1,"modal-dialog","modal-lg","modal-dialog-centered"],[1,"modal-content"],[1,"modal-header",2,"border-top-left-radius","2px","border-top-right-radius","2px"],["id","exampleModalLabel",1,"modal-title"],[1,"col-md-12","text-center"],["width","300","height","240","poster","","controls","","preload","\u201cauto\u201d",1,"\u201cpx-movie-header__video\u201d",3,"src"],["id","notification-view-close","className","btn btn-primary btn-sm",1,"mgr-5",3,"label","buttonOnClick"]],template:function(i,a){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),t._UZ(6,"app-pageheader",6),t.qZA(),t.TgZ(7,"div",7)(8,"div",8)(9,"div",9),t._UZ(10,"app-input",10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"div",9),t._UZ(13,"app-input",11),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"div",9),t._UZ(16,"app-input",12),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"div",9),t._UZ(19,"app-input",13),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"div",9),t._UZ(22,"app-input",14),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"div",15),t.YNc(25,G,2,3,"app-button",16),t.YNc(26,Q,2,3,"app-button",16),t.TgZ(27,"app-button",17),t.NdJ("buttonOnClick",function(){return a.closeBtn()}),t.ALo(28,"translate"),t.qZA()()(),t._UZ(29,"div"),t.qZA()()(),t.TgZ(30,"div",3)(31,"div",18)(32,"div",19)(33,"p-accordion",20)(34,"p-accordionTab",21)(35,"p-header",22)(36,"span"),t._uU(37),t.ALo(38,"translate"),t.qZA()(),t.TgZ(39,"div",23)(40,"div",3)(41,"app-datatable",24,25),t.NdJ("actionClicked",function(r){return a.onActionClicked(r)})("infiniteScrollCalled",function(r){return a.doInfinite(r)}),t.qZA()()()(),t._UZ(43,"app-recordhistory",26),t.qZA()()()()()()(),t.TgZ(44,"div",27)(45,"div",28)(46,"div",29)(47,"div",30)(48,"div",31),t._uU(49),t.ALo(50,"translate"),t.qZA()(),t.TgZ(51,"div",32),t._UZ(52,"video",33),t.qZA()()()()),2&i&&(t.xp6(6),t.Q6J("pageName",a.dataJsonObj.pageName)("pageTitle",a.dataJsonObj.pageTitle)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!1)("showDependencySubMenu",!0),t.xp6(4),t.s9C("label",t.lcZ(11,40,"COMMON_PAGE_TITLES.ENTERPRISE")),t.s9C("value",null==a.callRecordViewObj||null==a.callRecordViewObj.enterprise?null:a.callRecordViewObj.enterprise.short_name),t.xp6(3),t.s9C("label",t.lcZ(14,42,"COMMON_FIELDS.ROOM")),t.s9C("value",null==a.callRecordViewObj?null:a.callRecordViewObj.room),t.xp6(3),t.s9C("label",t.lcZ(17,44,"COMMON_FIELDS.CALLED_BY")),t.s9C("value",a.calledBy),t.xp6(3),t.s9C("label",t.lcZ(20,46,"COMMON_FIELDS.CREATED_DATE_TIME")),t.s9C("value",null==a.callRecordViewObj?null:a.callRecordViewObj.createdAt),t.xp6(3),t.s9C("label",t.lcZ(23,48,"COMMON_FIELDS.STATUS")),t.s9C("value",a.calledstatus),t.xp6(3),t.Q6J("ngIf",a.callrecordPath),t.xp6(1),t.Q6J("ngIf","Inactive"===a.calledstatus),t.xp6(1),t.s9C("label",t.lcZ(28,50,"COMMON_BUTTONS.BUTTON_CLOSE")),t.xp6(6),t.Q6J("multiple",!0),t.xp6(1),t.Q6J("selected",!0),t.xp6(3),t.Oqu(t.lcZ(38,52,"COMMON_PAGE_TITLES.PARTICIPANTS")),t.xp6(4),t.s9C("className",a.className),t.Q6J("totalRecords",a.listingVariables.totalRecords)("header",a.header1)("expand",!1)("actions",a.actions)("paginator",!0)("data",a.participantsListData)("enablethreedots",!0)("mobileListData",a.participantsListData)("totalPages",a.listingVariables.totalpages)("ignoreDisplayView",!0),t.xp6(2),t.Q6J("createdBy",a.createdBy)("lastUpdatedBy",a.lastUpdatedBy)("showrecordhistory",a.dataJsonObj.showrecordhistory)("creationDate",null==a.callRecordViewObj?null:a.callRecordViewObj.createdAt)("lastUpdatedDate",null==a.callRecordViewObj?null:a.callRecordViewObj.updatedAt),t.xp6(6),t.Oqu(t.lcZ(50,54,"COMMON_BUTTONS.BUTTON_PLAY")),t.xp6(3),t.s9C("src",a.callrecordPath,t.LSH))},dependencies:[S.O5,k.h4,_.UQ,_.US,Y.r,H.a,T.n,q.W,U.q,O.X$]})}return l})();var V=n(42863),K=n(27601),D=n(15439),W=n(70057),X=n(88425);let Z=(()=>{class l extends N.O{listingVariables;commonService;columnheaders;callrecordService;translateService;route;router;loggerService;socketService;actionSheetController;location;actions;callRecordsList;callRecordsMobileListData;enableSearch=!1;enterpriseId;forcerefresh;noDuplicates=void 0;searchButton=!0;searchString;status;tableColumnheaders;userId;userToken;callrecordsAPISubcribe;mobileroutesArray;actionSheet;url;defaultTimeZone;loginuserProfileId;missed_calls_data;utcTimeZoneString;startDate;endDate;userTimeZoneObj={};loginUserDateFormat;dataJsonObj={};constructor(e,i,a,s,r,d,u,h,b,c,p){super(d,i),this.listingVariables=e,this.commonService=i,this.columnheaders=a,this.callrecordService=s,this.translateService=r,this.route=d,this.router=u,this.loggerService=h,this.socketService=b,this.actionSheetController=c,this.location=p,this.route.queryParams.subscribe(m=>{this.dataJsonObj.queryParamsObj={defaultView:m.default_view,selectedMenuId:m.selectedMenuId,selectedSubMenuId:m.selectedSubMenuId}}),this.location.onPopState(()=>{})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.showSpinner(),this.dataJsonObj.pageName=o.hf.CALL_RECORD,this.dataJsonObj.advancedSearchObj={},this.actions={JOIN_CALL:!0},this.translateService.use(localStorage.getItem(o.BU.LOGIN_USER_LANGUAGE)).subscribe(i=>{JSON.parse(localStorage.getItem(o.BU.MENU_CLICK_ITEM))}),this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"COMMON_PAGE_TITLES.CALL_LOGS",value:"",showSubMenuDisplayName:!0}],this.tableColumnheaders=this.columnheaders.getCallRecordsHeaders(),this.userId=localStorage.getItem(o.BU.USER_ID),this.loginuserProfileId=parseInt(localStorage.getItem(o.BU.LOG_IN_USER_ID)),this.searchString="",this.forcerefresh=!1,this.missed_calls_data=!1,this.url=this.router.url.split("/")[3],this.router.url.split("/")[3]&&"missed_calls"===this.router.url.split("/")[3]&&(this.missed_calls_data=!0);const e=this.commonService.getLoginUserTimeZoneDateFormat();this.loginUserDateFormat=e.dateFormat,this.userTimeZoneObj=this.commonService.getUTCMinuteAndSign(e.timeZoneDescription),this.userTimeZoneObj.timeZoneCode=e.timeZoneCode,this.userTimeZoneObj.timeZoneToDisplay=this.lookupLanguageTranslations(e.timeZoneID),this.commonService.currentEvent.subscribe(i=>{"callrecords"===i&&(this.forcerefresh=!0)}),this.dataJsonObj.addFiltersList=[],this.dataJsonObj.pageActionsList=[]}ionViewWillEnter(){this.actions={JOIN_CALL:!0}}ngOnDestroy(){this.callrecordsAPISubcribe&&(this.callrecordsAPISubcribe.unsubscribe(),this.callrecordsAPISubcribe=void 0),this.dataJsonObj.selectedFilter=""}enbaleSearch(){this.enableSearch?(this.enableSearch=!1,this.searchButton=!0):(this.enableSearch=!0,this.searchButton=!1)}getSearchResult(e){try{this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.searchString=e,this.getAllRecords()}catch(i){this.loggerService.setLoggerError(this.constructor.name,"getSearchResult",i)}}searchClose(){this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.searchString="",this.getAllRecords()}getAllRecords(){var e=this;return(0,y.Z)(function*(){try{e.enterpriseId=localStorage.getItem(o.BU.SELECTED_ENTERPRISE);const i=e.commonService.getMobileViewCondition(e.dataJsonObj.selectedDisplayView);e.callrecordsAPISubcribe&&(e.callrecordsAPISubcribe.unsubscribe(),e.callrecordsAPISubcribe=void 0);const a=e.dataJsonObj.selectedFilter?"&filtertype="+e.dataJsonObj.selectedFilter:"";e.showSpinner(),e.callrecordsAPISubcribe=e.callrecordService.getAll(e.userToken,e.searchString,e.listingVariables.pageNumbers,e.listingVariables.rowsPerPage,e.listingVariables.sortOrderColumn,e.enterpriseId,e.status,e.userId,e.forcerefresh,i,e.missed_calls_data,a,e.dataJsonObj.advancedSearchObj.inputAdvSearchObj).subscribe(s=>{if(e.hideSpinner(),e.forcerefresh&&(e.callRecordsMobileListData=[]),s.rows.length>0){e.callRecordsMobileListData&&e.callRecordsMobileListData.length>0||(e.callRecordsMobileListData=[]);for(let r=0;r<s.rows.length;r++){s.rows[r].display_grid_title=s.rows[r].called_by.l_name+" "+s.rows[r].called_by.f_name,s.rows[r].participantsdata=s.rows[r].participants,s.rows[r].status_lookup_name=s.rows[r].status.lookup_name,s.rows[r].status=s.rows[r].status?e.lookupLanguageTranslations(s.rows[r].status.lookup_id):"",s.rows[r].callroom=s.rows[r].room,s.rows[r].page_name=o.hf.CALL_RECORDS,s.rows[r].initiated_user=s.rows[r].called_by.l_name+" "+s.rows[r].called_by.f_name;const d=e.displayDateFormatter(s.rows[r].createdAt,!1,!0);e.startDate=d.startDate;const u=s.rows[r].end_datetime?e.displayDateFormatter(s.rows[r].end_datetime,!1,!0):{startDate:"",endDate:"",startDate1:""};e.endDate=u.startDate,s.rows[r].createdAt=e.startDate;const h={url:`callrecords/${s.rows[r]._id}/view`,queryParams:e.dataJsonObj.queryParamsObj?e.dataJsonObj.queryParamsObj:""},b=h.queryParams&&Object.keys(h.queryParams).length>0?`${h.url}?${JSON.stringify(h.queryParams)}`:h.url;s.rows[r].room=`<a class="enable" id="room${s.rows[r]._id}" href=${b}>${s.rows[r].room}`,s.rows[r].enterprise.short_name='<a class="enable" id="enterprise.short_name'+s.rows[r]._id+'" href="enterprises/enterprises/'+s.rows[r].enterprise.enterprise_id+'/view" >'+s.rows[r].enterprise.short_name,s.rows[r].duration=e.getDuration(d.startDate1,u.startDate1);let c="";if(s.rows[r].participants.length>0){let p=0;const m=s.rows[r].participants.length-2;for(let g=0;g<s.rows[r].participants.length&&(c=c+" "+s.rows[r].participants[g].user_profile_id.l_name+" "+s.rows[r].participants[g].user_profile_id.f_name+", ",p++,!(p>1));g++);c=c.substring(0,c.length-2),m>0&&(c=c+" "+e.translateService.instant("COMMON_FIELDS.AND")+" "+m+" "+e.translateService.instant("COMMON_FIELDS.OTHERS"))}s.rows[r].participants=c,e.callRecordsMobileListData=e.callRecordsMobileListData.filter(p=>p._id!==s.rows[r]._id),e.callRecordsMobileListData.push(s.rows[r])}s.totalCount&&(e.listingVariables.totalRecords=s.totalCount),1===e.listingVariables.pageNumbers&&(e.listingVariables.totalpages=s.pages),e.dataJsonObj.isLoadMoreClicked?(e.dataJsonObj.isLoadMoreClicked=!1,e.callRecordsList=e.callRecordsList.concat(s.rows)):e.callRecordsList=s.rows}else e.callRecordsList=[],e.callRecordsMobileListData=[]},s=>{e.hideSpinner()})}catch(i){e.hideSpinner(),e.loggerService.setLoggerError(e.constructor.name,"viewRecord",i)}})()}loadPageData(e){this.forcerefresh=e.forceRefresh,this.listingVariables.pageNumbers=e.listingVariables.pageNumbers,e.clearMobileData&&(this.callRecordsMobileListData=this.noDuplicates),e.isPaginationChange&&(this.dataJsonObj.selectedFilter=e.selectedFilterType,this.dataJsonObj.isLoadMoreClicked=e.isLoadMoreClicked,this.dataJsonObj.advancedSearchObj.inputAdvSearchObj=e.selectedAdvancedSearchObj),this.getAllRecords()}onActionClicked(e){try{e.action===o.A0.VIEW?this.commonService.redirectToUrl(["..",e._id,"view"],!0,!0,this.dataJsonObj.queryParamsObj?this.dataJsonObj.queryParamsObj:"",this.route):e.action===o.A0.JOIN_CALL?this.router.navigate(["call/"+e.data.callroom]):e.action===o.A0.VOIPCALL&&this.callintiate(e)}catch(i){this.loggerService.setLoggerError(this.constructor.name,"onActionClicked",i)}}callintiate(e){const i={room:e.data.callroom,user:JSON.parse(localStorage.getItem(o.BU.USER)),group:"",groupId:"",usernames:""};let s,a=e.data.participantsdata;if(a){const d=a.findIndex(u=>u.user_profile_id._id==+localStorage.getItem(o.BU.LOG_IN_USER_ID));d>-1&&a.splice(d,1)}const r=a.length-2;a.length>1&&(s=a[0].user_profile_id.f_name+" "+a[0].user_profile_id.l_name,E.L.isEmpty(a[1])||(s=s+", "+a[1].user_profile_id.f_name+" "+a[1].user_profile_id.l_name),r>0&&(s=s+" and "+r+" Others")),i.usernames=s;for(let d=0;d<a.length;d++)this.socketService.subscribeForAudioVideoCall(a[d].user_profile_id._id),this.socketService.emitForAudioVideoCall(i);this.router.navigate(["call/"+e.data.callroom])}presentActionSheet(e){var i=this;return(0,y.Z)(function*(){i.mobileroutesArray.length>0&&(i.actionSheet=yield i.actionSheetController.create({cssClass:"actionsheet",buttons:i.mobileroutesArray}),yield i.actionSheet.present())})()}mobileEventAction(e){this.mobileroutesArray=[],e.status_lookup_name===o.t3.ACTIVE&&this.mobileroutesArray.push({text:this.translateService.instant("COMMON_BUTTONS.BUTTON_JOIN"),handler:()=>{this.router.navigate(["call/"+e.callroom])}}),this.mobileroutesArray.push({text:this.translateService.instant("COMMON_BUTTONS.BUTTON_VIEW"),handler:()=>{this.commonService.redirectToUrl(["..",e._id,"view"],!0,!0,this.dataJsonObj.queryParamsObj?this.dataJsonObj.queryParamsObj:"",this.route)}}),this.actionSheet&&this.actionSheet.dismiss(),this.presentActionSheet(e)}getRedirectTocall(e){this.router.navigate(["/callrecords/"+e._id+"/view"])}getDuration(e,i){let a="";if(i){const s=new Date(D(e).format("DD-MMM-YYYY HH:mm:ss")).getTime(),r=new Date(D(i).format("DD-MMM-YYYY HH:mm:ss")).getTime(),u=Math.abs(r-s)/864e5,b=24*(u-Math.floor(u)),c=Math.floor(b),p=60*(b-c),m=Math.floor(p),M=Math.floor(60*(p-m));a=Math.round(c)+"h"+Math.round(m)+"m"+Math.round(M)+"s"}else{const s=new Date(D(e).format("DD-MMM-YYYY HH:mm:ss")).getTime(),r=new Date(D(Date.now()).format("DD-MMM-YYYY HH:mm:ss")).getTime(),u=Math.abs(r-s)/864e5,b=24*(u-Math.floor(u)),c=Math.floor(b),p=60*(b-c),m=Math.floor(p),M=Math.floor(60*(p-m));a=Math.round(c)+"h"+Math.round(m)+"m"+Math.round(M)+"s"}return a}displayDateFormatter(e,i,a){try{const s=a?this.commonService.convertDateToUserTimeZone(e,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):e,r={startDate:"",endDate:"",startDate1:s};if(r.startDate=this.commonService.convertDateToUserFormat(s,o.eZ.HOURS_MINS,!0,"",!1),i){const d=a?this.commonService.convertDateToUserTimeZone(e,this.userTimeZoneObj.utcMinutes,this.userTimeZoneObj.utcMinutesSign):e,u=this.commonService.addHoursToDate(d,d);r.endDate=this.commonService.convertDateToUserFormat(u,o.eZ.HOURS_MINS,!0,"",!1)}return r}catch(s){this.loggerService.setLoggerError(this.constructor.name,"displayDateFormatter",s)}}showSpinner(){this.dataJsonObj.showSpinner=!0}hideSpinner(){this.dataJsonObj.showSpinner=!1}selectedViewType(e){this.dataJsonObj.selectedDisplayView=e}selectedFilterType(e){e||(this.dataJsonObj.selectedFilter="",this.dataJsonObj.selectedAdvancedSearchObj={})}advancedSearchFilterClicked(e){this.dataJsonObj.selectedAdvancedSearchObj=e,this.dataJsonObj.selectedAdvancedSearchObj={}}onHeaderItemClick(e){switch(e.type){case"search":this.getSearchResult(e.event);break;case"search_close":this.searchClose();break;case"display_views":this.selectedViewType(e.event);break;case"filters":this.selectedFilterType(e.event);break;case"advanced_search":this.advancedSearchFilterClicked(e.event);break;case"page_actions":this.onPageLevelActionClicked(e.event)}}onPageLevelActionClicked(e){}static \u0275fac=function(i){return new(i||l)(t.Y36(C.v),t.Y36(I.v),t.Y36(V.Y),t.Y36(v.R),t.Y36(O.sK),t.Y36(f.gz),t.Y36(f.F0),t.Y36(L.m),t.Y36(J.$),t.Y36(W.BX),t.Y36(S.S$))};static \u0275cmp=t.Xpm({type:l,selectors:[["app-callrecords-list"]],features:[t._Bn([v.R,T.n,V.Y,K.s,C.v]),t.qOj],decls:8,vars:28,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","defaultView","isFabDisplay","pageActionsList","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu","headerItemClick"],[1,"card-body","pdt-0","pdb-0"],["id","faq-list",1,"",3,"header","actions","listingVariables","enablethreedots","data","totalRecords","totalPages","mobileListData","paginator","expand","selectedDisplayViewType","selectedFilterType","selectedAdvancedSearchObj","showSpinner","pageName","selectedMenuId","selectedSubMenuId","actionClicked","redirectionEvent","loadPageData","itemClickEvent"],[1,"mgt-5"],[3,"isFabDisplay","actionsList","selectedAction"]],template:function(i,a){1&i&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-pageheader",3),t.NdJ("headerItemClick",function(r){return a.onHeaderItemClick(r)}),t.qZA()(),t.TgZ(4,"div",4)(5,"app-datatable",5),t.NdJ("actionClicked",function(r){return a.onActionClicked(r)})("redirectionEvent",function(r){return a.mobileEventAction(r)})("loadPageData",function(r){return a.loadPageData(r)})("itemClickEvent",function(r){return a.getRedirectTocall(r)}),t.qZA(),t.TgZ(6,"div",6)(7,"app-page-actions",7),t.NdJ("selectedAction",function(r){return a.onPageLevelActionClicked(r)}),t.qZA()()()()()),2&i&&(t.xp6(3),t.Q6J("pageName",a.dataJsonObj.pageName)("defaultView",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.defaultView)("isFabDisplay",!1)("pageActionsList",a.dataJsonObj.pageActionsList)("pageTitle",a.dataJsonObj.pageTitle)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!0)("showDependencySubMenu",!1),t.xp6(2),t.Q6J("header",a.tableColumnheaders)("actions",a.actions)("listingVariables",a.listingVariables)("enablethreedots",!0)("data",a.callRecordsList)("totalRecords",a.listingVariables.totalRecords)("totalPages",a.listingVariables.totalpages)("mobileListData",a.callRecordsMobileListData)("paginator",!0)("expand",!1)("selectedDisplayViewType",a.dataJsonObj.selectedDisplayView)("selectedFilterType",a.dataJsonObj.selectedFilter)("selectedAdvancedSearchObj",a.dataJsonObj.selectedAdvancedSearchObj)("showSpinner",a.dataJsonObj.showSpinner)("pageName",a.dataJsonObj.pageName)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId),t.xp6(2),t.Q6J("isFabDisplay",!0)("actionsList",a.dataJsonObj.pageActionsList))},dependencies:[T.n,U.q,X.y]})}return l})();var A=n(11210);const x=[{path:"",data:{title:"call record"},children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",canActivate:[A.P],component:Z,data:{module:o.w1.MY_PROFILE,pageName:o.hf.CALL_RECORD}},{path:"list/missed_calls",canActivate:[A.P],component:Z,data:{module:o.w1.MY_PROFILE,pageName:o.hf.CALL_RECORD}},{path:":id/view",component:z,canActivate:[A.P],data:{module:o.w1.MY_PROFILE,pageName:o.hf.CALL_RECORD,pageSetting:o.AM.ACTIONS,settingField:o.In.VIEW}}]}];let ee=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=t.oAB({type:l});static \u0275inj=t.cJS({imports:[f.Bz.forChild(x),f.Bz]})}return l})();var te=n(3848);let ae=(()=>{class l{static \u0275fac=function(i){return new(i||l)};static \u0275mod=t.oAB({type:l});static \u0275inj=t.cJS({imports:[S.ez,S.ez,O.aw,ee,j.u5,j.UX,R.U$,_.fx,P.Q,F.Cv,te.Nh]})}return l})()}}]);