"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3482],{93482:(k,h,r)=>{r.r(h),r.d(h,{MasterdatavalidationModule:()=>R});var j=r(36895),m=r(62510),p=r(15861),n=r(94650),y=r(47561),v=r(42786),M=r(28168),b=r(71568),O=r(30578),d=r(32236),S=r(42863),A=r(75875);let J=(()=>{class l{authService;constructor(a){this.authService=a}getAllAsync(a,e,t,s,o,i,c,u,g){var w=this;return(0,p.Z)(function*(){const P=o?"&condition="+o:"";return yield w.authService.getApiCallAsync("api/v1/masterdatavalidation?type=list&enterprise.enterprise_id="+u+"&skip="+a+"&limit="+e+"&sort="+t+"&search="+s+g+P+"&islimit=false",c)})()}patch(a,e,t,s){var o=this;return(0,p.Z)(function*(){return new Promise((i,c)=>{o.authService.patchApiCall(`api/v1/masterdatavalidation/${e}?action=${t}&enterpriseId=${s}`,a).subscribe(u=>{i(u)},u=>{c(u)})})})()}static \u0275fac=function(e){return new(e||l)(n.LFG(A.e))};static \u0275prov=n.Yz7({token:l,factory:l.\u0275fac,providedIn:"root"})}return l})();var C=r(35226),T=r.n(C),_=r(27601),f=r(54463),N=r(37415),D=r(88425);const L=["datatableComponent"],E=[{path:"masterdatavalidation/list",component:(()=>{class l extends y.O{listingVariables;commonService;MasterdatavalidationService;route;ColumnHeader;loggerService;uiUtils;translateService;datatableComponent;searchValueChange=new n.vpe;dataJsonObj={};constructor(a,e,t,s,o,i,c,u){super(s,e),this.listingVariables=a,this.commonService=e,this.MasterdatavalidationService=t,this.route=s,this.ColumnHeader=o,this.loggerService=i,this.uiUtils=c,this.translateService=u,this.route.queryParams.subscribe(g=>{this.dataJsonObj.queryParamsObj={defaultView:g.default_view,selectedMenuId:g.selectedMenuId,selectedSubMenuId:g.selectedSubMenuId}})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.showSpinner(),this.dataJsonObj.pageName=d.hf.MASTER_DATA_VALIDATION,this.dataJsonObj.selectedEnterpriseId=localStorage.getItem(d.BU.SELECTED_ENTERPRISE),this.dataJsonObj.loginEnterpriseId=localStorage.getItem(d.BU.LOG_IN_ENTERPRISE_ID),this.dataJsonObj.pageActionsList=[],this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"NEW_VARIABLES.MASTER_DATA_VALIDATION",value:"",showSubMenuDisplayName:!1}],this.dataJsonObj.tableColumnheaders=this.ColumnHeader.getMasterdataValidationColumnHeaders(),this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.searchTerm="",this.dataJsonObj.actionsList={VALIDATE:!0,DOWNLOAD_MASTER_JSON:!0,DOWNLOAD_CURRENT_JSON:!0,COPY_TO_MASTER:!0},this.getDynamicJson([{folderName:d.sb.MODULE_MANAGER,jsonType:"view",storingFieldName:"moduleManagerViewJson"},{folderName:d.sb.USER_TYPES,jsonType:"view",storingFieldName:"userTypesViewJson"}]),this.getLanguagesViewJson()}getDynamicJson(a){var e=this;return(0,p.Z)(function*(){for(let t of a)try{e.dataJsonObj[t.storingFieldName]=yield e.commonService.getDynamicJson(e.dataJsonObj.loginEnterpriseId,t.folderName,t.jsonType)}catch{e.dataJsonObj[t.storingFieldName]={}}e.getDataFromAPI()})()}getLanguagesViewJson(){var a=this;return(0,p.Z)(function*(){const e=yield a.commonService.getDynamicJsonByPath(`assets/enterprises/${a.dataJsonObj.loginEnterpriseId}/${d.sb.LANGUAGES}/`,"languages.json",!0),t={};if(e)for(let s of e)t[s.ID+""]=s.NAME;a.dataJsonObj.languagesViewJSON=t})()}getSearchResult(a){try{this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.searchTerm=a,this.dataJsonObj.mobileListData=[],this.getAllRecords(),this.datatableComponent.reset(),this.searchValueChange.emit(a)}catch(e){this.loggerService.setLoggerError(this.constructor.name,"getSearchResult",e)}}searchClose(){try{this.dataJsonObj.searchTerm="",this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.mobileListData=[],this.getAllRecords(),this.datatableComponent.reset(),this.searchValueChange.emit("")}catch(a){this.loggerService.setLoggerError(this.constructor.name,"searchClose",a)}}getDataFromAPI(){var a=this;return(0,p.Z)(function*(){const e=a.commonService.getMobileViewCondition(a.dataJsonObj.selectedDisplayView),t=a.dataJsonObj.forceRefresh;a.showSpinner(),a.dataJsonObj.masterdataValidationList=yield a.MasterdatavalidationService.getAllAsync(a.listingVariables.pageNumbers,a.listingVariables.rowsPerPage,a.listingVariables.sortOrderColumn,a.dataJsonObj.searchTerm,a.dataJsonObj.statusObj,"",t,a.dataJsonObj.selectedEnterpriseId,e),a.hideSpinner(),a.getAllRecords()})()}getAllRecords(){var a=this;return(0,p.Z)(function*(){try{const e=a.listingVariables.rowsPerPage,t=yield a.commonService.getFilteredDynamicJSONDataWithPagination(a.dataJsonObj.masterdataValidationList.rows,["page.page_display_name","json_type","language.language_name","master_json_path","current_json_path","master_json_version","updatedAt"],a.dataJsonObj.searchTerm,a.listingVariables.sortOrderColumn,a.listingVariables.pageNumbers,e),s=t?t.data:[],o=t.totalRecordsCount;if(a.listingVariables.totalRecords=o,a.listingVariables.totalpages=Math.ceil(o/e),a.dataJsonObj.forceRefresh&&(a.dataJsonObj.mobileListData=[]),s.length>0){a.dataJsonObj.mobileListData&&a.dataJsonObj.mobileListData.length>0||(a.dataJsonObj.mobileListData=[]);for(let i=0;i<s.length;i++){s[i].display_grid_title=s[i].page.page_display_name,s[i].imageName=s[i].page.page_display_name,s[i].jsonType=s[i].json_type?s[i].json_type:a.dataJsonObj.userTypesViewJson&&s[i].user_type_id?a.dataJsonObj.userTypesViewJson[s[i].user_type_id]?.user_type_display_name:"",s[i].page.page_display_name=s[i].page?.page_id&&a.dataJsonObj.moduleManagerViewJson&&s[i].jsonType?s[i].jsonType+" - "+a.dataJsonObj.moduleManagerViewJson[s[i].page.page_id+""]?.page_display_name:s[i].page?.page_id&&a.dataJsonObj.moduleManagerViewJson?a.dataJsonObj.moduleManagerViewJson[s[i].page.page_id+""]?.page_display_name:"",s[i].language&&(s[i].language.language_display_name=a.dataJsonObj.languagesViewJSON[s[i].language.language_id+""]);const c=s[i].language?.language_display_name?s[i].language.language_display_name:"",u=[s[i].page.page_display_name,a.translateService.instant("COMMON_FIELDS.TYPE")+": "+s[i].jsonType,a.translateService.instant("PREFERENCES.LANGUAGE")+": "+c+"; "+a.translateService.instant("COMMON_FIELDS.VERSION")+": "+s[i].master_json_version];a.dataJsonObj.updatedAt=s[i].updatedAt,s[i].mobile_display_data=u,a.dataJsonObj.mobileListData=a.dataJsonObj.mobileListData.filter(g=>g._id!==s[i]._id||!(g.page.page_id===s[i].page.page_id&&g.json_type===s[i].json_type&&g.language?.language_id===s[i].language?.language_id&&g.user_type_id===s[i].user_type_id)),a.dataJsonObj.mobileListData.push(s[i])}a.dataJsonObj.isLoadMoreClicked?(a.dataJsonObj.isLoadMoreClicked=!1,a.dataJsonObj.dataList=a.dataJsonObj.dataList.concat(s)):a.dataJsonObj.dataList=s}else a.listingVariables.totalRecords=1,a.dataJsonObj.dataList=[],a.dataJsonObj.mobileListData=[]}catch(e){a.hideSpinner(),a.loggerService.setLoggerError(a.constructor.name,"getAllRecords",e)}})()}onItemClicked(a){}loadPageData(a){this.dataJsonObj.forceRefresh=a.forceRefresh,this.listingVariables.pageNumbers=a.listingVariables.pageNumbers,a.clearMobileData&&(this.dataJsonObj.mobileListData=this.dataJsonObj.noDuplicates),a.isPaginationChange&&(this.dataJsonObj.selectedFilter=a.selectedFilterType,this.dataJsonObj.isLoadMoreClicked=a.isLoadMoreClicked),this.getAllRecords()}showSpinner(){this.dataJsonObj.showSpinner=!0}hideSpinner(){this.dataJsonObj.showSpinner=!1}changeBookmarkName(a){this.dataJsonObj.bookmarkName=a.value}bookmarkNamePopup(a){this.dataJsonObj.bookmarkId=a._id,this.dataJsonObj.bookmarkName=a.bookmark_name,$("#bookmarkNameUpdate").modal("show"),$(".modal-backdrop").insertAfter("#bookmarkNameUpdate")}onActionClicked(a){try{a.action===d.A0.COPY_TO_MASTER?this.copyToMasterJson(a.data):a.action===d.A0.DOWNLOAD_MASTER_JSON?(this.uiUtils.displaytoastMessage(this.translateService.instant("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DOWNLOAD")),this.downloadJson(a.data.master_json_path)):a.action===d.A0.DOWNLOAD_CURRENT_JSON?(this.uiUtils.displaytoastMessage(this.translateService.instant("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DOWNLOAD")),this.downloadJson(a.data.current_json_path)):a.action===d.A0.VALIDATE&&this.validateMasterDataJsons(a.data)}catch(e){this.loggerService.setLoggerError(this.constructor.name,"onActionClicked",e)}}copyToMasterJson(a){var e=this;return(0,p.Z)(function*(){try{T().fire({title:"",text:e.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_COPY_TO_MASTER"),showCancelButton:!0,cancelButtonText:e.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:e.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(function(){var t=(0,p.Z)(function*(s){if(s.value){yield e.MasterdatavalidationService.patch(a,a._id,"copyToMasterDataJson",e.dataJsonObj.selectedEnterpriseId);const i=e.dataJsonObj.dataList.findIndex(c=>c._id===a._id&&c.json_type===a.json_type&&c.language?.language_id===a.language?.language_id);(i||0===i)&&(e.dataJsonObj.dataList[i].master_json_version=e.dataJsonObj.dataList[i].master_json_version?e.dataJsonObj.dataList[i].master_json_version+1:1),e.uiUtils.displaytoastMessage(e.translateService.instant("COMMON_TOAST_MESSAGES.TOAST_SUCCESSFUL_MASTER_DATA_COPY")),e.dataJsonObj.forceRefresh=!0}});return function(s){return t.apply(this,arguments)}}())}catch(t){e.loggerService.setLoggerError(e.constructor.name,"copyToMasterJson",t)}})()}downloadJson(a){this.downLoadFile("",a,"")}validateMasterDataJsons(a){var e=this;return(0,p.Z)(function*(){const t=yield e.MasterdatavalidationService.patch({originalFilePath:a.master_json_path,currentFilePath:a.current_json_path,jsonType:a.json_type,enterprise:a.enterprise},a._id,"validateMasterDataJsons",e.dataJsonObj.selectedEnterpriseId);e.commonService.reportlist(t).subscribe(o=>{e.downLoadFile(o,t,"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet; /xls; /xlsx; /vnd.ms-excel; /vnd.openxmlformats-officedocument.spreadsheetml.sheet"),e.uiUtils.displaytoastMessage(e.translateService.instant("COMMON_TOAST_MESSAGES.TOAST_SUCCESSFUL_MASTER_DATA_VALIDATION"))},o=>{e.commonErrorCodes(JSON.parse(o))})})()}downLoadFile(a,e,t){const s=a?new Blob([a.body],{type:t}):"",o=document.createElement("a");o.href=a?URL.createObjectURL(s):`${localStorage.getItem(d.BU.S3BUCKETURL)}${e}`;const i=e.split("/").pop();o.download=i,document.body.appendChild(o),o.click()}commonErrorCodes(a){const e=JSON.parse(a[d.BU.STATUS]);switch(e){case 404:this.uiUtils.displayWarningMessage(this.translateService.instant("COMMON_STATUS_CODES.404"));break;case 409:this.dataJsonObj.error="COMMON_STATUS_CODES."+e}}onHeaderItemClick(a){switch(a.type){case"search":this.getSearchResult(a.event);break;case"search_close":this.searchClose();break;case"display_views":this.selectedViewType(a.event)}}selectedViewType(a){this.dataJsonObj.selectedDisplayView=a}onPageLevelActionClicked(a){}static \u0275fac=function(e){return new(e||l)(n.Y36(O.v),n.Y36(b.v),n.Y36(J),n.Y36(m.gz),n.Y36(S.Y),n.Y36(v.m),n.Y36(_.s),n.Y36(f.sK))};static \u0275cmp=n.Xpm({type:l,selectors:[["app-masterdatavalidation"]],viewQuery:function(e,t){if(1&e&&n.Gf(L,5),2&e){let s;n.iGM(s=n.CRH())&&(t.datatableComponent=s.first)}},outputs:{searchValueChange:"searchValueChange"},features:[n._Bn([S.Y,O.v,b.v,J]),n.qOj],decls:9,vars:27,consts:[[1,"container-fluid"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","defaultView","isFabDisplay","pageActionsList","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu","headerItemClick"],["id","extraPaddingBottomID",1,"card-body","pdt-0"],["id","tagid",3,"header","actions","listingVariables","paginator","totalPages","totalRecords","data","mobileListData","expand","statsSearch","pageName","showSpinner","selectedDisplayViewType","selectedFilterType","selectedMenuId","selectedSubMenuId","actionClicked","itemClickEvent","loadPageData"],["datatableComponent",""],[1,"mgt-5"],[3,"isFabDisplay","actionsList","selectedAction"]],template:function(e,t){1&e&&(n.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-pageheader",3),n.NdJ("headerItemClick",function(o){return t.onHeaderItemClick(o)}),n.qZA()(),n.TgZ(4,"div",4)(5,"app-datatable",5,6),n.NdJ("actionClicked",function(o){return t.onActionClicked(o)})("itemClickEvent",function(o){return t.onItemClicked(o)})("loadPageData",function(o){return t.loadPageData(o)}),n.qZA(),n.TgZ(7,"div",7)(8,"app-page-actions",8),n.NdJ("selectedAction",function(o){return t.onPageLevelActionClicked(o)}),n.qZA()()()()()),2&e&&(n.xp6(3),n.Q6J("pageName",t.dataJsonObj.pageName)("defaultView",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.defaultView)("isFabDisplay",!1)("pageActionsList",t.dataJsonObj.pageActionsList)("pageTitle",t.dataJsonObj.pageTitle)("selectedMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!0)("showDependencySubMenu",!1),n.xp6(2),n.Q6J("header",t.dataJsonObj.tableColumnheaders)("actions",t.dataJsonObj.actionsList)("listingVariables",t.listingVariables)("paginator",!0)("totalPages",t.listingVariables.totalpages)("totalRecords",t.listingVariables.totalRecords)("data",t.dataJsonObj.dataList)("mobileListData",t.dataJsonObj.mobileListData)("expand",!1)("statsSearch",t.dataJsonObj.searchTerm)("pageName",t.dataJsonObj.pageName)("showSpinner",t.dataJsonObj.showSpinner)("selectedDisplayViewType",t.dataJsonObj.selectedDisplayView)("selectedFilterType",t.dataJsonObj.selectedFilter)("selectedMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==t.dataJsonObj.queryParamsObj?null:t.dataJsonObj.queryParamsObj.selectedSubMenuId),n.xp6(3),n.Q6J("isFabDisplay",!0)("actionsList",t.dataJsonObj.pageActionsList))},dependencies:[M.n,N.q,D.y]})}return l})(),data:{pageName:d.hf.MASTER_DATA_VALIDATION}}];let I=(()=>{class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=n.oAB({type:l});static \u0275inj=n.cJS({imports:[m.Bz.forChild(E),m.Bz]})}return l})();var V=r(65673);let R=(()=>{class l{static \u0275fac=function(e){return new(e||l)};static \u0275mod=n.oAB({type:l});static \u0275inj=n.cJS({imports:[j.ez,I,V.Q]})}return l})()}}]);