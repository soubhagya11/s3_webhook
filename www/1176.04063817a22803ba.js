"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1176],{71176:(G,d,n)=>{n.r(d),n.d(d,{RollbackModule:()=>w});var v=n(32174),h=n(36895),p=n(24006),b=n(35226),f=n.n(b),u=n(46560),O=n(42786),C=n(89851),g=n(32236),e=n(94650),r=n(62510),M=n(46448),l=n(54463),V=n(27601),T=n(2387),R=n(9851),N=n(37415);const S=["masterVersionValid"],I=["versionValid"];function B(o,x){if(1&o){const s=e.EpF();e.TgZ(0,"div",13)(1,"app-dropdown-singleselect",14,15),e.NdJ("valueChange",function(a){e.CHM(s);const i=e.oxw();return e.KtG(i.changeMasterVersion(a))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"ABOUT_US.VERSION")),e.s9C("defaultValue",s.changeMasterVersionId),e.Q6J("options",s.masterVersionDropdown)}}function y(o,x){if(1&o){const s=e.EpF();e.TgZ(0,"div",13)(1,"app-dropdown-singleselect",14,16),e.NdJ("valueChange",function(a){e.CHM(s);const i=e.oxw();return e.KtG(i.changeVersion(a))}),e.ALo(3,"translate"),e.qZA()()}if(2&o){const s=e.oxw();e.xp6(1),e.s9C("label",e.lcZ(3,3,"ABOUT_US.VERSION")),e.s9C("defaultValue",s.changeVersionId),e.Q6J("options",s.versionDropdown)}}let m=(()=>{class o{activatedRoute;generalSettings;loggerService;navigationService;router;syncsettings;translateService;uiUtils;masterVersionValid;versionValid;changeMasterVersionId;changeVersionId;changeVersionName;changemasterVersionName;enableMasterRollback=!0;enterpriseId;latestVersion;masterVersionDropdown=[];maxDataBackupVersions;popupMessage;recordID;rollbackVersion;syncData;syncsettingsData;url;versionDropdown=[];dataJsonObj={};errorObj={};constructor(s,t,a,i,c,L,j,J){this.activatedRoute=s,this.generalSettings=t,this.loggerService=a,this.navigationService=i,this.router=c,this.syncsettings=L,this.translateService=j,this.uiUtils=J,this.activatedRoute.params.subscribe(Z=>{this.recordID=Z.id})}ngOnInit(){this.dataJsonObj.pageName=g.hf.ROLL_BACK,this.enterpriseId=localStorage.getItem(g.BU.SELECTED_ENTERPRISE),this.url=this.router.url.split("/")[4],"masterrollback"===this.url?(this.enableMasterRollback=!0,this.dataJsonObj.pageTitle=[{key:"COMMON_BUTTONS.BUTTON_MASTER_ROLLBACK",value:"",showSubMenuDisplayName:!1}],this.popupMessage=this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_MASTER_ROLLBACK")):(this.enableMasterRollback=!1,this.dataJsonObj.pageTitle=[{key:"COMMON_BUTTONS.BUTTON_ROLLBACK",value:"",showSubMenuDisplayName:!1}],this.popupMessage=this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_ROLLBACK")),this.getAllRecords()}getAllRecords(){this.generalSettings.getgeneralsettings(this.enterpriseId).then(s=>{s.rows[0].configoption_json&&(this.maxDataBackupVersions=s.rows[0].configoption_json.generalConfigOptions.data_backups_preserve_versions?s.rows[0].configoption_json.generalConfigOptions.data_backups_preserve_versions:3,this.getRecordById())})}changeVersion(s){this.changeVersionId=s.value;const t=this.versionDropdown.find(a=>a.ID===parseInt(this.changeVersionId,10));this.changeVersionName=t.NAME}changeMasterVersion(s){this.changeMasterVersionId=s.value;const t=this.masterVersionDropdown.find(a=>a.ID===parseInt(this.changeMasterVersionId,10));this.changemasterVersionName=t.NAME}getRecordById(){this.syncsettings.get(this.recordID).then(s=>{if(this.syncsettingsData=s,this.latestVersion=this.syncsettingsData.last_published_version,this.latestVersion&&this.maxDataBackupVersions&&(this.rollbackVersion=parseInt(this.latestVersion)-parseInt(this.maxDataBackupVersions)),!1===this.enableMasterRollback){let t=this.rollbackVersion;for(let a=0;a<this.rollbackVersion;a++)t+=1,this.versionDropdown.push({ID:t,NAME:t+".0"})}else if(!0===this.enableMasterRollback){let t=0;for(let a=0;a<this.latestVersion;a++)t+=1,this.masterVersionDropdown.push({ID:t,NAME:t+".0"})}})}cancelBtn(){const s=this.navigationService.getPreviousUrl();this.router.navigate([s])}rollbackRecord(){(!0===this.enableMasterRollback?this.masterVersionValid.isValid():this.versionValid.isValid())&&f().fire({title:"",text:this.popupMessage,showCancelButton:!0,cancelButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(s=>{let t={};s.value&&(t=!0===this.enableMasterRollback?{syncId:this.recordID,masterPublishedVersion:this.changemasterVersionName}:{syncId:this.recordID,publishedVersion:this.changeVersionName},this.syncsettings.rollback(this.recordID,t).then(a=>{this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DATA_ROLLBACK"),this.router.routeReuseStrategy.clearModuleRouteCache("datapublish");const c=this.navigationService.getPreviousUrl();this.router.navigate([c])}))}).catch(s=>{this.loggerService.setLoggerError(this.constructor.name,"rollbackRecord",s)})}static \u0275fac=function(t){return new(t||o)(e.Y36(r.gz),e.Y36(u.G),e.Y36(O.m),e.Y36(M.f),e.Y36(r.F0),e.Y36(C.X),e.Y36(l.sK),e.Y36(V.s))};static \u0275cmp=e.Xpm({type:o,selectors:[["app-rollback"]],viewQuery:function(t,a){if(1&t&&(e.Gf(S,5),e.Gf(I,5)),2&t){let i;e.iGM(i=e.CRH())&&(a.masterVersionValid=i.first),e.iGM(i=e.CRH())&&(a.versionValid=i.first)}},features:[e._Bn([u.G])],decls:16,vars:12,consts:[[1,"container-fluid"],[1,"forms-wrapper"],[1,"row","g-0"],[1,"col-md-12"],[1,"card","bdt-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","pageTitle","showPageHeaderItems","showDependencySubMenu"],["id","extraPaddingBottomID",1,"card-body"],[1,"row","form-bs"],["class","col-md-4",4,"ngIf"],[1,"col-md-6"],["className","btn btn-primary btn-sm",1,"mgr-5",3,"label","buttonOnClick"],["className","btn btn-danger btn-sm",3,"label","buttonOnClick"],[1,"col-md-4"],["disabled","false","mandatory","true","id","appraisal-templates-create-rating-weightage-level-add",3,"label","defaultValue","options","valueChange"],["masterVersionValid",""],["versionValid",""]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),e._UZ(6,"app-pageheader",6),e.qZA(),e.TgZ(7,"div",7)(8,"div",8),e.YNc(9,B,4,5,"div",9),e.YNc(10,y,4,5,"div",9),e.TgZ(11,"div",10)(12,"app-button",11),e.NdJ("buttonOnClick",function(){return a.rollbackRecord()}),e.ALo(13,"translate"),e.qZA(),e.TgZ(14,"app-button",12),e.NdJ("buttonOnClick",function(){return a.cancelBtn()}),e.ALo(15,"translate"),e.qZA()()()()()()()()()),2&t&&(e.xp6(6),e.Q6J("pageName",a.dataJsonObj.pageName)("pageTitle",a.dataJsonObj.pageTitle)("showPageHeaderItems",!1)("showDependencySubMenu",!1),e.xp6(3),e.Q6J("ngIf",!0===a.enableMasterRollback),e.xp6(1),e.Q6J("ngIf",!1===a.enableMasterRollback),e.xp6(2),e.s9C("label",e.lcZ(13,8,"COMMON_BUTTONS.BUTTON_SUBMIT")),e.xp6(2),e.s9C("label",e.lcZ(15,10,"COMMON_BUTTONS.BUTTON_CANCEL")))},dependencies:[h.O5,T.r,R.k,N.q,l.X$]})}return o})();const A=[{path:"",data:{title:"Build Manager"},children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:":id/rollback",component:m},{path:":id/masterrollback",component:m}]}];let D=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=e.oAB({type:o});static \u0275inj=e.cJS({imports:[r.Bz.forChild(A),r.Bz]})}return o})();var k=n(83748),E=n(93144),U=n(65673);let w=(()=>{class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=e.oAB({type:o});static \u0275inj=e.cJS({imports:[h.ez,l.aw,p.u5,p.UX,E.U$,v.fx,U.Q,k.v,D]})}return o})()}}]);