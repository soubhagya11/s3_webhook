"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4341],{24341:(G,O,o)=>{o.r(O),o.d(O,{DataPublishModule:()=>Y});var L=o(32174),T=o(36895),M=o(11210),b=o(15861),I=o(35226),j=o.n(I),s=o(32236),S=o(42863),D=o(71568),R=o(47561),A=o(28168),C=o(30578),J=o(42786),P=o(89851),i=o(94650),v=o(70057),g=o(62510),y=o(54463),N=o(27601),B=o(37415),E=o(88425);const U=["datatableComponent"],_=[{path:"",data:{title:"Build Manager"},children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",canActivate:[M.P],component:(()=>{class l extends R.O{actionSheetController;columnheaders;loggerService;router;syncsettings;translateService;uiUtils;commonService;listingVariables;route;datatableComponent;actions;dataPublishMobileData;enterpriseId;headers;mobileroutesArray;noDuplicates=void 0;publishData;searchString;dataJsonObj={};constructor(e,t,a,r,n,h,u,c,d,p){super(p,c),this.actionSheetController=e,this.columnheaders=t,this.loggerService=a,this.router=r,this.syncsettings=n,this.translateService=h,this.uiUtils=u,this.commonService=c,this.listingVariables=d,this.route=p,this.route.queryParams.subscribe(m=>{this.dataJsonObj.queryParamsObj={defaultView:m.default_view,selectedMenuId:m.selectedMenuId,selectedSubMenuId:m.selectedSubMenuId}})}ngOnInit(){this.initializeComponent()}initializeComponent(){this.dataJsonObj.pageName=s.hf.DATA_PUBLISH,this.dataJsonObj.pageTitle=[{key:"COMMON_FIELDS.ALL",value:"",showSubMenuDisplayName:!1},{key:"COMMON_PAGE_TITLES.DATA_PUBLISH",value:"",showSubMenuDisplayName:!0}],this.enterpriseId=localStorage.getItem(s.BU.SELECTED_ENTERPRISE),this.searchString="",this.headers=this.columnheaders.getDataPublishColumnHeaders(),this.dataJsonObj.selectedEnterpriseId=localStorage.getItem(s.BU.SELECTED_ENTERPRISE),this.actions={PUBLISH:this.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.PUBLISH),MASTER_PUBLISH:this.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.MASTER_PUBLISH),ROLLBACK:this.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.ROLEBACK),MASTER_ROLLBACK:this.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.MASTER_ROLEBACK)},this.dataJsonObj.pageActionsList=[],this.dataJsonObj.addFiltersList=[],this.getDynamicJson([{folderName:"module_manager",jsonType:"list",storingFieldName:"moduleManagerListJson"},{folderName:"lookup_codes",jsonType:"view",storingFieldName:"lookupCodesViewJson"}]),this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.roleRightsValidation("ADMIN","ADMIN","CREATE"),this.roleRightsValidation("ADMIN","ADMIN","FILTERS")}getDynamicJson(e){var t=this;return(0,b.Z)(function*(){for(let a of e)try{t.dataJsonObj[a.storingFieldName]=yield t.commonService.getDynamicJson(t.dataJsonObj.selectedEnterpriseId,a.folderName,a.jsonType)}catch{t.dataJsonObj[a.storingFieldName]={}}t.dataJsonObj.moduleManagerListData=yield t.commonService.getAllPagesFromModuleManagerJSON(t.dataJsonObj.moduleManagerListJson),t.dataJsonObj.dataPublishList=t.dataJsonObj.moduleManagerListData.filter(a=>a.sync_settings?.is_enabled&&a.sync_settings?.is_publishable);for(let a of t.dataJsonObj.dataPublishList)a.application.lookup_display_name=t.dataJsonObj.lookupCodesViewJson[a.application.lookup_id+""].lookup_display_name;t.getAllRecords()})()}getAllRecords(){var e=this;return(0,b.Z)(function*(){try{e.commonService.getMobileViewCondition(e.dataJsonObj.selectedDisplayView),e.enterpriseId=localStorage.getItem(s.BU.SELECTED_ENTERPRISE);const n=parseInt(e.listingVariables.rowsPerPage,10),h=yield e.commonService.getFilteredDynamicJSONDataWithPagination(e.dataJsonObj.dataPublishList,["module.page_name","page_display_name","application.lookup_display_name"],e.searchString,e.listingVariables.sortOrderColumn,e.listingVariables.pageNumbers,n),u=h.totalRecordsCount,c=h.data;if(c&&c.length>0){e.dataJsonObj.mobileDataList&&e.dataJsonObj.mobileDataList.length>0||(e.dataJsonObj.mobileDataList=[]);for(let d of c)d.isPublishEnabled=!(!d.page_configurations?.sync_config?.last_synced_date||d.page_configurations?.sync_config?.last_published_date&&!(new Date(d.page_configurations?.sync_config?.last_synced_date)>new Date(d.page_configurations?.sync_config?.last_published_date))),d.page_configurations?.sync_config?.last_published_date&&(d.last_published_date=e.commonService.dbTimezoneFormat(d.page_configurations.sync_config.last_published_date)),e.dataJsonObj.mobileDataList=e.dataJsonObj.mobileDataList.filter(p=>p._id!==d._id),e.dataJsonObj.mobileDataList.push(d);e.listingVariables.totalRecords=u,e.listingVariables.totalpages=u/n,e.dataJsonObj.isLoadMoreClicked?(e.dataJsonObj.isLoadMoreClicked=!1,e.dataJsonObj.dataList=e.dataJsonObj.dataList.concat(c)):e.dataJsonObj.dataList=c}else e.dataJsonObj.dataList=[],e.dataJsonObj.mobileDataList=[]}catch(t){e.loggerService.setLoggerError(e.constructor.name,"getAllRecords",t)}})()}loadPageData(e){this.listingVariables.pageNumbers=e.listingVariables.pageNumbers,e.clearMobileData&&(this.dataJsonObj.mobileDataList=this.noDuplicates),e.isPaginationChange&&(this.dataJsonObj.selectedFilter=e.selectedFilterType,this.dataJsonObj.isLoadMoreClicked=e.isLoadMoreClicked),this.getAllRecords()}getSearchResult(e){this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.searchString=e,this.dataJsonObj.mobileDataList=[],this.getAllRecords(),this.datatableComponent.reset()}searchClose(){this.searchString="",this.listingVariables.pageNumbers=1,this.listingVariables.totalRecords=1,this.dataJsonObj.mobileDataList=[],this.getAllRecords(),this.datatableComponent.reset()}onActionClicked(e){e.action===s.A0.PUBLISH?(this.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),this.publishRecord(e,!1)):e.action===s.A0.MASTER_PUBLISH?(this.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),this.publishRecord(e,!0)):e.action===s.A0.ROLLBACK?(this.router.routeReuseStrategy.clearModuleRouteCache("rollback"),this.router.navigate(["admin/data/"+e.data._id+"/rollback"])):e.action===s.A0.MASTER_ROLLBACK&&(this.router.routeReuseStrategy.clearModuleRouteCache("rollback"),this.router.navigate(["admin/data/"+e.data._id+"/masterrollback"]))}mobileEventAction(e){var t=this;return(0,b.Z)(function*(){try{t.mobileroutesArray=[],t.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.MASTER_PUBLISH)&&t.mobileroutesArray.push({text:t.translateService.instant("COMMON_BUTTONS.BUTTON_MASTER_PUBLISH"),handler:()=>{t.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),t.publishRecord(e,!0)}}),t.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.MASTER_ROLEBACK)&&t.mobileroutesArray.push({text:t.translateService.instant("COMMON_BUTTONS.BUTTON_MASTER_ROLLBACK"),handler:()=>{t.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),t.router.navigate(["admin/data/"+e._id+"/masterrollback"])}}),t.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.PUBLISH)&&t.mobileroutesArray.push({text:t.translateService.instant("COMMON_BUTTONS.BUTTON_PUBLISH"),handler:()=>{t.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),t.publishRecord(e,!1)}}),t.roleRightsValidationByPage(s.hf.DATA_PUBLISH,s.AM.ACTIONS,s.In.ROLEBACK)&&t.mobileroutesArray.push({text:t.translateService.instant("COMMON_BUTTONS.BUTTON_ROLLBACK"),handler:()=>{t.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),t.router.navigate(["admin/data/"+e._id+"/rollback"])}}),t.presentActionSheet(e)}catch(a){t.loggerService.setLoggerError(t.constructor.name,"presentActionSheet",a)}})()}presentActionSheet(e){var t=this;return(0,b.Z)(function*(){yield(yield t.actionSheetController.create({cssClass:"actionsheet",buttons:t.mobileroutesArray})).present()})()}publishRecord(e,t){j().fire({title:"",text:this.translateService.instant("COMMON_CONFIRM_MESSAGES.CONFIRM_RECORD_PUBLISH"),showCancelButton:!0,cancelButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_NO"),confirmButtonText:this.translateService.instant("COMMON_BUTTONS.BUTTON_YES"),customClass:{confirmButton:"btn btn-primary btn-sm mgr-5 mat-raised-button mr-1",cancelButton:"btn btn-danger btn-sm mat-raised-button"}}).then(a=>{if(a.value){const r={syncId:e.data._id,selectedEnterpriseId:this.dataJsonObj.selectedEnterpriseId,application:e.data.application,languageCode:localStorage.getItem(s.BU.LOGIN_USER_LANGUAGE)?localStorage.getItem(s.BU.LOGIN_USER_LANGUAGE):"en",isMasterPublish:t};this.syncsettings.publishData(r).then(n=>{this.uiUtils.displaytoastMessage("COMMON_TOAST_MESSAGES.TOAST_SUCCESS_DATA_PUBLISH"),this.router.routeReuseStrategy.clearModuleRouteCache("datapublish"),this.dataJsonObj.dataList=[],this.dataJsonObj.mobileDataList=this.noDuplicates,this.getDynamicJson([{folderName:"module_manager",jsonType:"list",storingFieldName:"moduleManagerListJson"}])})}else this.getAllRecords()}).catch(a=>{this.loggerService.setLoggerError(this.constructor.name,"publishRecord",a)})}selectedViewType(e){this.dataJsonObj.selectedDisplayView=e}selectedFilterType(e){e||(this.dataJsonObj.selectedFilter="",this.dataJsonObj.selectedAdvancedSearchObj={})}onPageLevelActionClicked(e){}advancedSearchFilterClicked(e){this.dataJsonObj.selectedAdvancedSearchObj=e}onHeaderItemClick(e){switch(e.type){case"search":this.getSearchResult(e.event);break;case"search_close":this.searchClose();break;case"display_views":this.selectedViewType(e.event);break;case"filters":this.selectedFilterType(e.event);break;case"advanced_search":this.advancedSearchFilterClicked(e.event);break;case"page_actions":this.onPageLevelActionClicked(e.event)}}static \u0275fac=function(t){return new(t||l)(i.Y36(v.BX),i.Y36(S.Y),i.Y36(J.m),i.Y36(g.F0),i.Y36(P.X),i.Y36(y.sK),i.Y36(N.s),i.Y36(D.v),i.Y36(C.v),i.Y36(g.gz))};static \u0275cmp=i.Xpm({type:l,selectors:[["app-datapublish"]],viewQuery:function(t,a){if(1&t&&i.Gf(U,5),2&t){let r;i.iGM(r=i.CRH())&&(a.datatableComponent=r.first)}},features:[i._Bn([A.n,S.Y,C.v]),i.qOj],decls:9,vars:25,consts:[[1,"container-fluid","config-optns"],[1,"card","bd-0"],["id","stickyHeaderID",1,"card-header","card-header-primary"],[1,"subpage-header-title","w-100",3,"pageName","defaultView","isFabDisplay","pageActionsList","pageTitle","selectedMenuId","selectedSubMenuId","showPageHeaderItems","showDependencySubMenu","headerItemClick"],["id","extraPaddingBottomID",1,"card-body","pdt-0"],[1,"",3,"header","actions","totalRecords","listingVariables","totalPages","data","paginator","mobileListData","selectedDisplayViewType","selectedFilterType","selectedAdvancedSearchObj","pageName","selectedMenuId","selectedSubMenuId","actionClicked","redirectionEvent","loadPageData"],["datatableComponent",""],[1,"mgt-5"],[3,"isFabDisplay","actionsList","selectedAction"]],template:function(t,a){1&t&&(i.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"app-pageheader",3),i.NdJ("headerItemClick",function(n){return a.onHeaderItemClick(n)}),i.qZA()()(),i.TgZ(4,"div",4)(5,"app-datatable",5,6),i.NdJ("actionClicked",function(n){return a.onActionClicked(n)})("redirectionEvent",function(n){return a.mobileEventAction(n)})("loadPageData",function(n){return a.loadPageData(n)}),i.qZA(),i.TgZ(7,"div",7)(8,"app-page-actions",8),i.NdJ("selectedAction",function(n){return a.onPageLevelActionClicked(n)}),i.qZA()()()()),2&t&&(i.xp6(3),i.Q6J("pageName",a.dataJsonObj.pageName)("defaultView",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.defaultView)("isFabDisplay",!1)("pageActionsList",a.dataJsonObj.pageActionsList)("pageTitle",a.dataJsonObj.pageTitle)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId)("showPageHeaderItems",!0)("showDependencySubMenu",!1),i.xp6(2),i.Q6J("header",a.headers)("actions",a.actions)("totalRecords",a.listingVariables.totalRecords)("listingVariables",a.listingVariables)("totalPages",a.listingVariables.totalpages)("data",a.dataJsonObj.dataList)("paginator",!0)("mobileListData",a.dataJsonObj.mobileDataList)("selectedDisplayViewType",a.dataJsonObj.selectedDisplayView)("selectedFilterType",a.dataJsonObj.selectedFilter)("selectedAdvancedSearchObj",a.dataJsonObj.selectedAdvancedSearchObj)("pageName",a.dataJsonObj.pageName)("selectedMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedMenuId)("selectedSubMenuId",null==a.dataJsonObj.queryParamsObj?null:a.dataJsonObj.queryParamsObj.selectedSubMenuId),i.xp6(3),i.Q6J("isFabDisplay",!0)("actionsList",a.dataJsonObj.pageActionsList))},dependencies:[A.n,B.q,E.y]})}return l})(),data:{object_type:s.hf.DATA_PUBLISH,title:"Data Publish List",responsibilityParam:s.bP.MENUS+"."+s.w1.ADMIN+"."+s.bP.SUBMENUS+"."+s.w1.DATA_PUBLISH+"."+s.Iu.ENABLED,pageName:s.hf.DATA_PUBLISH}}]}];let F=(()=>{class l{static \u0275fac=function(t){return new(t||l)};static \u0275mod=i.oAB({type:l});static \u0275inj=i.cJS({imports:[g.Bz.forChild(_),g.Bz]})}return l})();var f=o(24006),H=o(83748),k=o(93144),w=o(65673);let Y=(()=>{class l{static \u0275fac=function(t){return new(t||l)};static \u0275mod=i.oAB({type:l});static \u0275inj=i.cJS({imports:[T.ez,y.aw,f.u5,f.UX,k.U$,L.fx,w.Q,H.v,F]})}return l})()}}]);